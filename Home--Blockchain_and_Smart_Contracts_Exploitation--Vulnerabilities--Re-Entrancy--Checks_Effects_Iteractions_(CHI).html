<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Checks Effects Iteractions (CHI)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Checks Effects Iteractions (CHI)</h1><br /><br /><strong>
      <h3>Checks Effects Interactions (CHI)</h3>
    </strong><br />Also note that this code follows the proper Solidity secure coding pattern of Checks, Effects,
    Interactions (CHI).<br />These are coding patterns which prevent attack vectors by design. <br />In the
    <strong>CHI</strong> pattern, we always want to:<br />1. <span style="text-decoration:underline;">Check</span> that
    the requirements are met before continuing execution. <br />
    <div class="codebox">
      <div class="codebox">//example<br />require&nbsp;(withdrawAmount&nbsp;&lt;=&nbsp;balances[msg.sender]);</div>
    </div><br />2. Take <span style="text-decoration:underline;">Effect</span> of the transaction, so update balances
    and making changes before interacting with an external actor.<br />
    <div class="codebox">
      <div class="codebox">//example<br />balances[msg.sender]&nbsp;-=&nbsp;withdrawAmount;</div>
    </div><br />3. <span style="text-decoration:underline;">Interact</span> with the external address we are
    transferring the value to<br />
    <div class="codebox">
      <div class="codebox">//example<br />msg.sender.transfer(withdrawAmount);</div>
    </div><br /><br />This pattern will become clear within the <a
      href="Home--Blockchain_and_Smart_Contracts_Exploitation--Vulnerabilities--Re-Entrancy.html">Reentrancy attack
      chapter</a>. <br />The <strong>incorrectly coded pattern</strong> that usually creates a <span
      style="text-decoration:underline;">vulnerable smart contract</span> is Checks → Interaction → Effects:<br /> 1)
    <span style="text-decoration:underline;">Check</span> the requirements<br /> 3) <span
      style="text-decoration:underline;">Interaction</span> with an un-trusted external party<br /> 2) <span
      style="text-decoration:underline;">Effect</span> of the transaction<br />which violates the<br />Checks → Effects
    → Interactions<br /><br /> In order to prevent the attacker from continually removing value from the contract, we
    always make sure to update the balance before transferring the value out of the contract. If the transaction happens
    to fail, the transfer function will revert the actions taken in the contract effectively refilling the users
    account. <br />At this point you are probably starting to notice that Solidity is pretty easy to understand.
    However, there are a lot of Gotchas if secure coding patterns are not used or dangerous low level functionality is
    handled incorrectly.<br /><br />Bibliography:<br />• <a
      href="https://docs.soliditylang.org/en/v0.6.0/security-considerations.html?highlight=checks%20effects#use-the-checks-effects-interactions-pattern" target="_blank">https://docs.soliditylang.org/en/v0.6.0/security-considerations.html?highlight=checks%20effects#use-the-checks-effects-interactions-pattern</a><br />•
    <a
      href="http://console-cowboys.blogspot.com/2020/08/smart-contract-hacking-chapter-2.html" target="_blank">http://console-cowboys.blogspot.com/2020/08/smart-contract-hacking-chapter-2.html</a>
  </div>
</body>

</html>