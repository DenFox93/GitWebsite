<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>nmap+hping3 (more reliable)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>nmap+hping3 (more reliable)</h1><br/><strong><h3>To avoid false negative</h3></strong><h3> </h3><br />This method with hping is more reliable, since the Idle Scan (-sI) could give us the error “<span style="color:#ff0000;">port ... cannot be used because it has not returned any of our probes -- perhaps it is down or firewalled</span>” when is not true<br /><br />Sometime manual check is more accurate than automated one, a port labeled by nmap as closed|filtered maybe is open, if we are dubious we can do a double check manually.<br />We can spoofing with hping3(-a) while in the meantime monitor the IP ID with hping3 to check if there is any increment of the IP ID<br /><br /><strong>0. Finding a Working Idle Scan Zombie Host</strong><br />    Use NSE script that automatically check if a host is good zombie candidate<br />    We can specify also more than one host and use a list file with -iL<br />    Find a host with the value <span style="color:#ff8700;">Incremental</span> <br />    <div class="codebox"><div class="codebox">nmap&nbsp;--script&nbsp;ipidseq&nbsp;<span style="color:#000000;font-weight:400">&lt;</span>IP_ADDRESS<span style="color:#000000;font-weight:400">&gt;</span></div></div><br />    <a href=""><img src="images/648-1.png" alt="images/648-1.png" /></a><br />    <br /><strong>1.</strong> <strong>hping3 monitoring</strong><br />    we can detect if the host is a good zombie by estimating the host (zombie) traffic with hping3.<br />    In the following example the ID increments by 1, meaning that the host does not communicate with any machine on the network but only with us, making it a possible zombie candidate<br />    <code>hping3 -S -r [ZombieIP] -p [ZombiePort]</code><br />    <div class="codebox"><div class="codebox">hping3&nbsp;-S&nbsp;-r&nbsp;192.168.1.76&nbsp;-p&nbsp;135</div></div><br />    <a href=""><img src="images/648-2.png" alt="images/648-2.png" /></a><br />    <strong>-r </strong>→  allows us to see the relative ID increments instead of the actual ID.<br />    Otherwise we will see the actual ID: <br />    <a href=""><img src="images/648-3.png" alt="images/648-3.png" /></a><br />    if the IP ID increases by one, it can be considered a viable candidate.<br />    But we can never be 100% sure because:<br />      ▪ We have to validate if it is a global or local increase<br />      ▪ Some hosts increase IP ID on a per host basis<br />    <strong>-p</strong> → sets the destination port, which in our case is 135<br />    Leave open this connection and execute command<br />   <br /><strong>2.</strong> <strong>hping3 spoofing</strong><br />    Now that we have found our target zombie(192.168.1.63) we can use hping3 to craft packets that will be sent to the target host we want to scan with source IP address of our zombie<br />    <code>hping3 -a [ZombieIP] -S -p [TargetPort] [TargetIPaddress]</code><br />    <div class="codebox"><div class="codebox">hping3&nbsp;-a&nbsp;192.168.1.63&nbsp;-S&nbsp;-p&nbsp;139&nbsp;192.168.1.42</div></div><br />    <strong>-a</strong> → spoof the zombie source address, this become the source IP address<br />    <strong>-S</strong> → SYN flag enabled<br />    <strong>-p</strong> → destination port of the packet<br />    <br />    From this packet we not receive any response! We need to check the tab of point 1<br />    To know if the TargetPort of the TargetIPaddress is open we have to continue to run the command at the point 1, If in the output the <span style="color:#ff8700;">ID increment is +2</span> this mean that the TargetPort is open<br />    <a href=""><img src="images/648-4.png" alt="images/648-4.png" /></a></div>
</body>
</html>
