<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Normal format</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Normal format</h1><br/><br />1. scan with nmap and save on file<br />    <div class="codebox"><div class="codebox">nmap&nbsp;-sS&nbsp;-n&nbsp;192.168.1.97&nbsp;-oN&nbsp;nmapResult.nmap</div></div><br />2. extraction of open ports<br />    <div class="codebox"><div class="codebox">./openPorts-normal.rb&nbsp;192.168.1.97&nbsp;&nbsp;nmapResult.nmap</div></div><br />    <a href=""><img src="images/1816-1.png" alt="images/1816-1.png" /></a><br /><br /><strong><h2>Description of </h2></strong><strong><h2>openPorts-normal.rb</h2></strong><strong><h2> script file</h2></strong><br /><strong>regular expressions used in openPorts-normal.rb</strong><br />1. host (ip_pattern) → <code>/^Nmap scan report for #{ip}$/</code><br />   ◇ line 29<br />        <div class="codebox"><div class="codebox">line.match(ip_pattern)&nbsp;do</div></div><br />2. host is up (up_host_pattern) →  <code>/^Host is up (?:.)*\n/</code><br />   ◇ line 32<br />        <div class="codebox"><div class="codebox">stream.readline.match&nbsp;up_host_pattern&nbsp;do</div></div><br />4. port found (port_pattern) →  <code>/^(?:(\d+)\/\w+\s+#{port_state}\s+.+\n)/</code><br />   ◇ line 35<br />        <div class="codebox"><div class="codebox">stream.each&nbsp;do&nbsp;|line|&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;line&nbsp;=~&nbsp;port_pattern<br />&nbsp;&nbsp;&nbsp;&nbsp;puts&nbsp;$1&nbsp;if&nbsp;$1<br />&nbsp;&nbsp;&nbsp;&nbsp;break&nbsp;if&nbsp;line&nbsp;==&nbsp;&quot;\n&quot;</div></div><br /><br /><strong><span style="color:#ff8700;">openPorts-normal.rb</span></strong><br /><div class="codebox"><div class="codebox">#!/usr/bin/ruby<br /><br />begin<br />	#&nbsp;take&nbsp;first&nbsp;argument&nbsp;that&nbsp;is&nbsp;the&nbsp;ip&nbsp;and&nbsp;escape&nbsp;all&nbsp;the&nbsp;dots&nbsp;(.)&nbsp;this,&nbsp;because&nbsp;ip&nbsp;is&nbsp;used&nbsp;in&nbsp;<br />	#&nbsp;ip_pattern&nbsp;regular&nbsp;expression<br />	ip&nbsp;=&nbsp;ARGV[0].gsub(&quot;.&quot;,&quot;\\.&quot;)<br />	<br />	#&nbsp;chek&nbsp;if&nbsp;the&nbsp;optional&nbsp;argument&nbsp;&#39;state&#39;&nbsp;is&nbsp;provided<br />	options&nbsp;=&nbsp;[&quot;-open&quot;,&quot;-closed&quot;,&quot;-filtered&quot;]<br />	#&nbsp;[1..-1]&nbsp;deletes&nbsp;the&nbsp;first&nbsp;minus&nbsp;character&nbsp;from&nbsp;ARGV[1],&nbsp;if&nbsp;we&nbsp;have&nbsp;specified&nbsp;the&nbsp;state<br />	port_state&nbsp;=&nbsp;ARGV[1][1..-1]&nbsp;if&nbsp;options.include?&nbsp;ARGV[1]<br />	#&nbsp;if&nbsp;&nbsp;port_state&nbsp;is&nbsp;nil,&nbsp;because&nbsp;we&nbsp;have&nbsp;not&nbsp;specified&nbsp;it,&nbsp;default&nbsp;state&nbsp;is&nbsp;&quot;open&quot;<br />	port_state&nbsp;=&nbsp;&quot;open&quot;&nbsp;if&nbsp;!port_state<br /><br />	#&nbsp;check&nbsp;if&nbsp;argument&nbsp;is&nbsp;the&nbsp;file<br />	file&nbsp;=&nbsp;ARGV[2]&nbsp;if&nbsp;ARGV[2]&nbsp;#&nbsp;if&nbsp;we&nbsp;have&nbsp;specified&nbsp;as&nbsp;argument&nbsp;the&nbsp;optional&nbsp;state<br />	file&nbsp;=&nbsp;ARGV[1]&nbsp;if&nbsp;!file&nbsp;#&nbsp;if&nbsp;we&nbsp;have&nbsp;not&nbsp;specified&nbsp;optional&nbsp;state<br /><br />&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;ip&nbsp;and&nbsp;port_state&nbsp;creted&nbsp;previously	<br /><br />	ip_pattern&nbsp;=&nbsp;/^Nmap&nbsp;scan&nbsp;report&nbsp;for&nbsp;#{ip}$/<br />	up_host_pattern&nbsp;=&nbsp;/^Host&nbsp;is&nbsp;up&nbsp;(?:.)*\n/<br />	port_pattern&nbsp;=&nbsp;/^(?:(\d+)\/\w+\s+#{port_state}\s+.+\n)/<br /><br /><br />	stream&nbsp;=&nbsp;File.new(file,&quot;r&quot;)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;open&nbsp;the&nbsp;file&nbsp;stream<br />	stream.each&nbsp;do&nbsp;|line|&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;for&nbsp;each&nbsp;line&nbsp;of&nbsp;the&nbsp;stream<br />		line.match(ip_pattern)&nbsp;do&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;if&nbsp;the&nbsp;ip&nbsp;is&nbsp;found<br />			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;and&nbsp;the&nbsp;ip&nbsp;host&nbsp;is&nbsp;up&nbsp;we&nbsp;have&nbsp;to&nbsp;<br />									&nbsp;&nbsp;#&nbsp;extract&nbsp;each&nbsp;(open|closed|filtered)&nbsp;port<br />			stream.readline.match&nbsp;up_host_pattern&nbsp;do<br />				stream.readline&nbsp;		&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;reads&nbsp;line&nbsp;of&nbsp;type:&nbsp;&quot;Not&nbsp;shown:&nbsp;*&nbsp;closed&nbsp;ports&quot;<br />				stream.readline&nbsp;	&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;	#&nbsp;reads&nbsp;line&nbsp;of&nbsp;type:&nbsp;&quot;PORT&nbsp;STATE&nbsp;SERVICE&quot;<br />				stream.each&nbsp;do&nbsp;|line|&nbsp;		#&nbsp;from&nbsp;here&nbsp;each&nbsp;line&nbsp;stores&nbsp;the&nbsp;port&nbsp;					<br />					line&nbsp;=~&nbsp;port_pattern&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;line&nbsp;matches&nbsp;the&nbsp;port&nbsp;sub-pattern&nbsp;<br />					puts&nbsp;$1&nbsp;if&nbsp;$1			&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;-&gt;&nbsp;print&nbsp;the&nbsp;port<br />					break&nbsp;if&nbsp;line&nbsp;==&nbsp;&quot;\n&quot;		&nbsp;&nbsp;#&nbsp;if&nbsp;all&nbsp;the&nbsp;lines&nbsp;have&nbsp;been&nbsp;parsed&nbsp;-&gt;&nbsp;exit&nbsp;from&nbsp;block						<br />				end<br />			end<br />		end<br />	end<br />	<br /><br />rescue&nbsp;Exception&nbsp;=&gt;&nbsp;e<br />	puts&nbsp;e<br />end<br /><br /><br /></div></div><br /><br /><br /></div>
</body>
</html>
