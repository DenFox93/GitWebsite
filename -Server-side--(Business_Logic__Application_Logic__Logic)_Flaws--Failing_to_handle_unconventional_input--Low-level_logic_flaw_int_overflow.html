<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Low-level logic flaw: int overflow</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Low-level logic flaw: int overflow</h1><br/><br />If Web Application doesn&#39;t adequately validate user input, we can exploit a logic flaw in its purchasing workflow to buy items for an unintended price. <br />In this case the value of the cart can be overflowed, then become negative and then another time positive.<br /><br /><br /><br /><strong><h3>Check for Vulnerability</h3></strong><br />The WebApplication has a logic in the request to prevent users from ordering more units than are currently in stock<br />It accept max 2 digits value (0 to 99) for the “quantity” parameter<br />    <a href=""><img src="images/1885-1.png" alt="images/1885-1.png" /></a><br />Anyway we can continue to add orders of the same article to the Cart!<br />    <a href=""><img src="images/1885-2.png" alt="images/1885-2.png" /></a><br /><strong><span style="text-decoration:underline;">To check if a vulnerability exist</span></strong><span style="text-decoration:underline;"> we need to check if the value of the cart can go negative</span><br />Usually for Back End Programming languages the max value of <strong>int</strong> is 2.147.483.647 . This value is valid for 32 bit computers 2<sup>31</sup>-1. After this value there could be an overflow.<br />We will use this configuration to repeatedly issue the base request unmodified(choose an high value item to speed up the process):<br />   ◇ Payloads → Payloads Sets → Payload type → Null Payloads <br />   ◇ Payloads → Payloads Options → Continue Indefinitely<br />   ◇ Resource Pool → maximum concurrent requests = 1<br />        <a href=""><img src="images/1885-3.png" alt="images/1885-3.png" /></a><br />        <a href=""><img src="images/1885-4.png" alt="images/1885-4.png" /></a><br /><strong><h3>Exploit: Overflow attack </h3></strong><br />• In the example we send to Burp Intruder a request for an object of value 1337 and quantity 99(max value admitted)<br />• In this way we will add at every request 99 quantity of the same product to the Cart, this because we want to trigger an overflow<br />• After 2.147.483.647/(99*1337)=16224,19.. requests we should we should have a <span style="text-decoration:underline;">int overflow</span> and a negative number on our cart<br />   ◇ This mean that to trigger an overflow we need 16224*99=1606176 products in the cart<br />• the value will loop back to the minimum possible value (-2,147,483,647) and from it will increase<br />• We want increase the value of the cart and settle it a little bit under 0, so we need other 16224 requests, so <span style="text-decoration:underline;">in total 16224*2=32448 requests</span><br /><span style="color:#ff0000;">WARNING: Because i think these are would been too much requests for a lab, they are been decreased</span><br />To trigger an overflow we need only 162 requests in this lab<br />    <a href=""><img src="images/1885-5.png" alt="images/1885-5.png" /></a><br />    <a href=""><img src="images/1885-6.png" alt="images/1885-6.png" /></a><br />    <br />    <a href=""><img src="images/1885-7.png" alt="images/1885-7.png" /></a><br />    <a href=""><img src="images/1885-8.png" alt="images/1885-8.png" /></a><br /></div>
</body>
</html>
