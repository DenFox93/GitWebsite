<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>getsystem (meterpreter)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>getsystem (meterpreter)</h1><br /><strong>
      <h3>getsystem(until Windows 7)</h3>
    </strong><br />GitHub source code: <a
      href="https://github.com/rapid7/metasploit-payloads/tree/d672097e9989e0b4caecfad08ca9debc8e50bb0c/c/meterpreter/source/extensions/priv" target="_blank">https://github.com/rapid7/metasploit-payloads/tree/d672097e9989e0b4caecfad08ca9debc8e50bb0c/c/meterpreter/source/extensions/priv</a><br /><a
      href=""><img src="images/1082-1.png" alt="images/1082-1.png" /></a><br /><br /><br />When using exploits, you
    might gain access as only a local user. This limits what you can do on the target machine. You can use Meterpreters
    &#39;getsystem` command (<a
      href="https://github.com/rapid7/metasploit-payloads/blob/master/c/meterpreter/source/extensions/priv/elevate.c" target="_blank">https://github.com/rapid7/metasploit-payloads/blob/master/c/meterpreter/source/extensions/priv/elevate.c</a>)
    to elevate your permissions from a local administrator to SYSTEM.<br />• <a
      href="https://github.com/rapid7/metasploit-payloads/blob/master/c/meterpreter/source/extensions/priv/elevate.c" target="_blank">elevate.c</a><br />
    ◇ <a href=""><img src="images/1082-2.png" alt="images/1082-2.png" /></a> → function that get the information of the
    system<br /> ◇ <a href=""><img src="images/1082-3.png" alt="images/1082-3.png" /></a> → function that execute the
    windows privilege technique<br /> <em>elevate_getsystem</em> will execute these three elevation techniques in the
    following order until one succeed or all fail:<br /> ▪ <strong>Named Pipe Impersonation (In Memory/Admin)</strong> →
    function: <a
      href="https://github.com/rapid7/metasploit-payloads/blob/master/c/meterpreter/source/extensions/priv/namedpipe.c#L130" target="_blank">elevate_via_service_namedpipe</a><br />
    require local admin permissions<br /> <a
      href="https://github.com/rapid7/metasploit-payloads/blob/master/c/meterpreter/source/extensions/priv/namedpipe.c" target="_blank">https://github.com/rapid7/metasploit-payloads/blob/master/c/meterpreter/source/extensions/priv/namedpipe.c</a><br />
    1&gt; Creates a named pipe controlled by Meterpreter<br /> 2&gt; Then a cmd.exe is created as local system (running
    as SYSTEM) which runs a command that interacts directly with the named pipe.<br /> 3&gt; Meterpreter then
    impersonates the connected process to get an impersonation access token (with the SYSTEM security context).<br />
    4&gt; The access token is then assigned to all subsequent Meterpreter threads, meaning they run with SYSTEM
    privileges.<br /> ▪ <strong>Named Pipe Impersonation (Dropper/Admin)</strong> → function: <a
      href="https://github.com/rapid7/metasploit-payloads/blob/master/c/meterpreter/source/extensions/priv/namedpipe.c#L241" target="_blank">
      elevate_via_service_namedpipe2</a><br /> <span style="color:#ff0000;">require local admin permissions</span><br />
    <a
      href="https://github.com/rapid7/metasploit-payloads/blob/master/c/meterpreter/source/extensions/priv/namedpipe.c" target="_blank">https://github.com/rapid7/metasploit-payloads/blob/master/c/meterpreter/source/extensions/priv/namedpipe.c</a><br />
    Very similar to Named Pipe Impersonation (In Memory/Admin).<br /> 1&gt; Creates a named pipe controlled by
    Meterpreter<br /> 2&gt; instead of using a cmd.exe to create the SYSTEM user, it uses a DLL file written to the
    disk.<br /> 3&gt; runs rundll32.exe to run the DLL file as SYSTEM. <br /> 4&gt; The DLL file connects to Meterpreter
    and now you have SYSTEM permissions.<br /> ▪ <strong>Token Duplication (In Memory/Admin)</strong> → function: <a
      href="https://github.com/rapid7/metasploit-payloads/blob/master/c/meterpreter/source/extensions/priv/namedpipe.c#L241" target="_blank">elevate_via_service_tokendup</a><br />
    <span style="color:#ff0000;">requires the SeDebugPrivilege privilege, limited to x86 architectures.</span><br /> <a
      href="https://github.com/rapid7/metasploit-payloads/blob/master/c/meterpreter/source/extensions/priv/tokendup.c" target="_blank">https://github.com/rapid7/metasploit-payloads/blob/master/c/meterpreter/source/extensions/priv/tokendup.c</a><br />
    1&gt; finds a service running as SYSTEM which it injects a DLL into.<br /> 2&gt; The DLL duplicates the access token
    of the service and assigns it to Meterpreter.<br /> This is the only technique that does not have to create a
    service, and operates entirely in memory.<br /><br /><br /><span style="text-decoration:underline;">getsystem should
      not be thought of as a user -&gt; admin privilege escalation method in modern
      systems</span><br /><br />Bibliography:<br />• <a
      href="https://docs.rapid7.com/metasploit/meterpreter-getsystem/" target="_blank">https://docs.rapid7.com/metasploit/meterpreter-getsystem/</a>
  </div>
</body>

</html>