<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Manual encoding</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Manual encoding</h1><br/>Now we will see how <strong>manually edit</strong> the shellcode so that it does not contain string terminators. <br />In other words, we will use different instructions(without string terminators) to perform the same operations<br /><br /><strong><span style="color:#a5452a;">example 1:</span></strong><br />The goal is <span style="color:#00ff79;">PUSH</span> to the stack the string “<span style="color:#00dbff;">cmd</span>” which the hexadecimal instruction is <span style="color:#00ff79;">68</span><span style="color:#00dbff;">636d64</span><span style="color:#ff0000;">00</span>.<br />This mean have the<span style="color:#00dbff;"> hexadecimal value of cmd</span> with <span style="color:#ff0000;">string terminator</span>  (<span style="color:#00dbff;">636d64</span><span style="color:#ff0000;">00</span>) saved in a register(e.g.: EBX)in swapped order (<span style="color:#ff0000;">00</span><span style="color:#00dbff;">646d63</span>) because we are in the little-endian architecture. Usually the operation of swapping is done by the <span style="color:#00ff79;">PUSH</span> operation.<br /><strong><span style="color:#f6ff00;">Create Shellcode:</span></strong> because our Shellcode(the instructions) has to be NULL-free(without <span style="color:#ff0000;">00</span>) we have to <span style="color:#ff00c5;">subtract (or add) a value</span> to <span style="color:#a020f0;">another one</span> (both without <span style="color:#ff0000;">00</span>) in order to obtain as a result <span style="color:#ff0000;">00</span><span style="color:#00dbff;">646d63</span><br /><br />Obtain new values:<br />1. From <span style="color:#ff0000;">00</span><span style="color:#00dbff;">646d63</span> subtract a <span style="color:#ff00c5;">value</span>(without <span style="color:#ff0000;">00</span>)<br />    <span style="color:#ff0000;">00</span><span style="color:#00dbff;">646d63</span>-<span style="color:#ff00c5;">11111111</span>= <span style="color:#a020f0;">EF535C52</span><br />2. verify that the result does not contain <span style="color:#ff0000;">00</span><br />    <span style="color:#a020f0;">EF535C52</span><br /><span style="color:#f6ff00;">Create shellcode:</span><br />• Instead of the original:<br />    <code>&quot;</code><code><span style="color:#00ff79;">\x68</span></code><code><span style="color:#00dbff;">\x63\x6D\x64</span></code><code><span style="color:#ff0000;">\x00</span></code><code>&quot;            // PUSH &quot;cmd&quot;<br /></code>    <code>&quot;\x8B\xDC&quot;                        // MOV EBX, ESP → puts the pointer to the text &quot;cmd&quot; into ebx</code><br />• Now we have:<br />    1. Moves <span style="color:#a020f0;">EF535C52</span> into a register(e.g.: EBX)<br />        <div class="codebox"><div class="codebox">&quot;\x33\xDB&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//XOR&nbsp;EBX,EBX:&nbsp;zero&nbsp;out&nbsp;EBX<br />&quot;\xbb\x52\x5c\x53\xef&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//MOV&nbsp;EBX,&nbsp;EF535C52</div></div><br />    2. Adds back 11111111 to the register (in order to obtain <span style="color:#ff0000;">00</span><span style="color:#00dbff;">646d63</span> )<br />        <div class="codebox"><div class="codebox">&quot;\x81\xC3\x11\x11\x11\x11&quot;&nbsp;//ADD&nbsp;EBX,&nbsp;11111111&nbsp;--&gt;&nbsp;now&nbsp;EBX&nbsp;contains&nbsp;00646d63</div></div><br />    3. PUSH the register(e.g.: EBX) to the stack<br />        <div class="codebox"><div class="codebox">&quot;\x53&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//PUSH&nbsp;EBX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;push&nbsp;to&nbsp;the&nbsp;stack&nbsp;the&nbsp;string&nbsp;&quot;cmd&quot;<br />&quot;\x8B\xDC&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//MOV&nbsp;EBX,&nbsp;ESP&nbsp;--&gt;&nbsp;now&nbsp;EBX&nbsp;does&nbsp;not&nbsp;contain&nbsp;anymore&nbsp;the&nbsp;string&nbsp;&quot;cmd&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;but&nbsp;like&nbsp;ESP&nbsp;now&nbsp;have&nbsp;a&nbsp;pointer&nbsp;to&nbsp;the&nbsp;address<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;stack&nbsp;that&nbsp;contain&nbsp;the&nbsp;string&nbsp;&quot;cmd&quot;&nbsp;<br /></div></div><br /><br /><strong><span style="color:#a5452a;">example 2:</span></strong><br />The goal is PUSH to the stack the string “<span style="color:#00dbff;">open</span>” which hexadecimal instructions are:<br /><span style="color:#8eff00;">6A</span><span style="color:#ff0000;">00</span><br /><span style="color:#00ff79;">68</span><span style="color:#00dbff;">6F70656E</span><br /><strong><span style="color:#f6ff00;">Create Shellcode:</span></strong> When we <span style="color:#ff0000;">ZERO out</span> a register(<span style="color:#ff0000;">00000000</span>) and then we PUSH it to the stack, this register(because formed by 0) contains already a <span style="color:#ff0000;">string terminator</span> for the string &quot;<span style="color:#00dbff;">open</span>&quot;<br />• Instead of the original:<br />    <code>&quot;</code><code><span style="color:#8eff00;">\x6A</span></code><code><span style="color:#ff0000;">\x00</span></code><code>&quot;                       // PUSH the string terminator for &#39;open&#39;<br /></code>    <code>&quot;</code><code><span style="color:#00ff79;">\x68</span></code><code><span style="color:#00dbff;">\x6f\x70\x65\x6e</span></code><code>&quot;           // PUSH &quot;open&quot; onto the stack<br /></code>    <code>&quot;\x8B\xCC&quot;                       // MOV ECX, ESP → puts ECX a pointer to &#39;open&#39; that reside on the stack</code><br />• Now we have:<br />    1. <span style="color:#ff0000;">ZERO out</span> a register (e.g.: EAX)<br />        <div class="codebox"><div class="codebox">&quot;\x33\xC0&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;XOR&nbsp;EAX,&nbsp;EAX&nbsp;&nbsp;&nbsp;--&gt;&nbsp;zero&nbsp;out&nbsp;eax</div></div><br />    3. PUSH the register to the stack<br />        <div class="codebox"><div class="codebox">&quot;\x50&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;PUSH&nbsp;EAX&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;--&gt;&nbsp;push&nbsp;to&nbsp;the&nbsp;stack&nbsp;00000000&nbsp;that&nbsp;work&nbsp;as&nbsp;string<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;terminator&nbsp;for&nbsp;open</div></div><br />    5. PUSH string “open” to the stack<br />        <div class="codebox"><div class="codebox">&quot;\x68\x6f\x70\x65\x6e&quot;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;PUSH&nbsp;the&nbsp;string&nbsp;&quot;open&quot;&nbsp;to&nbsp;the&nbsp;stack<br />&quot;\x8B\xCC&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;MOV&nbsp;ECX,&nbsp;ESP&nbsp;&nbsp;&nbsp;--&gt;&nbsp;now&nbsp;ECX&nbsp;like&nbsp;ESP&nbsp;have&nbsp;pointer&nbsp;to&nbsp;the&nbsp;address<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;of&nbsp;the&nbsp;stack&nbsp;that&nbsp;contain&nbsp;the&nbsp;string&nbsp;&quot;cmd&quot;&nbsp;</div></div><br /><br /><br /><br /><br /><br /><br /></div>
</body>
</html>
