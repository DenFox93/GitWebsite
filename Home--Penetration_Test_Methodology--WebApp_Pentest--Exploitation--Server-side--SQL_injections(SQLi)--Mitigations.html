<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Mitigations</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Mitigations</h1><br />SQLi vulnerabilities are input validation vulnerabilities and can be
    prevented by enforcing input validation on any user-controlled parameter.<br /><br /><strong>Using Prepared
      Statements (with Parameterized Queries)</strong><br />The SQL Command uses a parameter instead of inserting the
    values directly into the command, thus prevent the backend from running malicious queries that are harmful to the
    database. So if the user entered <code>12345 or 1=1</code> as the input, the parameterized query would search in the
    table for a match with the entire string <code>12345 or 1=1</code>.<br /><span style="color:#a5452a;">PHP example
      1</span><br />
    <div class="codebox">
      <div class="codebox">
        $stmt&nbsp;=&nbsp;$dbh-&gt;prepare(&#39;SELECT&nbsp;*&nbsp;FROM&nbsp;customers&nbsp;WHERE&nbsp;ssn&nbsp;=&nbsp;:ssn&#39;);<br />$stmt-&gt;&nbsp;bindParam(&#39;:ssn&#39;&nbsp;=&gt;&nbsp;$ssn);
      </div>
    </div><br /><span style="color:#a5452a;">PHP example 2</span><br />
    <div class="codebox">
      <div class="codebox">
        $sql&nbsp;=&nbsp;&quot;INSERT&nbsp;INTO&nbsp;test_table&nbsp;VALUES&nbsp;(?,&nbsp;?,&nbsp;?,&nbsp;?)&quot;;<br />$sql_statement&nbsp;=&nbsp;$mysqli-&gt;prepare($sql);<br />$sql_statement-&gt;bind_param(&#39;dsss&#39;,&nbsp;$user_id,&nbsp;$name,&nbsp;$address,&nbsp;$email);<br />$user_id&nbsp;=&nbsp;$_POST[&#39;user_id&#39;];<br />$name&nbsp;=&nbsp;$_POST[&#39;name&#39;];<br />$address&nbsp;=&nbsp;$_POST[&#39;address&#39;];<br />$email&nbsp;=&nbsp;$_POST[&#39;email&#39;];<br />$sql_statement-&gt;execute();
      </div>
    </div><br /><br /><strong>Input Validation</strong><br />Even when you are using Prepared Statements, you should do
    an input validation first to make sure the value is of the accepted type, length, format, etc. Only the input which
    passed the validation can be processed to the database<br /><span style="color:#a5452a;">PHP example integer
      validation numbers</span><br />
    <div class="codebox">
      <div class="codebox">$user_id&nbsp;=&nbsp;(int)&nbsp;$user_id;</div>
    </div><br /><span style="color:#a5452a;">PHP example white-list based validation</span><br />Only letters, spaces
    and dashes are allowed<br />
    <div class="codebox">
      <div class="codebox">if&nbsp;(!preg_match(|&#39;^[a-z\s-]$|i&#39;,&nbsp;$name))&nbsp;<span
          style="color:#000000;font-weight:400">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;die(&#39;Please&nbsp;enter&nbsp;a&nbsp;valid&nbsp;name&#39;);<br /><span
          style="color:#000000;font-weight:400">}</span></div>
    </div><br /><br /><strong>Sanitize Input</strong><br /><br /><br />Bibliography:<br />• <a
      href="https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html" target="_blank">https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html</a><br />•
    <a
      href="https://tableplus.com/blog/2018/08/best-practices-to-prevent-sql-injection-attacks.html" target="_blank">https://tableplus.com/blog/2018/08/best-practices-to-prevent-sql-injection-attacks.html</a>
  </div>
</body>

</html>