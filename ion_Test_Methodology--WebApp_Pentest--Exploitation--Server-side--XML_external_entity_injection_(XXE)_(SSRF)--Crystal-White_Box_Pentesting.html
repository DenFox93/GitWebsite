<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Crystal/White Box Pentesting</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Crystal/White Box Pentesting</h1><br /><br /><a href=""><img src="images/1570-1.png"
        alt="images/1570-1.png" /></a><br /><br />Note: Burp Suite and ZAP will see the interaction between index.html
    and entry.php (because that data will pass through the interception proxy), but they will not see the interaction
    between entry.php and xml.php (that data is sent server -&gt; server).<br /><br />index.html<br />
    <div class="codebox">
      <div class="codebox">
        &lt;html&gt;<br />&lt;body&nbsp;background=&quot;/images/hubble.jpg&quot;&gt;<br />&lt;H1&gt;The&nbsp;Hitchhiker&#39;s&nbsp;Guide&nbsp;to&nbsp;the&nbsp;GalaXXE&lt;/H1&gt;<br />Welcome&nbsp;to&nbsp;the&nbsp;The&nbsp;Hitchhiker&#39;s&nbsp;Guide&nbsp;to&nbsp;the&nbsp;GalaXXE:&nbsp;we&nbsp;were&nbsp;Wikipedia&nbsp;a&nbsp;billion&nbsp;years&nbsp;before&nbsp;Wikipedia!&lt;br&gt;&lt;br&gt;<br />This&nbsp;is&nbsp;our&nbsp;new&nbsp;article&nbsp;creation&nbsp;form:&nbsp;please&nbsp;help&nbsp;expand&nbsp;the&nbsp;universe&#39;s&nbsp;knowledge&nbsp;by&nbsp;creating&nbsp;an&nbsp;article.&lt;br&gt;&lt;br&gt;<br />&lt;form&nbsp;method=&quot;post&quot;&nbsp;action=entry.php&gt;<br /><br />Subject:&nbsp;&lt;br&gt;<br />&lt;input&nbsp;type&nbsp;=&nbsp;&quot;text&quot;&nbsp;name&nbsp;=&nbsp;&quot;subject&quot;&gt;&lt;br&gt;&lt;br&gt;<br />Category:&nbsp;&lt;br&gt;<br />&lt;input&nbsp;type&nbsp;=&nbsp;&quot;text&quot;&nbsp;name&nbsp;=&nbsp;&quot;category&quot;&gt;&lt;br&gt;&lt;br&gt;<br />Text:&nbsp;&lt;br&gt;<br />&lt;input&nbsp;type&nbsp;=&nbsp;&quot;text&quot;&nbsp;name&nbsp;=&nbsp;&quot;text&quot;&gt;&lt;br&gt;&lt;br&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;input&nbsp;type=&quot;submit&quot;&nbsp;name=&quot;submit&quot;&nbsp;value=&quot;submit&quot;&gt;<br />&lt;/form&gt;<br />&lt;/body&gt;<br />&lt;/html&gt;<br />
      </div>
    </div><br /><br />entry.php<br />
    <div class="codebox">
      <div class="codebox">
        &lt;?php<br />$xmlstr&nbsp;=&nbsp;&lt;&lt;&lt;XML<br />&lt;?xml&nbsp;version=&quot;1.0&quot;?&gt;<br />&lt;entry&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;subject&gt;&lt;/subject&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;category&gt;&lt;/category&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;&lt;text&gt;&lt;/text&gt;<br />&lt;/entry&gt;<br />XML;<br /><br />if(isset($_POST[&#39;submit&#39;]))&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;$xml&nbsp;=&nbsp;new&nbsp;SimpleXMLElement($xmlstr);<br />&nbsp;&nbsp;&nbsp;&nbsp;$xml-&gt;subject=$_POST[&quot;subject&quot;];<br />&nbsp;&nbsp;&nbsp;&nbsp;$xml-&gt;category=$_POST[&quot;category&quot;];<br />&nbsp;&nbsp;&nbsp;&nbsp;$xml-&gt;text=$_POST[&quot;text&quot;];<br />&nbsp;&nbsp;&nbsp;&nbsp;$xmlstr=$xml-&gt;asXML();<br />&nbsp;&nbsp;&nbsp;&nbsp;$url&nbsp;=&nbsp;&#39;http://www.example.org/guide/xml.php&#39;;<br />&nbsp;&nbsp;&nbsp;&nbsp;$ch&nbsp;=&nbsp;curl_init();<br />&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt(&nbsp;$ch,&nbsp;CURLOPT_URL,&nbsp;$url&nbsp;);<br />&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt(&nbsp;$ch,&nbsp;CURLOPT_POST,&nbsp;true&nbsp;);<br />&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt(&nbsp;$ch,&nbsp;CURLOPT_HTTPHEADER,&nbsp;array(&#39;Content-Type:&nbsp;text/xml&#39;));<br />&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt(&nbsp;$ch,&nbsp;CURLOPT_RETURNTRANSFER,&nbsp;true&nbsp;);<br />&nbsp;&nbsp;&nbsp;&nbsp;curl_setopt(&nbsp;$ch,&nbsp;CURLOPT_POSTFIELDS,&nbsp;$xmlstr&nbsp;);<br />&nbsp;&nbsp;&nbsp;&nbsp;$result&nbsp;=&nbsp;curl_exec($ch);<br />&nbsp;&nbsp;&nbsp;&nbsp;curl_close($ch);<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#39;&lt;html&gt;&lt;body&nbsp;background=&quot;/images/hubble.jpg&quot;&gt;&lt;H1&gt;Thank&nbsp;you!!&lt;/H1&gt;&#39;;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;$result;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#39;&lt;br&gt;&lt;br&gt;&lt;a&nbsp;href=&quot;index.html&quot;&gt;Click&nbsp;here&lt;/a&gt;&nbsp;to&nbsp;make&nbsp;another&nbsp;entry&#39;;<br />&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&#39;&lt;/body&gt;&lt;/html&gt;&#39;;<br />}<br /><br />?&gt;
      </div>
    </div><br /><br />xml.php<br />
    <div class="codebox">
      <div class="codebox">
        &lt;?php<br />libxml_disable_entity_loader&nbsp;(false);<br />$xmlfile&nbsp;=&nbsp;file_get_contents(&#39;php://input&#39;);<br />$dom&nbsp;=&nbsp;new&nbsp;DOMDocument();<br />$dom-&gt;loadXML($xmlfile,&nbsp;LIBXML_NOENT&nbsp;|&nbsp;LIBXML_DTDLOAD);<br />$xml&nbsp;=&nbsp;simplexml_import_dom($dom);<br />$subject&nbsp;=&nbsp;$xml-&gt;subject;<br />$category&nbsp;=&nbsp;$xml-&gt;category;<br />$text&nbsp;=&nbsp;$xml-&gt;text;<br /><br />echo&nbsp;&quot;Thank&nbsp;you&nbsp;for&nbsp;your&nbsp;Hitchhiker&#39;s&nbsp;Guide&nbsp;to&nbsp;the&nbsp;GalaXXE&nbsp;Submission!!&lt;br&gt;&lt;br&gt;&quot;;<br />echo&nbsp;&quot;Your&nbsp;entry:&lt;br&gt;&lt;br&gt;&quot;;<br />echo&nbsp;&quot;Subject:&nbsp;&quot;&nbsp;.&nbsp;$subject&nbsp;.&nbsp;&quot;&lt;br&gt;&quot;;<br />echo&nbsp;&quot;Category:&nbsp;&quot;&nbsp;.&nbsp;$category&nbsp;.&nbsp;&quot;&lt;br&gt;&quot;;<br />echo&nbsp;&quot;Text:&nbsp;&quot;&nbsp;.&nbsp;$text&nbsp;.&nbsp;&quot;&lt;br&gt;\n&quot;;<br />?&gt;<br />
      </div>
    </div><br /> <span style="color:#ff0000;">VULNERABLE CODE:</span><br /> ◇
    <code>libxml_disable_entity_loader (false);</code> → If set to True &quot;libxml_disable_entity_loader&quot; is used
    to prevent XML eXternal Entity Injection, the best way is to check the validity of xml by yourself<br /> ◇
    <code>$dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD);</code><br /> ▪ <code>LIBXML_NOENT</code> → allow
    loading XML entities <br /> ▪ <code>LIBXML_DTDLOAD</code> → allow/deny loading external entities <br /> <span
      style="color:#1e90ff;">PREVENT VULNERABILITY:</span><br /> ◇
    <code>factory.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;, true);</code> → disable
    DTDs (External Entities) completely. Suggested by OWASP (<a
      href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html" target="_blank">here</a>)<br />
    <br /> <br /> For a complete prevention vulnerabilities tricks see: <a
      href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html" target="_blank">https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html</a>
    <br /> ◇ C/C++: If the Web Application use a version of the library <strong>libxml2</strong> before 2.9, XXE is
    enabled by default (<a
      href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html#:~:text=Note:" target="_blank">source</a>)<br />
    <br /> <br /> <br /> <br />
  </div>
</body>

</html>