<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Forge TCP packet</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Forge TCP packet</h1><br /><br /><strong>
      <h3>TCPPacket class</h3>
    </strong> (<a
      href="https://github.com/todb/packetfu/blob/master/lib/packetfu/protos/tcp.rb" target="_blank">https://github.com/todb/packetfu/blob/master/lib/packetfu/protos/tcp.rb</a>)<br /><br />
    <div class="codebox">
      <div class="codebox">require&nbsp;&quot;packetfu&quot;<br />include&nbsp;PacketFu</div>
    </div><br /><a href=""><img src="images/1970-1.png" alt="images/1970-1.png" /></a><br /><br /><strong>To send an TCP
      packet you need to set the following fields</strong><br /> ◇ eth_saddr → source MAC address<br /> ▪ Check
    Utils.whoami?[:eth_saddr]<br /> <a href=""><img src="images/1970-2.png" alt="images/1970-2.png" /></a><br /> ◇
    eth_daddr → destination MAC address <br /> ▪ destination <span style="text-decoration:underline;">outside</span> our
    local network → MAC address of the default gateway<br /> - Check Utils.whoami?[:eth_daddr]<br /> <a href=""><img
        src="images/1970-3.png" alt="images/1970-3.png" /></a><br /> ▪ destination <span
      style="text-decoration:underline;">inside</span> of the local network → MAC address of the destination<br /> -
    Utils.arp(&quot;[IP_Address_destination]&quot;)<br /> <a href=""><img src="images/1970-4.png"
        alt="images/1970-4.png" /></a><br /> ◇ ip_daddr → destination address<br /> ◇ ip_saddr → source address<br /> ◇
    tcp_sport → source TCP port<br /> ◇ tcp_dport → destination TCP port<br /> ◇ tcp_flags.syn → Only if we want to do a
    SYN scan (nmap -sS) instead of a normal<br /><br />
    <div class="codebox">
      <div class="codebox">
        t=&nbsp;TCPPacket.new<br />t.eth_saddr=&quot;00:0c:29:90:45:a8&quot;&nbsp;&nbsp;#source&nbsp;MAC&nbsp;address<br />t.eth_daddr=&quot;00:0c:29:f3:2e:04&quot;&nbsp;&nbsp;#destination&nbsp;MAC&nbsp;address<br />t.ip_saddr=&quot;192.168.3.136&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#ip&nbsp;source&nbsp;address<br />t.ip_daddr=&nbsp;&quot;192.168.3.137&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#ip&nbsp;destination&nbsp;address<br />t.tcp_sport=5000&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#source&nbsp;TCP&nbsp;port<br />t.tcp_dport=80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#destination&nbsp;TCP&nbsp;port<br />t.tcp_flags.syn=1&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#Only&nbsp;if&nbsp;we&nbsp;want&nbsp;to&nbsp;do&nbsp;a&nbsp;SYN&nbsp;scan<br />t.recalc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#use&nbsp;first&nbsp;always&nbsp;recalc,&nbsp;in&nbsp;order&nbsp;to&nbsp;calculate&nbsp;the<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;checksum&nbsp;of&nbsp;the&nbsp;modified&nbsp;packet<br />t.to_w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#To&nbsp;send&nbsp;the&nbsp;packet<br />
      </div>
    </div><br /> <a href=""><img src="images/1970-5.png" alt="images/1970-5.png" /></a><br /> <a href=""><img
        src="images/1970-6.png" alt="images/1970-6.png" /></a><br /> <a href=""><img src="images/1970-7.png"
        alt="images/1970-7.png" /></a><br /> <a href=""><img src="images/1970-8.png"
        alt="images/1970-8.png" /></a><br /> <a href=""><img src="images/1970-9.png"
        alt="images/1970-9.png" /></a><br /> <br /> <br /><strong>Set our parameters automatically (no
      spoofing)</strong><br /><span style="color:#ff0000;">WARNING if the destination is in the local network:</span>
    this method will set the <span style="text-decoration:underline;">destination MAC address(eth_daddr/eth_dst)</span>
    at the default gateway, but if the target is inside the local network, we need to set directly the MAC address of
    the target and not of the default gateway.<br />• eth_saddr → source MAC address<br />• eth_daddr →
    destination MAC address<br />• ip_saddr → ip source address<br />with this command:<br />
    <div class="codebox">
      <div class="codebox">t=TCPPacket.new<span
          style="color:#000000;font-weight:400">(</span>:config&nbsp;=&gt;&nbsp;Utils.whoami?<span
          style="color:#000000;font-weight:400">)</span></div>
    </div><br /> <a href=""><img src="images/1970-10.png" alt="images/1970-10.png" /></a><br /> <br /><br /><strong>TCP
      SYN scan</strong>: port scanner that avoids finalizing the tcp 3-way handshake. Like when we use <a
      href="Test_Methodology--Network_Pentest--Scanning_and_Enumeration--Port_Scanning_(on_hosts_alive)--nmap_[-s]--SCAN_TECHNIQUES---sS_TCP_SYN_Scan.html">nmap
      -sS</a> instead of <a
      href="_Methodology--Network_Pentest--Scanning_and_Enumeration--Port_Scanning_(on_hosts_alive)--nmap_[-s]--SCAN_TECHNIQUES---sT_TCP_Connect_Scan.html">nmap
      -sT</a><br /> ◇ TCP SYN scan<br /> <a href=""><img src="images/1970-11.png" alt="images/1970-11.png" /></a><br />
    <a href="file://C:/CherryTree/screenshots2/PTP-elearnsecurity/2. Network Security/2. Scanning/-sS_port_open.png"><img
        src="images/1970-12.png" alt="images/1970-12.png" /></a><a href=""><img src="images/1970-13.png"
        alt="images/1970-13.png" /></a><br /> ◇ TCP Connect Scan<br /> <a
      href="file://C:/CherryTree/screenshots2/PTP-elearnsecurity/2. Network Security/2. Scanning/-sT.png"><img
        src="images/1970-14.png" alt="images/1970-14.png" /></a><br /> <br />
  </div>
</body>

</html>