<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>5. Scheduled Tasks</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>5. Scheduled Tasks</h1><br /><strong>
      <h3>Scheduled Tasks</h3>
    </strong><br />• Windows can be configured to run tasks at specific times, periodically (e.g. every 5 mins) or when
    triggered by some event (e.g. a user logon).<br />• Tasks usually run with the privileges of the user who created
    them, however administrators can configure tasks to run as other users, including
    SYSTEM.<br /><br /><br /><strong>List all scheduled tasks </strong><strong><span
        style="text-decoration:underline;">our user can see</span></strong><strong>(not all of
      them!)</strong>:<br />Unfortunately, there is no easy method for enumerating custom tasks that belong to other
    users as a low privileged user account.<br /><br /> ◇ All scheduled tasks<br />
    <div class="codebox">
      <div class="codebox">
        #cmd<br />C:\&gt;&nbsp;schtasks&nbsp;/query&nbsp;/fo&nbsp;LIST&nbsp;2&gt;nul&nbsp;|&nbsp;findstr&nbsp;TaskName
      </div>
    </div><br /> ◇ All scheduled tasks, excluded the ones of microsoft<br />
    <div class="codebox">
      <div class="codebox">
        #powershell<br />PS&gt;&nbsp;Get-ScheduledTask&nbsp;|&nbsp;where&nbsp;{$_.TaskPath&nbsp;-notlike&nbsp;&quot;\Microsoft*&quot;}&nbsp;|&nbsp;ft&nbsp;TaskName,TaskPath,State
      </div>
    </div><br /> <br />Often anyway we have to rely on other clues, such as finding files that indicates a scheduled
    task is being run:<br />• scripts<br /> ◇ powershell<br /> \*\*\*,\*\*,\* will limit the depth to 2 (source: <a
      href="https://stackoverflow.com/questions/13249085/limit-get-childitem-recursion-depth" target="_blank">stackoverflow</a>)<br />
    <div class="codebox">
      <div class="codebox">
        PS&gt;&nbsp;cd&nbsp;C:\<br />PS&gt;&nbsp;Get-ChildItem&nbsp;-Path&nbsp;\*\*\*,\*\*,\*&nbsp;&nbsp;-Filter&nbsp;*.bat&nbsp;-ErrorAction&nbsp;SilentlyContinue<br />PS&gt;&nbsp;Get-ChildItem&nbsp;-Path&nbsp;\*\*\*,\*\*,\*&nbsp;&nbsp;-Filter&nbsp;*.ps1&nbsp;-ErrorAction&nbsp;SilentlyContinue<br />
      </div>
    </div><br />• logs <br /><br />We have seen how to schedule a task <a
      href="lation--Windows_Authentication_attacks--Kerberos--Silver_Ticket--Forge_Silver_Ticket--HOST_service--Schedule_Reverse_Powershell(option_1).html">here
      in Active Directory Post Exploitation</a>
  </div>
</body>

</html>