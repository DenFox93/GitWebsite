<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>create a Shellcode</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>create a Shellcode</h1><br/><br /><strong>1. Assembly code(ASM)</strong><br />The below ASM code first push the parameter to the stack and then call the function that we want by using its address found before<br /><div class="codebox"><div class="codebox">xor&nbsp;eax,eax&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;zero&nbsp;out&nbsp;the&nbsp;eax&nbsp;register<br />mov&nbsp;eax,&nbsp;&lt;parameter-for-the-function&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;move&nbsp;the&nbsp;parameter&nbsp;value&nbsp;into&nbsp;eax<br />push&nbsp;eax;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;push&nbsp;the&nbsp;function&nbsp;parameter&nbsp;onto&nbsp;the&nbsp;stack<br />mov&nbsp;ebx,&nbsp;&lt;address-function&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;move&nbsp;the&nbsp;address&nbsp;of&nbsp;the&nbsp;function&nbsp;that&nbsp;we&nbsp;want&nbsp;to&nbsp;call&nbsp;into&nbsp;ebx<br />call&nbsp;ebx&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;;&nbsp;call&nbsp;the&nbsp;function&nbsp;</div></div><br /><br /><strong>2. </strong><a href="Home--Penetration_Test_Methodology--System_Security_(Windows_&_Linux)--Assemblers,_Debuggers_and_Tools--Assembler.html">Assembly the ASM code</a><br /><div class="codebox"><div class="codebox">nasm&nbsp;-f&nbsp;win32&nbsp;file.asm&nbsp;-o&nbsp;file.obj</div></div><br />    -f → <span style="text-decoration:underline;">format</span> of the output file; in this case Microsoft object file format for 32-bit OS<br />    -o → name of the <span style="text-decoration:underline;">output</span> file<br />    <br /><strong>3. </strong><a href="Home--Penetration_Test_Methodology--System_Security_(Windows_&_Linux)--Assemblers,_Debuggers_and_Tools--Decompiler--objdump_(Dev-C++).html">Disassemble the object file</a><br />We want know the Opcode(hexadecimal values) of our assembly code<br /><div class="codebox"><div class="codebox">objdump&nbsp;-d&nbsp;-Mintel&nbsp;file.obj</div></div><br />• <strong>-d </strong>→  tells the tool to disassemble the input file<br />• <strong>-Mintel </strong>→ is a disassembler option that allows us to select disassembly for the given architecture (Intel in our case)<br /><br /><a href=""><img src="images/532-1.png" alt="images/532-1.png" /></a><br /><span style="color:#ff8700;">0x1388</span> is our parameter for the function<br /><span style="color:#ff8700;">0x777DC266</span> is the address of the function that we want call<br /><br /><strong>4. Create the Shellcode</strong><br />To create the shellcode we need to <strong>remove the spaces</strong> and add the <strong>\x</strong> prefix to the <span style="color:#00ff00;">Opcode</span> obtained<br /><div class="codebox"><div class="codebox">\x31\xc0<br />\xb8\x88\x13\x00\x00<br />\x50<br />\xbb\x66\xc2\x7d\x77<br />\xff\xd3</div></div><br /><br /><strong>5. Test if the Shellcode works</strong><br />To test if the shellcode works we need to Compile the C++ file seen also <a href="Home--Penetration_Test_Methodology--System_Security_(Windows_&_Linux)--Shellcoding--Test_if_a_Shellcode_works.html">here</a> <br />Because ASLR is enabled(address randomization) the below code work only on the Windows 7 machine tested <br /><div class="codebox"><div class="codebox">char&nbsp;code[]&nbsp;=&nbsp;<br />&quot;\x31\xc0&quot;<br />&quot;\xb8\x88\x13\x00\x00&quot;<br />&quot;\x50&quot;<br />&quot;\xbb\x66\xc2\x7d\x77&quot;<br />&quot;\xff\xd3&quot;;<br /><br /><br />int&nbsp;main(int&nbsp;argc,&nbsp;char&nbsp;**argv)&nbsp;<br /><span style="color:#000000;font-weight:400">{</span>&nbsp;<br />&nbsp;&nbsp;int&nbsp;(*func)();&nbsp;<br />&nbsp;&nbsp;func&nbsp;=&nbsp;(int&nbsp;(*)())&nbsp;code;&nbsp;<br />&nbsp;&nbsp;(int)(*func)();&nbsp;<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /></div>
</body>
</html>
