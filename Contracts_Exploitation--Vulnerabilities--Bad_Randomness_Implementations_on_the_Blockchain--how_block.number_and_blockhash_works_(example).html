<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>how block.number and blockhash works (example)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>how block.number and blockhash works (example)</h1><br/>Type this code on Remix<br />    <div class="codebox"><div class="codebox">pragma&nbsp;solidity&nbsp;^0.6.6;<br /><br />contract&nbsp;simpleVulnerableBlockHash&nbsp;<span style="color:#000000;font-weight:400">{</span><br />&nbsp;&nbsp;uint32&nbsp;public&nbsp;block_number;<br />&nbsp;&nbsp;bytes32&nbsp;public&nbsp;checkHash;<br />&nbsp;<br />&nbsp;&nbsp;function&nbsp;get_block_number()&nbsp;public&nbsp;&nbsp;{&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;block_number&nbsp;=&nbsp;uint32(block.number);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//Querying&nbsp;for&nbsp;the&nbsp;current&nbsp;block&nbsp;number<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//This&nbsp;is&nbsp;the&nbsp;current&nbsp;block&nbsp;number&nbsp;running&nbsp;on&nbsp;the&nbsp;blockchain<br />&nbsp;&nbsp;}<br />&nbsp;<br />&nbsp;&nbsp;function&nbsp;check_hash()&nbsp;public{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;checkHash&nbsp;=&nbsp;bytes32(blockhash(block_number));&nbsp;&nbsp;&nbsp;//takes&nbsp;the&nbsp;block&nbsp;number&nbsp;and&nbsp;uses&nbsp;it&nbsp;with&nbsp;the&nbsp;blockhash<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;}<br />&nbsp;<br />&nbsp;&nbsp;function&nbsp;wasteTime()&nbsp;public{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;uint&nbsp;test&nbsp;=&nbsp;uint(block.number);<br />&nbsp;&nbsp;}<br />&nbsp;<br /><span style="color:#000000;font-weight:400">}</span></div></div><br />    In Remix the functions are in orange while the variables are in blue<br />    <a href=""><img src="images/1436-1.png" alt="images/1436-1.png" /></a><br />    <br /><br />Action Steps:<br />0. When we deploy the contract, a transaction is been made<br />    <a href=""><img src="images/1436-2.png" alt="images/1436-2.png" /></a><br />    first operation(block_number=1) is the creation of the contract<br />1. Execute the <strong><span style="color:#ff8700;">get_block_number</span></strong>  and <strong><span style="color:#ff8700;">check_hash</span></strong> functions.<br />    <a href=""><img src="images/1436-3.png" alt="images/1436-3.png" /></a>   <br />    <a href=""><img src="images/1436-4.png" alt="images/1436-4.png" /></a><br />    <a href=""><img src="images/1436-5.png" alt="images/1436-5.png" /></a><br />    <a href=""><img src="images/1436-6.png" alt="images/1436-6.png" /></a><br />3. Check the <strong><span style="color:#1e90ff;">block_number</span></strong> and the <strong><span style="color:#1e90ff;">CheckHash</span></strong> values<br />    <a href=""><img src="images/1436-7.png" alt="images/1436-7.png" /></a> <a href=""><img src="images/1436-8.png" alt="images/1436-8.png" /></a><br />    <a href=""><img src="images/1436-9.png" alt="images/1436-9.png" /></a><br />    Note that the <strong><span style="color:#1e90ff;">checkHash</span></strong> number is relative to the block 2 transaction of <strong><span style="color:#ff8700;">get_block_number</span></strong>, while on the blockchain a block 3 transaction is been created by the same function <strong><span style="color:#ff8700;">check_hash</span></strong>. Every time we call a function a new block is created<br /><br />5. Execute the <strong><span style="color:#ff8700;">wasteTime</span></strong> function 256 times(in this case we need to be to arrive at 256+3=259) or more<br />    <br />7. Execute the <strong><span style="color:#ff8700;">check_hash</span></strong> function. This will be executed on the old <strong><span style="color:#1e90ff;">block_number</span></strong>(because we did not get a new one)<br />    <a href=""><img src="images/1436-10.png" alt="images/1436-10.png" /></a><br />9. Check <strong><span style="color:#1e90ff;">checkHash</span></strong> variable value.<br />    <a href=""><img src="images/1436-11.png" alt="images/1436-11.png" /></a><br />   We can see that we ended up with a value of zero, because the block_numbers are discarded after 256 and return a result of zero<br /><br /><span style="color:#393939;"> </span><br />The problem with block.number(and so whit blockhash) is: if a block is older than 256 blocks when it is hashed it will return a result of zero. This because Ethereum has short term memory when we talk about blocks.<br /><br /></div>
</body>
</html>
