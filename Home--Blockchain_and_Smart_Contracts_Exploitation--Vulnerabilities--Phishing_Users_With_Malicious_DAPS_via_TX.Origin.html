<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Phishing Users With Malicious DAPS via TX.Origin</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Phishing Users With Malicious DAPS via TX.Origin</h1><br/><br /><strong>Tx.Origin</strong> is an indirect attack method an attacker can utilize to bypass authorization based on the nuance of: <br />    “<span style="text-decoration:underline;">what is actually checked</span> VS <span style="text-decoration:underline;">what the developer think is checked</span>” <br />    when implementing a require statement with <strong>Tx.Origin</strong> for authorization.<br /><br />There are two ways to check the address of who is calling a contract:<br />   ◇ <strong>Msg.sender</strong><br />   ◇ <strong>Tx.Origin</strong><br /> <br />While both <strong>Msg.sender</strong> and <strong>Tx.Originof</strong> could produce the same output when directly calling a contract, they may differ when there is another contract in the middle of the transaction. <br /><span style="color:#a5452a;">example:</span> if an online game calls another contract to handle a payout transaction. <br />         - msg.sender →  the payout would go to the games address that called the payout contract.<br />         - tx.origin → the payout would go all the way back to the original user&#39;s address that processed the payout transaction on the game rather than the game contract making the call.<br /> <br /><br /><strong><h3>Man In the Middle via Tx.Origin</h3></strong><br />When a <span style="text-decoration:underline;">Tx.Origin</span> check is used instead of <span style="text-decoration:underline;">Msg.sender</span>, this can leave a contract open to a man-in-the-middle (MITM) attack vector.<br /><a href=""><img src="images/1425-1.png" alt="images/1425-1.png" /></a><br /><strong><span style="color:#a020f0;">TARGET CONTRACT</span></strong><strong> CALLED DIRECTLY</strong><br />If an user/attacker call the <span style="color:#a020f0;">TARGET CONTRACT</span> <span style="text-decoration:underline;">directly</span> his authorization would be checked based on his personal address value regardless if the check is being performed via msg.sender or tx.orgin. <br /><br /><strong><span style="color:#a020f0;">TARGET CONTRACT</span></strong><strong> CALLED INDIRECTLY WITH TX.ORIGIN</strong> <br />If an attacker create his own <span style="color:#ff0000;">ATTACKER CONTRACT</span> that call the <span style="color:#a020f0;">TARGET CONTRACT</span> with Tx.Origin, the attacker could run a phishing campaign and social engineer the <span style="color:#1e90ff;">USER</span> into running functionality on the <span style="color:#ff0000;">ATTACKER CONTRACT</span>. <br />In this way the the <span style="color:#ff0000;">ATTACKER CONTRACT</span> will be authenticated as the <span style="color:#1e90ff;">USER</span><br /><span style="color:#a5452a;">example</span>: intermediary contract(like one of a game) that accept a payment from a <span style="color:#1e90ff;">user</span> and proxy the request to the <span style="color:#a020f0;">target contract</span>.<br />    If the <span style="color:#1e90ff;">user</span> is social engineered into using the <span style="color:#ff0000;">attacker contract</span>, the <span style="color:#ff0000;">attacker contract</span> can make a transaction call to the <span style="color:#a020f0;">target contract</span> which originates from the <span style="color:#1e90ff;">user</span>’s address via tx.origin. <br /><span style="text-decoration:underline;">This is the exact point where things can go wrong depending on how the </span><span style="color:#a020f0;text-decoration:underline;">target contract</span><span style="text-decoration:underline;"> processes the transaction</span>:<br />   ◇ check authorization via <strong>msg.sender</strong> →  then the <span style="color:#ff0000;">attackers contract</span> access to the <span style="color:#a020f0;">target contract</span> as the <span style="color:#ff0000;">attackers contract address</span> (NOT RISKY)<br />   ◇ check authorization via <strong>tx.origin</strong> → then the <span style="color:#ff0000;">attacker contract</span> access to the <span style="color:#a020f0;">target contract</span> as the <span style="color:#1e90ff;">victim address</span> (RISKY)<br />      This mean:<br />      ▪ <span style="color:#ff0000;">attacker</span> can bypass any authorization checks <br />      ▪ <span style="color:#ff0000;">attacker</span> can process functionality as the victim user<br /><span style="color:#a5452a;">example attack scenarios:</span><br />      - attack used to liquidate a user’s account with a transfer function from the authorized user to the attacker’s account. <br />      - attack used for accessing to forbidden functionality such as a Self-Destruct function linked to administrator only validation, or perhaps updating admin functionality to provide the attacker with full access to the contract. <br /><br /><br /><br /><br /><br />Bibliography:<br />• <a href="http://console-cowboys.blogspot.com/2020/09/smart-contract-hacking-chapter-6.html">http://console-cowboys.blogspot.com/2020/09/smart-contract-hacking-chapter-6.html</a><br /><br /><br /><br /><br /></div>
</body>
</html>
