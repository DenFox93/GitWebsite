<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>XML external entity injection (XXE) (SSRF)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>XML external entity injection (XXE) (SSRF)</h1><br /><br />OWASP added <strong>XXE (XML External
      Entity)</strong> as a new category to the OWASP Top 10 in 2017<br />• Attackers can exploit vulnerable XML
    processors if they can upload XML or include hostile content in an XML document, exploiting vulnerable code,
    dependencies or integrations…<br />• By default, many older XML processors allow specification of an external
    entity, a URI that is dereferenced and evaluated during XML processing…<br />• These flaws can be used to extract
    data, execute a remote request from the server, scan internal systems, perform a denial-of-service attack, as well
    as execute other attacks.<br /><br /><strong>XXE and SAST Tools</strong><br />XML External Entities (XXE) can be
    discovered by <a href="Home--Penetration_Test_Methodology--WebApp_Pentest--Security_Testing_Methods.html">SAST
      (Static Application Security Testing) Tools</a>, which analyzes code when it is not
    running<br /><br /><br /><strong>XXE flaws are a class of injection attacks</strong><br />• XXE are Injection
    attacks, like Command Injection and SQL injection, allow the attacker to hijack control of the backend
    parser/interpreter<br />• The difference is the language being used on the backend: Instead of Bash (for typical
    Command Injection on Linux/UNIX servers) or SQL (for SQL injection), in this case it is XML. The attack is the same
    otherwise: A programmer has not performed input sanitization, allowing the attacker to execute commands on the web
    server.<br /><br /><strong>XXE during Black Box &amp; Crystal Box Testing</strong><br />XXE is much easier to test
    when the penetration tester has access to the backend code(crystal-box, aka full-knowledge), as well as the XML
    format itself. <br />If a client does want a black-box (aka zero-knowledge) test for XXE (where no inside
    information is provided), usually is better to to convince the client to switch to crystal box.<br />If the client
    is stick to black-box testing, the penetration tester need:<br /> 1) discover web applications that use XML, PHP is
    common (<span style="text-decoration:underline;">more difficult</span>)<br /> 2) infer the XML design itself (less
    difficult)<br /><br /><br /><a
      href="https://cheatsheetseries.owasp.org/cheatsheets/XML_External_Entity_Prevention_Cheat_Sheet.html" target="_blank">What OWASP
      say about XXE</a><br />XML eXternal Entity injection (XXE) is a type of attack against an application that parses
    XML input. <br />This attack occurs when untrusted XML input containing a reference to an external entity is
    processed by a weakly configured XML parser.<br />This attack may lead to the disclosure of confidential data,
    denial of service, Server Side Request Forgery (SSRF), port scanning from the perspective of the machine where the
    parser is located, and other system impacts. <br /><span style="text-decoration:underline;">General
      Guidance</span><br />The safest way to prevent XXE is always to disable DTDs (External Entities) completely.
    Depending on the parser, the method should be similar to the following:<br />
    <div class="codebox">
      <div class="codebox">
        factory.setFeature(&quot;http://apache.org/xml/features/disallow-doctype-decl&quot;,&nbsp;true);</div>
    </div><br /> <br /><br /><strong>Server Side Request Forgery (SSRF)<br /></strong>XXE is an example of Server-Side
    Request Forgery (SSRF) that is different but related to CSRF (Cross-Site Request Forgery)<br /> ◇ SSRF: Forged
    requests originating from a <span style="text-decoration:underline;">server</span><br /> <a href=""><img
        src="images/1563-1.png" alt="images/1563-1.png" /></a><br /> ◇ CSRF: Forged requests originating from a
    client<br /><strong><br /></strong><a
      href="https://owasp.org/www-community/attacks/Server_Side_Request_Forgery" target="_blank">What OWASP say about SSRF</a> <br />In
    a Server-Side Request Forgery (SSRF) attack, the attacker can abuse functionality on the server to read or update
    internal resources. <br />The attacker can supply or a modify a URL which the code running on the server will read
    or submit data to, and by carefully selecting the URLs, the attacker may be able to read server configuration such
    as AWS metadata, connect to internal services like http enabled databases or perform post requests towards internal
    services which are not intended to be exposed.<br /><br /><br /><br /><strong>Bibliography</strong><br />• <a
      href="https://portswigger.net/web-security/xxe" target="_blank">https://portswigger.net/web-security/xxe</a><br />• <a
      href="https://www.synack.com/blog/a-deep-dive-into-xxe-injection/" target="_blank">https://www.synack.com/blog/a-deep-dive-into-xxe-injection/</a><br />•
    <a
      href="https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity" target="_blank">https://book.hacktricks.xyz/pentesting-web/xxe-xee-xml-external-entity</a>
  </div>
</body>

</html>