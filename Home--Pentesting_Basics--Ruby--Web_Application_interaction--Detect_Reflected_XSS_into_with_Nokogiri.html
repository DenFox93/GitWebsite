<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Detect Reflected XSS into with Nokogiri</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Detect Reflected XSS into with Nokogiri</h1><br /><br /><strong>Detect Reflected XSS with
      Nokogiri</strong><br />Nokogiri treats text of the response as a TextNode that must be contained in some
    ElementNode.<br />In our scenario:<br />• the ElementNode must be a script node
    &lt;script&gt;....&lt;/script&gt;<br />• TextNode must contains the string ‘alert(12345)’.<br /><br />We can add and
    test other XSS vectors other the one specified in XSS_VECTORS , the same thing is true for
    Testing_Values<br /><br /><br /><br />
    <div class="codebox">
      <div class="codebox">
        require&nbsp;&#39;nokogiri&#39;<br />require&nbsp;&#39;open-uri&#39;<br />require&nbsp;&#39;cgi&#39;<br />#for&nbsp;https<br />require&nbsp;&#39;openssl&#39;<br /><br />#How&nbsp;use&nbsp;it<br />#&nbsp;ruby&nbsp;detect_xss.rb&nbsp;[target_url]&nbsp;[target_parameter]<br /><br />#Target&nbsp;constant&nbsp;contains&nbsp;the&nbsp;URL&nbsp;of&nbsp;the&nbsp;target&nbsp;resource,&nbsp;including&nbsp;the&nbsp;query&nbsp;string<br />Target&nbsp;=&nbsp;URI(ARGV[0])<br />Parameter&nbsp;=&nbsp;ARGV[1]<br /><br />XSS_VECTORS&nbsp;=&nbsp;[&quot;&lt;script&gt;alert(123456)&lt;/script&gt;&quot;]<br />Testing_Values&nbsp;=&nbsp;[&quot;alert(123456)&quot;]<br /><br />#&nbsp;Using&nbsp;the&nbsp;CGI&nbsp;class,&nbsp;we&nbsp;can&nbsp;parse&nbsp;the&nbsp;query&nbsp;string&nbsp;to&nbsp;obtain&nbsp;an&nbsp;hash&nbsp;of&nbsp;the&nbsp;GET&nbsp;parameters&nbsp;(‘name’=&gt;’value’).<br />Query&nbsp;=&nbsp;CGI.parse(Target.query)<br /><br />#The&nbsp;zip&nbsp;instruction&nbsp;combined&nbsp;with&nbsp;the&nbsp;each&nbsp;method,&nbsp;iterates&nbsp;over&nbsp;the&nbsp;XSS_VECTORS&nbsp;and&nbsp;the&nbsp;Testing_Values.<br />#&nbsp;&nbsp;In&nbsp;each&nbsp;iteration,&nbsp;the&nbsp;elements&nbsp;at&nbsp;the&nbsp;same&nbsp;position&nbsp;of&nbsp;the&nbsp;two&nbsp;array&nbsp;are&nbsp;selected:&nbsp;vect&nbsp;and&nbsp;test.<br />#&nbsp;&nbsp;We&nbsp;do&nbsp;this&nbsp;because&nbsp;we&nbsp;may&nbsp;want&nbsp;to&nbsp;test&nbsp;different&nbsp;injection&nbsp;payloads&nbsp;and&nbsp;for&nbsp;each&nbsp;of&nbsp;them,&nbsp;<br />#&nbsp;&nbsp;&nbsp;&nbsp;we&nbsp;may&nbsp;have&nbsp;a&nbsp;specific&nbsp;value&nbsp;to&nbsp;test.<br />#&nbsp;&nbsp;&nbsp;&nbsp;In&nbsp;this&nbsp;sceario&nbsp;we&nbsp;only&nbsp;a&nbsp;pair&nbsp;to&nbsp;test&nbsp;inside&nbsp;the&nbsp;arrys&nbsp;XSS_VECTORS&nbsp;&amp;&nbsp;Testing_Values<br />XSS_VECTORS.zip(Testing_Values).each&nbsp;do&nbsp;|vect,test|<br /><br />
        Query[Parameter]&nbsp;=&nbsp;vect<br /> Target.query&nbsp;=&nbsp;URI.encode_www_form(Query)<br />
        #doc&nbsp;encapsulates&nbsp;the&nbsp;response&nbsp;and&nbsp;we&nbsp;can&nbsp;use&nbsp;Nokogiri&nbsp;to&nbsp;navigate&nbsp;it<br />
        doc&nbsp;=&nbsp;Nokogiri::HTML(URI.open(Target))<br />
        #--&gt;&nbsp;With&nbsp;XPath,&nbsp;we&nbsp;can&nbsp;search(...)&nbsp;through&nbsp;all&nbsp;of&nbsp;the&nbsp;text&nbsp;nodes&nbsp;in&nbsp;order&nbsp;to&nbsp;find&nbsp;the&nbsp;one&nbsp;that&nbsp;contains&nbsp;the&nbsp;string&nbsp;‘alert(12345)’.<br />
        #--&gt;&nbsp;//text()&nbsp;is&nbsp;used&nbsp;to&nbsp;select&nbsp;all&nbsp;of&nbsp;the&nbsp;text&nbsp;nodes&nbsp;of&nbsp;the&nbsp;entire&nbsp;html&nbsp;document&nbsp;(without&nbsp;element&nbsp;nodes).<br />
        #--&gt;&nbsp;[]&nbsp;brackets&nbsp;are&nbsp;used&nbsp;to&nbsp;test&nbsp;if&nbsp;the&nbsp;extracted&nbsp;nodes&nbsp;satisfies&nbsp;a&nbsp;particular&nbsp;condition.<br />
        #--&gt;&nbsp;contains(arg1,arg2)&nbsp;is&nbsp;a&nbsp;XPath&nbsp;function&nbsp;that&nbsp;checks&nbsp;if&nbsp;a&nbsp;particular&nbsp;string&nbsp;(first&nbsp;argument)&nbsp;<br />
        #&nbsp;&nbsp;&nbsp;&nbsp;contains&nbsp;another&nbsp;string&nbsp;(second&nbsp;argument).&nbsp;<br />
        #&nbsp;&nbsp;&nbsp;&nbsp;Therefore,&nbsp;in&nbsp;the&nbsp;example&nbsp;for&nbsp;each&nbsp;text&nbsp;node&nbsp;(specified&nbsp;with&nbsp;the&nbsp;point&nbsp;.&nbsp;),&nbsp;<br />
        #&nbsp;&nbsp;&nbsp;&nbsp;it&nbsp;tests&nbsp;if&nbsp;it&nbsp;contains&nbsp;the&nbsp;second&nbsp;argument&nbsp;(our&nbsp;‘alert(12345)’&nbsp;string&nbsp;).<br />
        doc.search(&quot;//text()[contains(.,&#39;#{test}&#39;)]&quot;).each&nbsp;do |el|<br />
        if&nbsp;el.parent.name&nbsp;==&nbsp;&#39;script&#39;then<br />
        puts&nbsp;&quot;-----&nbsp;Probable&nbsp;XSS&nbsp;found&nbsp;-------&quot;<br />
        puts&nbsp;&quot;Injection&nbsp;Vector:&nbsp;#{vect}&quot;,&quot;\n&quot;<br />
        puts&nbsp;&quot;FOUND&nbsp;IN&nbsp;THE&nbsp;FOLLOWING&nbsp;CODE&quot;<br /> puts&nbsp;el.parent.parent.to_html
        <br /> puts&nbsp;&quot;--------------------------------&quot;,&quot;\n&quot;<br /> end<br />
        end&nbsp;<br /><br />end</div>
    </div><br /> <a href=""><img src="images/2001-1.png" alt="images/2001-1.png" /></a><br /> <br /><br />
  </div>
</body>

</html>