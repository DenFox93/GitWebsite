<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>UDP Port Scannig</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>UDP Port Scannig</h1><br/>UDP is often ignored because it is stateless and sometimes identifying if an UDP port is open or closed may take a lot of time.<br />We should run a UDP port scan, only to well-known ports and services<br /><br /><strong>Strategy UDP port scan</strong><br />• send an UDP packet to a port<br />• If we receive an:<br />   ◇ <span style="text-decoration:underline;">ICMP error</span> (destination unreachable or others) then we can conclude that the port is <span style="text-decoration:underline;">closed or firewalled</span>;<br />   ◇ <span style="text-decoration:underline;">UDP response</span> then the port is <span style="text-decoration:underline;">open</span> and the service is available.<br />   ◇ <span style="text-decoration:underline;">NO response</span>:<br />      ▪ <span style="text-decoration:underline;">packet lost</span>, because UDP is stateless<br />      ▪ <span style="text-decoration:underline;">port firewalled</span>, firewall that avoids sending a ICMP packet as a response<br /><br /><span style="text-decoration:underline;">Note</span>s: <br />• max 1 UDP packet for second<br />   Platforms Linux-style avoids sending too many ICMP packets ICMP  in order to avoid network congestion. Linux sends an ICMP packet once per second; therefore our script must take this behavior into account.<br />• script that accepts as parameter a list of ports instead of a range<br /><br /><div class="codebox"><div class="codebox">require&nbsp;&#39;socket&#39;<br />require&nbsp;&#39;timeout&#39;<br /><br />def&nbsp;main(host,ports)<br />	open&nbsp;=&nbsp;[]<br />	filtered&nbsp;=&nbsp;[]	<br />	closed&nbsp;=&nbsp;[]<br />	#ports&nbsp;is&nbsp;an&nbsp;array&nbsp;of&nbsp;ports<br />	#&nbsp;for&nbsp;each&nbsp;port&nbsp;we&nbsp;have&nbsp;to&nbsp;send&nbsp;some&nbsp;UDP&nbsp;packets<br />	#&nbsp;and&nbsp;catch&nbsp;any&nbsp;response<br />	ports.each&nbsp;do&nbsp;|port|<br />		#&nbsp;we&nbsp;create&nbsp;a&nbsp;proper&nbsp;UDP&nbsp;socket<br />		u&nbsp;=&nbsp;UDPSocket.new<br />		u.connect(host,port)	<br />		#&nbsp;and&nbsp;we&nbsp;send&nbsp;from&nbsp;1&nbsp;up&nbsp;to&nbsp;5&nbsp;packets<br />		(1..5).each&nbsp;do&nbsp;|i|<br />			begin	<br />				#First,&nbsp;we&nbsp;send&nbsp;a&nbsp;packet&nbsp;and&nbsp;wait&nbsp;for&nbsp;the&nbsp;first&nbsp;response.&nbsp;<br />				#&nbsp;If&nbsp;no&nbsp;response&nbsp;is&nbsp;received,&nbsp;the&nbsp;timeout&nbsp;is&nbsp;triggered<br />				#&nbsp;(note&nbsp;that&nbsp;the&nbsp;timeout&nbsp;is&nbsp;incremental).<br />				#&nbsp;If&nbsp;the&nbsp;timeout&nbsp;is&nbsp;triggered&nbsp;for&nbsp;all&nbsp;5&nbsp;packets<br />				#then&nbsp;we&nbsp;consider&nbsp;the&nbsp;port&nbsp;filtered<br />				Timeout::timeout(i*0.5){<br />					u.write(&quot;\0&quot;)<br />					u.recv(10)&nbsp;<br />					open.push&nbsp;port<br />				}<br />			rescue&nbsp;Errno::ECONNREFUSED<br />				#&nbsp;port&nbsp;is&nbsp;considered&nbsp;closed&nbsp;if&nbsp;we&nbsp;receive&nbsp;an&nbsp;ICMP&nbsp;<br />				#&nbsp;destination&nbsp;unreachable<br />				closed.push&nbsp;port&nbsp;<br />				break<br />			rescue&nbsp;Timeout::Error<br />				#&nbsp;port&nbsp;is&nbsp;considered&nbsp;filtered&nbsp;if&nbsp;the&nbsp;timeout&nbsp;is&nbsp;<br />				#&nbsp;triggered&nbsp;for&nbsp;all&nbsp;the&nbsp;(5)&nbsp;packets<br />				filtered.push(port)&nbsp;if&nbsp;i==5<br />			else<br />				#&nbsp;in&nbsp;this&nbsp;case&nbsp;no&nbsp;exception&nbsp;is&nbsp;raised&nbsp;and&nbsp;the&nbsp;<br />				#&nbsp;body&nbsp;timeout&nbsp;does&nbsp;not&nbsp;raise&nbsp;a&nbsp;timeout&nbsp;exeception<br />				break<br />			end<br />		end<br />	end<br />	puts&nbsp;&quot;OPEN&quot;&nbsp;if&nbsp;!open.empty?<br />	puts&nbsp;open&nbsp;if&nbsp;!open.empty?<br />	puts&nbsp;&quot;FILTERED|OPEN&quot;&nbsp;if&nbsp;!filtered.empty?<br />	puts&nbsp;filtered&nbsp;if&nbsp;!filtered.empty?<br />	puts&nbsp;&quot;CLOSED&quot;&nbsp;if&nbsp;!closed.empty?<br />	puts&nbsp;closed&nbsp;if&nbsp;!closed.empty?<br />end<br /><br /><br />begin&nbsp;<br />	host&nbsp;=&nbsp;ARGV[0]<br />&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;We&nbsp;accept&nbsp;an&nbsp;array&nbsp;of&nbsp;ports&nbsp;to&nbsp;test&nbsp;split&nbsp;by&nbsp;-<br />	#&nbsp;EXAMPLE:&nbsp;for&nbsp;53-161-167&nbsp;argument&nbsp;we&nbsp;have&nbsp;<br />	#&nbsp;ports&nbsp;=&nbsp;[53,161,167]<br />	ports&nbsp;=&nbsp;ARGV[1].split(&quot;-&quot;).map{|x|&nbsp;x.to_i}<br />	main(host,ports)	<br /><br />end</div></div><br />    <a href=""><img src="images/1956-1.png" alt="images/1956-1.png" /></a></div>
</body>
</html>
