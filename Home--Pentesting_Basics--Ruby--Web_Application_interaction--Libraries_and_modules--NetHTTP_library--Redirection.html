<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Redirection</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Redirection</h1><br /><br /><br /><br />We have to follow the redirection chain until we receive
    an HTTPOK response (code 200)<br />
    <div class="codebox">
      <div class="codebox">
        require&nbsp;&#39;net/http&#39;<br /><br />Target&nbsp;=&nbsp;ARGV[0]<br /><br />#Recursive&nbsp;function&nbsp;(follow_chain)&nbsp;that&nbsp;is&nbsp;able&nbsp;to&nbsp;follow&nbsp;the&nbsp;redirection&nbsp;chain.&nbsp;<br />#&nbsp;It&nbsp;is&nbsp;able&nbsp;to&nbsp;identify&nbsp;both&nbsp;HTTP&nbsp;or&nbsp;HTPPS&nbsp;connection&nbsp;type&nbsp;<br />def&nbsp;follow_chain(url,&amp;block)<br />
        resp&nbsp;=&nbsp;Net::HTTP.start(url.host,url.port,:use_ssl=&gt;url.scheme==&#39;https&#39;)&nbsp;do&nbsp;|https|<br />
        https.get(url.path)<br /> end<br />
        #block&nbsp;will&nbsp;call&nbsp;follow_chain,&nbsp;to&nbsp;print&nbsp;on&nbsp;stdout&nbsp;the&nbsp;redirections<br />
        block.call(url,resp)<br />
        #if&nbsp;the&nbsp;response&nbsp;is&nbsp;an&nbsp;HTTPRedirection&nbsp;object,&nbsp;there&nbsp;is&nbsp;a&nbsp;recursion<br />
        follow_chain(URI(resp[&#39;location&#39;]),&amp;block)&nbsp;if&nbsp;resp.is_a?&nbsp;Net::HTTPRedirection<br />end<br /><br />puts&nbsp;&quot;Starting&nbsp;from:&nbsp;#{Target}\n\n&quot;<br />follow_chain(URI(Target))&nbsp;{&nbsp;|url,resp|&nbsp;<br />
        case&nbsp;resp<br /> when&nbsp;Net::HTTPRedirection&nbsp;then<br />
        puts&nbsp;&quot;Redirection&nbsp;to:&nbsp;#{resp[&#39;location&#39;]}&quot;&nbsp;<br />
        when&nbsp;Net::HTTPSuccess&nbsp;then&nbsp;<br /> puts&nbsp;&quot;\nHTTPOK:&nbsp;#{url.to_s}&quot;<br />
        end<br />}<br /></div>
    </div>
  </div>
</body>

</html>