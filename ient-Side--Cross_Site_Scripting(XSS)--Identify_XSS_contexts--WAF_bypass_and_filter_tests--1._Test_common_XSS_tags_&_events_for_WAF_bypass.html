<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>1. Test common XSS tags & events for WAF bypass</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>1. Test common XSS tags & events for WAF bypass</h1><br /><br /><br /><br />When we we inject a
    standard XSS vector, such as <code>&lt;img src=1 onerror=print()&gt;</code><br />If we observe that this gets
    blocked probably is because there is a WAF that filters the traffic.<br />As first thing we should determine which
    Tags and Events are filtered by the WAF, so we can use the others to construct out payload<br /><br />1. use Burp
    Intruder to test which tags and attributes are being blocked.<br /> substitute <strong>&lt;§§&gt;</strong> at the
    value of the parameter that we want to test<br /> <a href=""><img src="images/1927-1.png"
        alt="images/1927-1.png" /></a><br />2. Visit the XSS cheat sheet(<a
      href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet" target="_blank">https://portswigger.net/web-security/cross-site-scripting/cheat-sheet</a>) and
    click &quot;<strong>Copy tags to clipboard</strong>&quot;<br /> <a href=""><img src="images/1927-2.png"
        alt="images/1927-2.png" /></a><br />3. Burp Intruder → Payloads tab:<br /> 1) Payload Options →
    &quot;Paste&quot; to paste the list of tags into the payloads list.<br /> 2) Payload Sets → Payload Types:Simple
    List <br /> <a href=""><img src="images/1927-3.png" alt="images/1927-3.png" /></a><br /> <span
      style="text-decoration:underline;">Note</span>: To these add also the attribute
    <strong>href=&quot;random&quot;</strong> that sometime is filtered as seen in <a
      href="itation--Client-Side--Cross_Site_Scripting(XSS)--XSS_Contexts_(examples)--XSS_in_HTML_content--Event_handlers_and_href_attributes_blocked.html">Event
      handlers and href attributes blocked</a>)<br />4. Start the Attack. Note all the payloads(if present) that have
    caused a different results from the others. <br /> In this case all payloads caused an HTTP 400 response, except for
    the <span style="text-decoration:underline;">body</span> payload, which caused a 200 response<br /> <a href=""><img
        src="images/1927-4.png" alt="images/1927-4.png" /></a><br />5. Go back to the Positions tab in Burp Intruder and
    replace your search term with: <br />
    <div class="codebox">
      <div class="codebox"><span style="color:#000000;font-weight:400">&lt;</span>body%20=1<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br /> <a href=""><img src="images/1927-5.png" alt="images/1927-5.png" /></a><br /> %20 is a space in
    html<br />6. <h3>&quot;Add §&quot; twice</h3> before the = character. <br /> We should have something like:<br />
    <div class="codebox">
      <div class="codebox"><span style="color:#000000;font-weight:400">&lt;</span>body%20§§=1<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br /> <a href=""><img src="images/1927-6.png" alt="images/1927-6.png" /></a><br />7. Visit the XSS cheat
    sheet(<a
      href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet" target="_blank">https://portswigger.net/web-security/cross-site-scripting/cheat-sheet</a>) and
    click &quot;<strong>copy events to clipboard</strong>&quot;<h3>.</h3><br />8. Burp Intruder → Payloads tab:<br /> 4)
    Payload Options → First “Clear” and then &quot;Paste&quot; to paste the list of tags into the payloads list.<br />
    5) Payload Sets → Payload Types:Simple List <br /> <a href=""><img src="images/1927-7.png"
        alt="images/1927-7.png" /></a><br /> <br />9. Start the Attack. Note all the payloads(if present) that have
    caused a different results from the others<br /> In this case all payloads caused an HTTP 400 response, except for
    the <span style="text-decoration:underline;">onresize</span> payload, which caused a 200 response<br /> <a
      href=""><img src="images/1927-8.png" alt="images/1927-8.png" /></a><br />10. We have discovered that:<br /> ◇ tag
    body is not been filtered<br /> ◇ event onresize is not been filtered<br /> Now to select a candidate payload go to
    the Portswigger cheatsheet (<a
      href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet" target="_blank">https://portswigger.net/web-security/cross-site-scripting/cheat-sheet</a>)
    and select these Event Handlers not filtered discovered<br /> <a href=""><img src="images/1927-9.png"
        alt="images/1927-9.png" /></a><br /> <br />11. The payload discovered <span
      style="text-decoration:underline;">fires when the window is resized</span> so we can build our payload for a
    stored XSS like this:<br />
    <div class="codebox">
      <div class="codebox">
        &lt;iframe&nbsp;src=&quot;https://your-lab-id.web-security-academy.net/?search=&quot;&gt;&lt;body&nbsp;onresize=print()&gt;&quot;&nbsp;onload=this.style.width=&#39;100px&#39;&gt;
      </div>
    </div><br /> ◇ HTML encoded will be:<br />
    <div class="codebox">
      <div class="codebox"><span
          style="color:#000000;font-weight:400">&lt;</span>iframe&nbsp;src=&quot;https://your-lab-id.web-security-academy.net/?search=%22%3E%3Cbody%20onresize=print()%3E&quot;&nbsp;onload=this.style.width=&#39;100px&#39;<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br /> ◇ HTML encode completely with Burp<br /> <a href=""><img src="images/1927-10.png"
        alt="images/1927-10.png" /></a><br />
    <div class="codebox">
      <div class="codebox">
        &amp;#x3c;&amp;#x69;&amp;#x66;&amp;#x72;&amp;#x61;&amp;#x6d;&amp;#x65;&amp;#x20;&amp;#x73;&amp;#x72;&amp;#x63;&amp;#x3d;&amp;#x22;&amp;#x68;&amp;#x74;&amp;#x74;&amp;#x70;&amp;#x73;&amp;#x3a;&amp;#x2f;&amp;#x2f;&amp;#x79;&amp;#x6f;&amp;#x75;&amp;#x72;&amp;#x2d;&amp;#x6c;&amp;#x61;&amp;#x62;&amp;#x2d;&amp;#x69;&amp;#x64;&amp;#x2e;&amp;#x77;&amp;#x65;&amp;#x62;&amp;#x2d;&amp;#x73;&amp;#x65;&amp;#x63;&amp;#x75;&amp;#x72;&amp;#x69;&amp;#x74;&amp;#x79;&amp;#x2d;&amp;#x61;&amp;#x63;&amp;#x61;&amp;#x64;&amp;#x65;&amp;#x6d;&amp;#x79;&amp;#x2e;&amp;#x6e;&amp;#x65;&amp;#x74;&amp;#x2f;&amp;#x3f;&amp;#x73;&amp;#x65;&amp;#x61;&amp;#x72;&amp;#x63;&amp;#x68;&amp;#x3d;&amp;#x22;&amp;#x3e;&amp;#x3c;&amp;#x62;&amp;#x6f;&amp;#x64;&amp;#x79;&amp;#x20;&amp;#x6f;&amp;#x6e;&amp;#x72;&amp;#x65;&amp;#x73;&amp;#x69;&amp;#x7a;&amp;#x65;&amp;#x3d;&amp;#x70;&amp;#x72;&amp;#x69;&amp;#x6e;&amp;#x74;&amp;#x28;&amp;#x29;&amp;#x3e;&amp;#x22;&amp;#x20;&amp;#x6f;&amp;#x6e;&amp;#x6c;&amp;#x6f;&amp;#x61;&amp;#x64;&amp;#x3d;&amp;#x74;&amp;#x68;&amp;#x69;&amp;#x73;&amp;#x2e;&amp;#x73;&amp;#x74;&amp;#x79;&amp;#x6c;&amp;#x65;&amp;#x2e;&amp;#x77;&amp;#x69;&amp;#x64;&amp;#x74;&amp;#x68;&amp;#x3d;&amp;#x27;&amp;#x31;&amp;#x30;&amp;#x30;&amp;#x70;&amp;#x78;&amp;#x27;&amp;#x3e;
      </div>
    </div><br /> <br /><br />12. Now we need only send this payload to the
    victim<br /><br /><br /><br /><br /><br /><strong>What the above payload will do(this is only a
      PoC)?</strong><br />1. iframe of the webpage will display content from the vulnerable webapp.<br />2. search query
    will generate an alert containing the victim’s session cookie when the element <code>onresize</code> is called
    within the <code>body</code> tag.<br />3. force the iframe to resize itself to a width of 100px upon
    loading.<br />4. When the victim browses to our malicious website, this iframe will be loaded in their browser,
    resized, and then the session cookie will be displayed back to them.<br /><br />
    <br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><strong>Bibliography:</strong><br />• <a
      href="https://portswigger.net/web-security/cross-site-scripting/contexts/lab-html-context-with-most-tags-and-attributes-blocked" target="_blank">https://portswigger.net/web-security/cross-site-scripting/contexts/lab-html-context-with-most-tags-and-attributes-blocked</a><br />•
    <a
      href="https://portswigger.net/web-security/cross-site-scripting/cheat-sheet" target="_blank">https://portswigger.net/web-security/cross-site-scripting/cheat-sheet</a>
  </div>
</body>

</html>