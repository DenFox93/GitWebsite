<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>URI fragments (#)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>URI fragments (#)</h1><br /><br /><strong><span style="color:#ff0000;">ATTENTION:<br />Topic that
        need to be further deepen </span></strong><br /><br /><br />URI fragments (the part in the URI after the “<span
      style="color:#0000ff;">#</span>”) is not sent to the server by the browser. Thus, any client side code that
    references, say, document.location, may be vulnerable to an attack which uses fragments, and in such case the
    payload is never sent to the server.<br /><br />If the fragment is stored in the DOM as a part of the<br />•
    <code>document.location</code> <br />• <code>document.location.href</code> <br />• <code>document.URL</code>
    <br />and the developer parses either of these elements, the fragment will be included in the
    document<br /><br /><br /><strong>Vulnerable Web App</strong><br /><span style="color:#a5452a;">example
      document.location: </span><br />
    <div class="codebox">
      <div class="codebox">
        &lt;script&gt;<br />var&nbsp;data&nbsp;&nbsp;=&nbsp;document.location.hash.substring(1);<br />document.write(data);<br /><span
          style="color:#000000;font-weight:400">&lt;</span>/script<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br /> The script simply takes everything after the <span style="color:#0000ff;">hash</span> part of the URI
    and writes the data to the document.<br /><span style="text-decoration:underline;">Exploit:</span><br />url:
    <code>http://www.example.com/userdashboard.html</code><br />Here is how a DOM-based XSS attack can be performed for
    this web application:<br />1. The attacker embeds a malicious script in the URL: <br />
    <code>http://www.example.com/userdashboard.html</code><code><span style="color:#0000ff;">#</span></code><code><span style="color:#ff0000;">&lt;script&gt;SomeFunction(somevariable)&lt;/script&gt;</span></code><br />
    ◇ Because of the <strong><span style="color:#0000ff;">#</span></strong> the <span style="color:#ff0000;">script
      code</span> never reaches the server. Therefore, server-side attack detection tools will fail to detect this
    attack<br />2. The victim’s browser receives this URL, sends an HTTP request to http://www.example.com, and receives
    the static HTML page.<br />3. The browser starts building the DOM of the page and populates the document with the
    URL from step 1.<br />4. The browser parses the HTML page, reaches the script, and runs it, extracting the malicious
    content from the document<br />5. The browser updates the raw HTML body of the page to contain:
    <code>&lt;script&gt;SomeFunction(somevariable)&lt;/script&gt;.</code><br />6. The browser finds the JavaScript code
    in the HTML body and executes it.<br /><br /><span style="color:#a5452a;">example document.URL</span><br />
    <div class="codebox">
      <div class="codebox">
        &lt;script&gt;<br />&nbsp;&nbsp;&nbsp;&nbsp;var&nbsp;name&nbsp;=&nbsp;document.URL.substring(document.URL.indexOf(&quot;name=&quot;)+5);<br />&nbsp;&nbsp;&nbsp;&nbsp;document.write(name&nbsp;+&nbsp;&quot;!&quot;);<br /><span
          style="color:#000000;font-weight:400">&lt;</span>/script<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br /><span style="text-decoration:underline;">Exploit:</span><br />url: http://example.com?name=Tim<br />1.
    The attacker embeds a malicious script in the URL: <br /> http://example.com?name=Tim<span
      style="color:#0000ff;">#</span><span style="color:#ff0000;">&lt;script&gt;alert(42)&lt;/script&gt;</span><br /> ◇
    Because of the <strong><span style="color:#0000ff;">#</span></strong> the <span style="color:#ff0000;">script
      code</span> never reaches the server. Therefore, server-side attack detection tools will fail to detect this
    attack<br />2. The victim’s browser receives this URL, sends an HTTP request to http://www.example.com, and receives
    the static HTML page.<br />3. The browser starts building the DOM of the page and populates the document with the
    URL from step 1.<br />4. The browser parses the HTML page, reaches the script, and runs it, extracting the malicious
    content from the document<br />5. The browser updates the raw HTML body of the page to contain: <span
      style="color:#ff0000;">&lt;script&gt;alert(42)&lt;/script&gt;</span><br />6. The browser finds the JavaScript code
    in the HTML body and executes it.<br /><br /><br />Bibliography:<br />• <a
      href="https://www.lanmaster53.com/2014/03/01/dom-based-xss-revisited/" target="_blank">https://www.lanmaster53.com/2014/03/01/dom-based-xss-revisited/</a><br />
  </div>
</body>

</html>