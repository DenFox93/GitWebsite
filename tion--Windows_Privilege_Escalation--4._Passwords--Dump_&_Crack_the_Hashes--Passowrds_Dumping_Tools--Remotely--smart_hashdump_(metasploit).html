<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>smart_hashdump (metasploit)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>smart_hashdump (metasploit)</h1><br/><br /><strong><h3>The meterpret smart_hashdump script  &lt;-------------- BETTER</h3></strong><br />Carlos Perez improved further on the hash extraction techniques in the sense of automating some of the additional steps, and logic required before the actual hashes are extracted.<br />it is a more reliable and safer method than running &quot;hashdump&quot; <br />Because of <span style="text-decoration:underline;">smart_hashdump pull hashes from the SAM in the file system&#39;s Registry that is safer than pulling them from LSASS memory</span>.<br />The “smart_hashdump” post module works as follows:<br />   ◇ Determine the privilege level, operating system, and test if the target is a domain controller<br />   ◇ If you have the right privileges, specifically a SYSTEM token, smart_hashdump will read the hashes from the SAM registry hive.<br />   ◇ If the system is a Domain Controller, smart_hashdump will always inject assembly code into LSASS to obtain hashes.<br />   ◇ If the target is a Windows 2008 server, and the process has administrative privileges, smart_hashdump will:<br />      ▪ Attempt to gain SYSTEM by using “getsystem”.<br />      ▪ If it fails to get system, smart_hashdump will attempt to automatically migrate to a process that has system privileges.<br />      ▪ Inject the LSASS process with assembly code to dump the hashes<br />   ◇ If the target is a Windows 7+ system with UAC disabled and the process has administrative privileges, smart_hashdump will run “getsystem” and use the registry reading method. If the target is a Windows 2000/2003/XP system, “getsystem” will be used followed by the registry reading method.<br /><br />The take home point with “smart_hashdump” is that it will do the work for you to obtain SYSTEM privilege and prefer reading the SAM registry hive if at all possible.  The downside with this and all methods, is that within the context of a Domain Controller, you are still required to inject assembly code into LSASS in order to obtain hashes.   As pointed out above, this is a dangerous technique and can result in a crash which your client would certainly not appreciate<br />    <div class="codebox"><div class="codebox">meterpreter&gt;&nbsp;run&nbsp;post/windows/gather/smart_hashdump&nbsp;&nbsp;</div></div><br />    or<br />    <div class="codebox"><div class="codebox">meterpreter&gt;&nbsp;run&nbsp;hashdump</div></div><br /><br /><strong>How to retrieve hashes from SAM file without meterpreter(Metasploit)</strong><br /></div>
</body>
</html>
