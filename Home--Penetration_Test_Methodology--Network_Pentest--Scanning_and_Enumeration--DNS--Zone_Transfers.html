<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Zone Transfers</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Zone Transfers</h1><br /><strong>
      <h3>Zone Transfers</h3>
    </strong><br />Zone transfers were designed so that secondary DNS servers could update their records from primary
    name servers.<br />This could be useful in a variety of situations:<br /> ◇ If the primary name server goes down, so
    that the secondary name server has a complete, up-to-date copy of the zone file<br /> ◇ load balance requests
    between the primary name server and its secondary name servers<br /> ◇ A company that has switched hosting providers
    and needs a way to transfer its DNS setup from one name server to another. <br /><span
      style="text-decoration:underline;">DNS zone transfer offers no authentication</span>. So, any client or someone
    posing as a client can ask a DNS server for a copy of the entire zone.<br />This means that unless some kind of
    protection is introduced, <span style="text-decoration:underline;">anyone is capable of getting a list of all hosts
      for the particular domain</span>, which gives them a lot of potential attack vectors.<br /><br /><br />While most
    DNS communications rely on UDP port 53, DNS zone transfers are carried over TCP port 53 because to perform a
    transaction such as this DNS requires a more reliable connection.<br />Many DNS servers block zone transfers from
    arbitrary locations on the internet by:<br />• Allowing only certain addresses (the primary name server) <br />•
    firewall blocking TCP port 53.<br /><br />Many networks deploy multiple DNS servers for the sake of redundancy or
    load balancing. As a result, DNS servers need a way to share information. This “sharing” process occurs through the
    use of a <strong>zone transfer</strong>. A zone transfer, also commonly referred to as DNS query type
    <strong>AXFR</strong> allows multiple DNS servers to stay in sync.<br /><br />Zone Transfers should be enabled only
    for trusted IP addresses otherwise we can use the misconfiguration of the remote DNS server and enumerate the entire
    DNS record(the DNS database) for that zone.<br /><br /><strong>
      <h3>If the DNS server is misconfigured we can use the vulnerability following these steps: </h3>
    </strong>
    <h3> </h3><br /><strong>1. discover Name Server for the domain</strong><br /> <span
      style="color:#ff0000;">ATTENTION</span>: for smaller organizations the nameserver belongs to a different company,
    usually a hosting company. This mean that the nameserver might not be in the scope of the assessment<br /> ◇
    discover DNS servers on the network with TCP port 53 open<br />
    <div class="codebox">
      <div class="codebox">
        nmap&nbsp;-sS&nbsp;-p53&nbsp;-n&nbsp;10.50.96.0/24&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#linux
      </div>
    </div><br /> Zone transfers take place on TCP port 53<br /> <a href=""><img src="images/598-1.png"
        alt="images/598-1.png" /></a><br /> ◇ discover Name server of a domain name<br />
    <div class="codebox">
      <div class="codebox">
        whois&nbsp;&lt;domain_name&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#domain&nbsp;used:&nbsp;zonetransfer.me
      </div>
    </div><br /> <a href=""><img src="images/598-2.png" alt="images/598-2.png" /></a><br />
    <div class="codebox">
      <div class="codebox">
        dig&nbsp;-t&nbsp;ns&nbsp;&lt;domain_name&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#domain&nbsp;used:&nbsp;zonetransfer.me
      </div>
    </div><br /> <a href=""><img src="images/598-3.png" alt="images/598-3.png" /></a><br /> ◇ discover the primary name
    server , by requesting SOA record<br />
    <div class="codebox">
      <div class="codebox">
        dig&nbsp;-t&nbsp;soa&nbsp;&lt;domain&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#domain&nbsp;used:&nbsp;zonetransfer.me
      </div>
    </div><br /> <a href=""><img src="images/598-4.png" alt="images/598-4.png" /></a><br /> *robin.digi.ninja is not
    another nameserver, it is the email of the administrator. Yes, because in SOA records the emails miss the ‘@’ sign.
    So robin.digi.ninja is equivalent to robin@digi.ninja<br /> <br /><strong>2. zone transfer request</strong><br /> By
    using AXFR record in our query, we can request all records for a zone. <br /> It is always worth checking for zone
    transfers on all available Name Servers<br /> <span style="text-decoration:underline;">◇ Linux</span><br /> ▪ <span
      style="text-decoration:underline;">dig</span><br /> If the command does not work add +nocookie, usually
    +cookie(default) is added for more security and provide some protection against certain attacks(<a
      href="https://metebalci.com/blog/a-short-practical-tutorial-of-dig-dns-and-dnssec/" target="_blank">here</a> if you want know
    more). But cookie can give some problem with some configurations<br />
    <div class="codebox">
      <div class="codebox">dig&nbsp;-t&nbsp;AXFR&nbsp;&lt;domain&gt;&nbsp;@&lt;name_server&gt;&nbsp;</div>
    </div><br /> <a href=""><img src="images/598-5.png" alt="images/598-5.png" /></a><br /> <span
      style="color:#00ff00;">dig syntax:</span><br /> <code>dig -t [record_type] [domain] @[server]</code><br /> ▪ <span
      style="text-decoration:underline;">other tools</span><br />
    <div class="codebox">
      <div class="codebox">
        dnsrecon&nbsp;-d&nbsp;&lt;domain&gt;<br />fierce&nbsp;-dns&nbsp;&lt;domain&gt;<br />#nslookup&nbsp;command&nbsp;in&nbsp;modern&nbsp;Linuxes&nbsp;cannot&nbsp;perform&nbsp;a&nbsp;zone&nbsp;transfer
      </div>
    </div><br /> <br /> <br /> <span style="text-decoration:underline;">◇ Windows</span><br />
    <div class="codebox">
      <div class="codebox">
        nslookup<br />server&nbsp;&lt;name_server&gt;<br />set&nbsp;q=AXFR<br />ls&nbsp;–d&nbsp;&lt;domain&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#target&nbsp;domain
      </div>
    </div><br /> if the DNS server is misconfigured we will have a screen similar to this one<br /> <a href=""><img
        src="images/598-6.png" alt="images/598-6.png" /></a> <br /><br /><strong>
      <h3>3. If we have found additional subdomains</h3>
    </strong><br /> <a href=""><img src="images/598-7.png" alt="images/598-7.png" /></a><br /> ◇ /etc/hosts<br /> Modify
    the /etc/hosts file in our machine to access to the subdomain. <br /> The reason why we get different resources,
    even though we are resolving to the same IP address, is due to virtual routing. When the web server sees the IP
    address, it serves the default Apache2. When the web server sees a domain name being requested, it serves a
    completely different page<br /> <br /> <br /><br /><br />Bibliography:<br />• “Hands on Hacking: Become an Expert at
    Next Gen Penetration Testing and Purple Teaming” Matthew Hickey, Jennifer Arcuri<br />• <a
      href="https://digi.ninja/projects/zonetransferme.php" target="_blank">https://digi.ninja/projects/zonetransferme.php</a>
  </div>
</body>

</html>