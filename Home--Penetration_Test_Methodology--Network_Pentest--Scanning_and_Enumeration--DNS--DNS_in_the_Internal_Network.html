<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>DNS in the Internal Network</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>DNS in the Internal Network</h1><br /><br /><br />Once we have found a DNS inside the Internal
    network we can query it to have more info about a domain<br />Note the use <span
      style="text-decoration:underline;">+cookie</span> because of Microsoft DNS Servers respond to default “dig”
    options (see <a
      href="https://kevinlocke.name/bits/2017/01/20/formerr-from-microsoft-dns-server-for-dig/" target="_blank">https://kevinlocke.name/bits/2017/01/20/formerr-from-microsoft-dns-server-for-dig/</a>)<br /><br /><strong>Determine
      Ip address of a domain</strong><br />
    <div class="codebox">
      <div class="codebox">dig&nbsp;-t&nbsp;ns&nbsp;@10.50.96.5&nbsp;foocampus.com&nbsp;+nocookie</div>
    </div><br /> <a href=""><img src="images/2108-1.png" alt="images/2108-1.png" /></a><br /> like that we have found
    the information about the Ip address assigned to the FQDN inside this network of this domain.<br /> to reach it we
    need anyway edit /etc/hosts or /etc/resolv.conf as seen in <a
      href="Home--Penetration_Test_Methodology--Network_Pentest--Scanning_and_Enumeration--DNS--FQDN_reachabale_by_querying_the_internal_DNS_server.html">FQDN
      reachabale by querying the internal DNS server</a><br /><br /><br /><strong>Determine Domain of an Ip
      address</strong><br /> If we have found a DNS in the Internal Network<br /> <a href=""><img
        src="images/2108-2.png" alt="images/2108-2.png" /></a><br /> and we want to determine the domain to which
    belongs the DNS and of the other IP address in the network<br />
    <div class="codebox">
      <div class="codebox">
        dig&nbsp;@172.16.5.10&nbsp;-x&nbsp;172.16.5.10&nbsp;+nocookie&nbsp;+short<br />dig&nbsp;@172.16.5.10&nbsp;-x&nbsp;172.16.5.5&nbsp;&nbsp;+nocookie&nbsp;+short<br />
      </div>
    </div><br /> -x → request for a Reverse DNS lookup<br /> <a href=""><img src="images/2108-3.png"
        alt="images/2108-3.png" /></a><br /> here we have discovered the domain “sportsfoo.com”<br /><br /><br />Once
    you have found a DNS inside the network add it to one of these files<br /><strong>Edit </strong><br />• <span
      style="text-decoration:underline;">/etc/hosts</span><br /> It map hostnames to IP addresses<br /> Edit this file
    when we find an ip address of a machine that have Web Server active<br /> <a href=""><img src="images/2108-4.png"
        alt="images/2108-4.png" /></a><br />• <span style="text-decoration:underline;">/etc/resolv.conf</span><br />
    useful if we needfor example find subdomains of the domain.<br /> <a href=""><img src="images/2108-5.png"
        alt="images/2108-5.png" /></a><br /> When we find a DNS inside the internal network, we should put its address
    in this file, above the others so it is queried first <br /> By placing this entry above the default nameserver our
    machine will use this one on the target host first, and then if that fails, use the default nameserver.<br /> By
    doing that we could resolve more domain names specific to the target host. <br /> This valid both when we are doing
    an Internal Penetration test and an external one on the WebApp.<br /> <br />
  </div>
</body>

</html>