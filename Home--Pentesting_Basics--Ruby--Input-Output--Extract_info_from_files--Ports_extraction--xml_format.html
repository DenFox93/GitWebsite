<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>xml format</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>xml format</h1><br/><br />1. Run nmap<br /><div class="codebox"><div class="codebox">nmap&nbsp;-sS&nbsp;-n&nbsp;192.168.1.97&nbsp;-oX&nbsp;openPorts.xml<br />cat&nbsp;openPorts</div></div><br />    Tree structure of the xml output file (-oX)<br />    <a href=""><img src="images/1818-1.png" alt="images/1818-1.png" /></a><br />    We are interested into the following path type: host -&gt; ports -&gt; port -&gt; portid<br />    <a href=""><img src="images/1818-2.png" alt="images/1818-2.png" /></a><br />    <br />2.Extract Ip addresses with Ruby script<br />    <div class="codebox"><div class="codebox">./openPorts-xml.rb&nbsp;192.168.1.97&nbsp;openPorts.xml</div></div><br />    <a href=""><img src="images/1818-3.png" alt="images/1818-3.png" /></a><br /><br /><strong><h2>DESCRIPTION</h2></strong><br /><br /><br /><span style="color:#ff8700;">openPorts-xml.rb</span> <br /><div class="codebox"><div class="codebox">#!/usr/bin/ruby<br />require&nbsp;&quot;rexml/document&quot;<br />begin<br /><br />	ip&nbsp;=&nbsp;ARGV[0]<br />	<br />	#&nbsp;chek&nbsp;if&nbsp;the&nbsp;optional&nbsp;argument&nbsp;&#39;state&#39;&nbsp;is&nbsp;provided<br />	port_state&nbsp;=&nbsp;ARGV[1][1..-1]&nbsp;if&nbsp;[&quot;-open&quot;,&quot;-closed&quot;,&quot;-filtered&quot;].include?&nbsp;ARGV[1]<br />	#&nbsp;otherwise&nbsp;set&nbsp;&quot;open&quot;&nbsp;as&nbsp;default&nbsp;state<br />	port_state&nbsp;=&nbsp;&quot;open&quot;&nbsp;if&nbsp;!port_state<br /><br />	#&nbsp;checks&nbsp;if&nbsp;argument&nbsp;is&nbsp;the&nbsp;file<br />	file&nbsp;=&nbsp;ARGV[2]&nbsp;if&nbsp;ARGV[2]<br />	file&nbsp;=&nbsp;ARGV[1]&nbsp;if&nbsp;!file<br /><br />	#&nbsp;parses&nbsp;the&nbsp;xml&nbsp;file&nbsp;to&nbsp;create&nbsp;a&nbsp;tree<br />	doc&nbsp;=&nbsp;REXML::Document.new&nbsp;File.new(file)<br />	<br />	#&nbsp;XPath&nbsp;syntax&nbsp;to&nbsp;extract&nbsp;only&nbsp;the&nbsp;desired&nbsp;ports<br />	pattern&nbsp;=&nbsp;&quot;//host[address/@addr=&#39;#{ip}&#39;]//port[state/@state=&#39;#{port_state}&#39;]&quot;<br /><br />	#&nbsp;for&nbsp;each&nbsp;address&nbsp;node&nbsp;child&nbsp;of&nbsp;host&nbsp;node<br />	#&nbsp;puts&nbsp;to&nbsp;stdout&nbsp;the&nbsp;addr&nbsp;attribute<br />	doc.elements.each(pattern)&nbsp;do&nbsp;|port|<br />	&nbsp;puts&nbsp;port.attributes[&quot;portid&quot;]<br />	end<br /><br /><br />rescue&nbsp;Exception&nbsp;=&gt;&nbsp;e<br />	puts&nbsp;e<br />end<br /></div></div></div>
</body>
</html>
