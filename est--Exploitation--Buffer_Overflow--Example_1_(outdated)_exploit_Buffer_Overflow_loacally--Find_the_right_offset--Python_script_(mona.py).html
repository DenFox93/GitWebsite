<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Python script (mona.py)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Python script (mona.py)</h1><br /><strong>
      <h3>mona.py</h3>
    </strong><br />mona.py is a python script that can be used to automate and speed up specific searches while
    developing exploits (typically for the Windows platform). It runs on Immunity Debugger and WinDBG, and requires
    python 2.7<br /><br /><strong>
      <h3>Install mona python script</h3>
    </strong><br /><strong>mona</strong> python script can be downloaded from: <a
      href="https://github.com/corelan/mona" target="_blank">https://github.com/corelan/mona</a><br />• copy mona.py into the
    &#39;PyCommands&#39; folder (inside the Immunity Debugger application folder)<br />• configure working folder for
    mona.py; (this will not create the folder now, but for futures commands)<br /> ◇ open Immunity Debugger<br /> ◇ At
    the bottom of the Immunity Debugger window run the command; then we will see the result in the Log Window(Alt+L) of
    Immunity Debugger → <a href=""><img src="images/510-1.png" alt="images/510-1.png" /></a><br /> doing that all the
    results of mona.py will be saved in this folder<br />
    <div class="codebox">
      <div class="codebox">!mona&nbsp;config&nbsp;-set&nbsp;workingfolder&nbsp;C:\ImmunityLogs\%p</div>
    </div><br /> <a href=""><img src="images/510-2.png" alt="images/510-2.png" /></a><br />• <strong><span
        style="text-decoration:underline;">If</span></strong><span style="text-decoration:underline;"> something does
      not work with python</span> install Python 2.7.14 (or a higher 2.7.xx version) into c:\python27, thus overwriting
    the version that was bundled with Immunity<br /> <br /><br /><strong>
      <h3>1. Create the payload</h3>
    </strong><br />In the command line of Immunity Debugger use:<br />
    <div class="codebox">
      <div class="codebox">!mona&nbsp;pc&nbsp;1000</div>
    </div><br /><a href=""><img src="images/510-3.png" alt="images/510-3.png" /></a><br />this will create a payload of
    1000 Bytes, we can copy the ASCII message directly from Immunity Debugger or we can open the file saved in
    C:\\ImmunityLogs and from here we have it also in HEX format.<br /><br /><strong>
      <h3>2. Load the payload as argument for the application and </h3>
    </strong><strong>
      <h3>CRASH</h3>
    </strong><strong>
      <h3> it!</h3>
    </strong><br />In Immunity Debugger(or other debuggers) use the pattern created by mona.py as argument (payload) for
    the application in Debug→ Argument.<br />We have to run the application and once that is crashed we have to annotate
    which is the <span style="color:#ffff00;">EIP address</span> with an access violation(overwritten).<br /><span
      style="color:#ffff00;">EIP</span> is been overwritten because we have used a random big number(1200). <br />the
    memory location of the EIP address, known that we can use this information to determine how many Junk Bytes to use
    before reaching the EIP <br /><a href=""><img src="images/510-4.png" alt="images/510-4.png" /></a> <a href=""><img
        src="images/510-5.png" alt="images/510-5.png" /></a><br /> <strong>◇ 2.1 Create a Metasploit module for
      exploiting the application</strong><br /> Once the application crash and the <span
      style="color:#ffff00;">EIP</span> is overwritten with the payload created by mona.py we create a Metasploit module
    for exploiting the application with this command:<br />
    <div class="codebox">
      <div class="codebox">!mona&nbsp;suggest</div>
    </div><br /> <a
      href="file://C:/CherryTree/screenshots2/PTP-elearnsecurity/1. System Security/3 - Buffer Overflows/mona2.1.png"><img
        src="images/510-6.png" alt="images/510-6.png" /></a><br /> <br /><strong>
      <h3>3. Find the correct offset</h3>
    </strong><br />To find the correct number of <span style="color:#00ff00;">Junk Bytes(offset)</span> we can use
    mona.py the <strong>po</strong>(pattern offset) command followed by the value contained by the <span
      style="color:#ffff00;">EIP register</span> found. This script will give us the exact number of junk Bytes(offset)
    that we need for the payload before overwrite <span style="color:#ffff00;">EIP</span>. <br />
    <div class="codebox">
      <div class="codebox">!mona&nbsp;po&nbsp;61413761</div>
    </div><br /><a href=""><img src="images/510-7.png" alt="images/510-7.png" /></a><br /><br /> <strong>◇ 3.1. Test
    </strong><br /> To test if we have found the correct number of <span style="color:#00ff00;">Junk
      Bytes(offset)</span> we can use this configuration of the <strong>payload</strong>:<br />
    <div class="codebox">
      <div class="codebox">
        payload&nbsp;=&nbsp;&quot;\xc3&quot;*22&nbsp;#Junk&nbsp;Bytes&nbsp;needed&nbsp;to&nbsp;reach&nbsp;the&nbsp;EIP<br />payload+=&quot;\x41\x41\x41\x41&quot;&nbsp;&nbsp;#&nbsp;overwrite&nbsp;EIP&nbsp;address(4&nbsp;Bytes)&nbsp;with&nbsp;this&nbsp;hashcode&nbsp;that&nbsp;in&nbsp;ASCII&nbsp;is&nbsp;AAAA
      </div>
    </div><br /> <a href=""><img src="images/510-8.png"
        alt="images/510-8.png" /></a><br /><br /><br /><br /><br /><br /><br /><br />
  </div>
</body>

</html>