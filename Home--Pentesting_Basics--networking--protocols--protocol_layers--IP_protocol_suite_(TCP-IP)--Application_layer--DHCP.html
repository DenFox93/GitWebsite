<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>DHCP</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>DHCP</h1><br/><strong>DHCP</strong> is a service usually running on <span style="text-decoration:underline;">routers</span> to dynamically assign or revoke IP address to new hosts on the network.<br />DHCP is based on the UDP protocol and the exchange of messages are mostly sent in broadcast.<br /><br /><strong><h3>How DHCP works</h3></strong><br /><a href=""><img src="images/698-1.png" alt="images/698-1.png" /></a><br />To have a practical example of how it work start wireshark and execute these commands<br /><div class="codebox"><div class="codebox">sudo&nbsp;dhclient&nbsp;-r&nbsp;eth0&nbsp;&nbsp;#release&nbsp;the&nbsp;current&nbsp;IP&nbsp;address<br />sudo&nbsp;dhclient&nbsp;eth0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#obtain&nbsp;a&nbsp;new&nbsp;ip&nbsp;address</div></div><br />1.Client sends a <strong>DHCP Discover</strong> broadcast packet <br />   ◇ Destination MAC address → ff:ff:ff:ff:ff:ff (broadcast)<br />   ◇ Source MAC address → MAC address of the Client&#39;s NIC<br />   ◇ Destination IP address → 255.255.255.255 (broadcast)<br />   ◇ Source IP address →  0.0.0.0 since the host still needs an IP to be assigned<br />   ◇ Source port(client) → UDP 67,68<br />   ◇ Destination port → UDP 67<br />   <a href="file://C:/CherryTree/screenshots2/PTP-elearnsecurity/2. Network Security/4. Sniffing and MitM Attack/DHCP_discover.png"><img src="images/698-2.png" alt="images/698-2.png" /></a><br />2. The DHCP server respond with a <strong>DHCP Offer</strong> broadcast packet<br />   ◇ Destination MAC address → ff:ff:ff:ff:ff:ff (broadcast)<br />   ◇ Destination IP address → 255.255.255.255 (broadcast)<br />   ◇ Your (client) IP address - YIADDR → Ip address that the server is offering to the client<br />   ◇ Lease Time → defines in seconds the validity period of the offered IP<br />    <a href="file://C:/CherryTree/screenshots2/PTP-elearnsecurity/2. Network Security/4. Sniffing and MitM Attack/DHCP_Offer.png"><img src="images/698-3.png" alt="images/698-3.png" /></a><br />3. Client sends a <strong>DHCP Request</strong> broadcast packet<br />   ◇ Destination MAC address → ff:ff:ff:ff:ff:ff (broadcast), the destination address is still broadcast since more than one DHCP server may have send a DHCPOFFER<br />   ◇ Source MAC address → MAC address of the Client&#39;s NIC<br />   ◇ Destination IP address → 255.255.255.255 (broadcast), the destination address is still broadcast since more than one DHCP server may have send a DHCPOFFER<br />   ◇ Source IP address →  0.0.0.0 since it has not received a verification from the server<br />   ◇ Requested IP Address → DHCP clients choose the best IP address offer <span style="text-decoration:underline;">according to the lease time</span> in the DHCP offer, the longer the better. This packet is used to designate a winner between all the DHCP servers(if there is more than one<br />    <a href="file://C:/CherryTree/screenshots2/PTP-elearnsecurity/2. Network Security/4. Sniffing and MitM Attack/DHCP_request.png"><img src="images/698-4.png" alt="images/698-4.png" /></a><br />4. Server send a DHCP ACK broadcast packet<br />   ◇ Destination MAC address → ff:ff:ff:ff:ff:ff (broadcast)<br />   ◇ Destination IP address → 255.255.255.255 (broadcast)<br />   ◇ Your (client) IP address - YIADDR → Ip address that the server assigned to the client <br />    <a href="file://C:/CherryTree/screenshots2/PTP-elearnsecurity/2. Network Security/4. Sniffing and MitM Attack/DHCP_request.png"><img src="images/698-5.png" alt="images/698-5.png" /></a><br /></div>
</body>
</html>
