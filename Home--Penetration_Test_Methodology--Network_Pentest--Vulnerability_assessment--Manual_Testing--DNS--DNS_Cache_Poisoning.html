<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>DNS Cache Poisoning</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>DNS Cache Poisoning</h1><br /><strong>
      <h2>DNS Cache Poisoning</h2>
    </strong>
    <h2> (</h2><a href="https://nvd.nist.gov/vuln/detail/CVE-2008-1447" target="_blank">CVE-2008-1447</a>
    <h2>)</h2><br /><span style="text-decoration:underline;">Prerequisite:</span><br /> ◇ The attacker need to be in the
    subnetwork of the router<br /><span style="text-decoration:underline;">Hosts Vulnerable:</span> <br /> ◇ BIND 8 and
    9 before 9.5.0-P1, 9.4.2-P1, and 9.3.5-P1<br /> ◇ Microsoft DNS in Windows 2000 SP4, XP SP2 and SP3, and Server 2003
    SP1 and SP2<br />Because of the hierarchical nature of DNS, any name server that relies on the poisoned name
    server(the one that contain incorrect or false information) will itself cache the false records and become poisoned,
    passing the poisoned results along.<br />An attacker could purposefully alter entries in a name server’s cache so
    that any computer that queries it will receive a malicious result.<br /><span style="text-decoration:underline;">How
      DNS Cache Poisoning work?</span><br />To poison the cache of a router,<br />1. send DNS requests to the victim
    router for non existing subdomains (1.google.com , 2.google.com , 3.google.com, ...) in a particular
    domain(google.com); <br />2. Because these subdomains not exist in the router’s cache, the router will sent queries
    to Google’s name server.<br />3. The attacker itself will send fake responses to the router for these queries.<br />
    ◇ Attention: the attacker need to spoof the source IP address of these responses so that it is the same of the name
    server being queried by the router (ns1.google.com) .<br /> ◇ Because we are closer to the router we might have time
    to send a lot of UDP packets(~100) before the real ns1.google.com response reaches the router. <br /> ◇ Each time
    you send a fake response, the transaction ID and source port of the response should be changed to guess the correct
    ones<br />4. When(or if) we will have guessed the correct parameters, the router will update its cache with the
    attacker fake record<br />Summing up the attacker need repeatedly guess transaction IDs and source ports until
    he&#39;s lucky.<br />the attack have poisoned the SOA record and changed its primary nameserver that now point at
    our fake nameserver<br /><br /><strong>Metasploit module: bailiwicked_domain</strong><br />code:
    /usr/share/metasploit-framework/modules/auxiliary/spoof/dns/bailiwicked_domain.rb<br /><br />
    <div class="codebox">
      <div class="codebox">
        msf&gt;&nbsp;use&nbsp;auxiliary/spoof/dns/bailiwicked_domain<br />msf&gt;&nbsp;info<br />msf&gt;</div>
    </div><br /><br /><br />Bibliography:<br />• “Hands on Hacking: Become an Expert at Next Gen Penetration Testing and
    Purple Teaming” Matthew Hickey, Jennifer Arcuri
  </div>
</body>

</html>