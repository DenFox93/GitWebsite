<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>TIME client-server</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>TIME client-server</h1><br/><br /><strong>TIME Server</strong><br /><div class="codebox"><div class="codebox">#!/usr/bin/ruby<br /><br />require&nbsp;&#39;socket&#39;<br /><br />def&nbsp;main(ip,port)<br />	#&nbsp;new&nbsp;TCP&nbsp;server&nbsp;bound&nbsp;to&nbsp;ip&nbsp;and&nbsp;port&nbsp;provided&nbsp;as&nbsp;argument<br />	server&nbsp;=&nbsp;TCPServer.new&nbsp;ip,port<br />	#&nbsp;loop&nbsp;indefinitely&nbsp;to&nbsp;accept&nbsp;clients&nbsp;requests<br />	loop&nbsp;do<br />		#&nbsp;new&nbsp;request&nbsp;accepted&nbsp;(client&nbsp;is&nbsp;a&nbsp;socket)<br />		client&nbsp;=&nbsp;server.accept<br />		#&nbsp;prints&nbsp;the&nbsp;client&nbsp;information&nbsp;(IP&nbsp;and&nbsp;port)<br />		print&nbsp;Time.new.to_s&nbsp;+&nbsp;&quot;&nbsp;-&nbsp;IP:&nbsp;&quot;+client.peeraddr[3]<br />		print&nbsp;&quot;&nbsp;Port:&nbsp;&quot;+client.peeraddr[1].to_s+&quot;\n&quot;<br />		#&nbsp;client&nbsp;socket&nbsp;receives&nbsp;a&nbsp;message&nbsp;from&nbsp;the&nbsp;client<br />		#&nbsp;chop&nbsp;is&nbsp;used&nbsp;to&nbsp;delete&nbsp;the&nbsp;last&nbsp;character&nbsp;(&quot;\n&quot;)<br />		case&nbsp;client.gets.chop<br />			#&nbsp;the&nbsp;server&nbsp;sends&nbsp;the&nbsp;correct&nbsp;answer&nbsp;according&nbsp;to&nbsp;the<br />			#&nbsp;type&nbsp;of&nbsp;operation&nbsp;received&nbsp;(timestamp|utc|local)<br />			when&nbsp;&quot;timestamp&quot;&nbsp;then&nbsp;client.puts(Time.now.to_i)<br />			when&nbsp;&quot;utc&quot;&nbsp;then&nbsp;client.puts(Time.now.utc)<br />			when&nbsp;&quot;local&quot;&nbsp;then&nbsp;client.puts(Time.now)<br />			else&nbsp;client.puts(&quot;Invalid&nbsp;operation&quot;)<br />		end<br />		#&nbsp;server&nbsp;is&nbsp;done&nbsp;=&gt;&nbsp;close&nbsp;the&nbsp;socket<br />		client.close<br />	end<br />end<br /><br />begin<br />	ip&nbsp;=&nbsp;ARGV[0]<br />	port&nbsp;=&nbsp;ARGV[1]<br />	main(ip,port)<br />rescue&nbsp;Exception&nbsp;=&gt;&nbsp;e<br />	puts&nbsp;e<br />end<br /></div></div><br /><br /><strong>TIME Client</strong><br /><div class="codebox"><div class="codebox">#!/usr/bin/ruby<br /><br />require&nbsp;&#39;socket&#39;<br /><br />def&nbsp;main(host,port,type)<br />	#&nbsp;open&nbsp;the&nbsp;connection&nbsp;with&nbsp;the&nbsp;time&nbsp;server<br />	#&nbsp;available&nbsp;on&nbsp;host&nbsp;and&nbsp;port&nbsp;arguments<br />	TCPSocket.open(host,port)&nbsp;do&nbsp;|s|<br />		#&nbsp;sends&nbsp;to&nbsp;the&nbsp;server&nbsp;the&nbsp;type&nbsp;of&nbsp;time&nbsp;&nbsp;we&nbsp;want<br />		s.puts(type)					#&nbsp;(timestamp|utc|local)<br />		#&nbsp;receives&nbsp;and&nbsp;puts&nbsp;to&nbsp;stdout&nbsp;the&nbsp;formatted&nbsp;time<br />		puts&nbsp;s.gets<br />	end<br />end<br /><br />begin<br />	host&nbsp;=&nbsp;ARGV[0]<br />	port&nbsp;=&nbsp;ARGV[1]<br />	type&nbsp;=&nbsp;ARGV[2]<br />	main(host,port,type)<br />rescue&nbsp;Exception&nbsp;=&gt;&nbsp;e<br />	puts&nbsp;s<br />end<br /></div></div><br /><br />SERVER<br /><div class="codebox"><div class="codebox">./time_server.rb&nbsp;192.168.3.136&nbsp;7000</div></div><br /><br />CLIENT<br /><div class="codebox"><div class="codebox">./time_client.rb&nbsp;192.168.3.136&nbsp;7000&nbsp;timestamp</div></div><br /><br /><br /><a href=""><img src="images/1952-1.png" alt="images/1952-1.png" /></a><br /><a href=""><img src="images/1952-2.png" alt="images/1952-2.png" /></a></div>
</body>
</html>
