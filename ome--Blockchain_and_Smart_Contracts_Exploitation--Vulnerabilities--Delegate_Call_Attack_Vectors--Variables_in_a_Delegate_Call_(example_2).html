<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Variables in a Delegate Call (example 2)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Variables in a Delegate Call (example 2)</h1><br/><br /><br /><div class="codebox"><div class="codebox">pragma&nbsp;solidity&nbsp;0.6.6;<br /><br />&nbsp;<br />contract&nbsp;LogicContract&nbsp;{<br />&nbsp;&nbsp;uint&nbsp;public&nbsp;a;<br />&nbsp;<br />&nbsp;&nbsp;function&nbsp;set(uint256&nbsp;val)&nbsp;public&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;a&nbsp;=&nbsp;val;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&lt;--<br />&nbsp;&nbsp;}<br />}<br /><br /><br />contract&nbsp;CallingContract&nbsp;<span style="color:#000000;font-weight:400">{</span><br />&nbsp;&nbsp;uint256&nbsp;public&nbsp;b&nbsp;=&nbsp;5;&nbsp;<br />&nbsp;&nbsp;uint256&nbsp;public&nbsp;a&nbsp;=&nbsp;5;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;address&nbsp;logic_pointer&nbsp;=&nbsp;address(new&nbsp;LogicContract());&nbsp;&nbsp;&nbsp;//Address&nbsp;of&nbsp;the&nbsp;Logic&nbsp;Contract,&nbsp;for&nbsp;testing&nbsp;purpose&nbsp;otherwise&nbsp;we&nbsp;should<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;use&nbsp;an&nbsp;interface&nbsp;with&nbsp;2&nbsp;separate&nbsp;files<br />&nbsp;<br />&nbsp;<br />&nbsp;&nbsp;function&nbsp;setA(uint&nbsp;val)&nbsp;public&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Note:&nbsp;the&nbsp;return&nbsp;value&nbsp;of&nbsp;delegatecall&nbsp;should&nbsp;be&nbsp;checked<br />&nbsp;&nbsp;&nbsp;&nbsp;logic_pointer.delegatecall(abi.encodeWithSignature(&quot;set(uint256)&quot;,&nbsp;val));<br />&nbsp;&nbsp;}<br /><span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><strong>Before setA function</strong> <br />b → <a href=""><img src="images/1430-1.png" alt="images/1430-1.png" /></a><br />a → <a href=""><img src="images/1430-2.png" alt="images/1430-2.png" /></a><br /><br />setA(8) → <a href=""><img src="images/1430-3.png" alt="images/1430-3.png" /></a><br /><br /><strong>After setA function</strong><br />b → <a href=""><img src="images/1430-4.png" alt="images/1430-4.png" /></a><br />a → <a href=""><img src="images/1430-5.png" alt="images/1430-5.png" /></a><br /><br /><strong>When we have set the value of &quot;a”, </strong><strong><span style="text-decoration:underline;">the value of “b” was the value that changed</span></strong><strong>. Why?</strong><br />When using a delegatecall we are executing the set function in the <span style="color:#00ff00;">logic contract</span> under the context of the <span style="color:#ff8700;">calling contract</span> which has those 3 variables with “b” being the first variable<br />Essentially the <span style="color:#00ff00;">logic contract</span> only knows about the “a” variable and sets the first element in the memory to that value. However, we are in the context of the <span style="color:#ff8700;">calling contract</span>, and the calling contracts first memory slot is the variable “b”.<br />The “b” value is overwritten because it is the first slot defined in the memory of the <span style="color:#ff8700;">calling contract</span> and the <span style="color:#00ff00;">logic contract</span> only knows about a single variable “a” in its own contract thus overwriting the value in the first slot of memory.<br /><a href=""><img src="images/1430-6.png" alt="images/1430-6.png" /></a></div>
</body>
</html>
