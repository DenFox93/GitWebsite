<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>DNSSEC: make dns more secure</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>DNSSEC: make dns more secure</h1><br /><strong>DNS Zone</strong><br />Each DNS zone has a DNS
    Resource Recourd (zone file) that contain resource records: SOA, NS, A, MX,...<br /><br /><strong>
      <h3>How to make DNS more secure: DNSSEC </h3>
    </strong><br /><a
      href="_(Windows_&_Linux)--Cryptography_and_Password_Cracking--Cryptography--Public_Key_Infrastructure_(PKI)--Trust_Chain_(Hierarchical)--DNSSEC.html">In
      the chapter linked here there is a more in dept explanation of DNSSEC</a>. <br />DNSSEC creates a secure domain
    name system by adding signed records with private keys to existing DNS records. <br /> By checking these signed
    records with the correspondent public key, it is possible verify that a requested DNS record comes from its
    authoritative name server and wasn’t altered en-route, opposed to a fake record injected in a man-in-the-middle
    attack.<br />Similar to HTTPS, DNSSEC adds a layer of security by enabling authenticated answers on top of an
    otherwise insecure protocol. Whereas HTTPS encrypts traffic so nobody on the wire can snoop on your Internet
    activities, DNSSEC merely signs responses so that forgeries are detectable.<br />It make DNS little bit more secure
    but a chain is strong as its weak link. <br /><br /><strong>How to know if a Zone Support DNSSEC?<br /></strong>We
    have to ask to the domain for DNS public key<br />
    <div class="codebox">
      <div class="codebox">
        dig&nbsp;-t&nbsp;DNSKEY&nbsp;@1.1.1.1&nbsp;&lt;domain&gt;&nbsp;<br />dig&nbsp;-t&nbsp;DNSKEY&nbsp;@1.1.1.1&nbsp;&lt;domain&gt;&nbsp;+trace&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#if&nbsp;we&nbsp;want&nbsp;to&nbsp;trace&nbsp;all&nbsp;the&nbsp;server&nbsp;queried
      </div>
    </div><br />In the following interesting article we can find which registrar support DNSSEC and why is still an
    unpopular protocol<br /><a
      href="https://blog.apnic.net/2017/12/06/dnssec-deployment-remains-low/" target="_blank">https://blog.apnic.net/2017/12/06/dnssec-deployment-remains-low/</a><br /><br /><br /><strong>Vulnerabilities
      and problems with DNSSEC</strong><br />• domains that use DNSSEC can be used for <a
      href="Home--Penetration_Test_Methodology--Network_Pentest--Vulnerability_assessment--Manual_Testing--DNS--DNS_Amplification_Attack.html">DNS
      Amplification Attacks</a>, because they can transform a query into a response with an amplification factor of
    nearly 30 times. This happen when they respond to the ANY command<br />
    <div class="codebox">
      <div class="codebox">dig&nbsp;-t&nbsp;ANY&nbsp;+multiline&nbsp;@8.8.8.8&nbsp;accenture.com</div>
    </div><br /> ◇ query:<br /> <a href=""><img src="images/1037-1.png" alt="images/1037-1.png" /></a><br /> ◇
    response:<br /> <a href=""><img src="images/1037-2.png" alt="images/1037-2.png" /></a><br /> <a href=""><img
        src="images/1037-3.png" alt="images/1037-3.png" /></a><br /> This is been an amplification of 3860/121=32x<br />
    <span style="text-decoration:underline;">Solution</span>:<br /> Set the DNS to not respond to “ANY” queries or have
    a mechanism in place to identify and prevent misuse. As recommend by <a
      href="https://www.mspinsights.com/doc/research-shows-dnssec-vulnerabilities-prolific-0001" target="_blank">Neustar</a><br />•
    DNSSEC increase the query response time:<br /> DNSSEC significantly increases the size of DNS response packets,
    which drastically increases the computational load on the DNS servers and also increases the query response
    time<br />• Install Fake Root Keys in a PC would compromise the chain of trust. <a
      href="file://C:/CherryTree/Files/Cryptography/Installing Fake Root Keys in a PC.pdf">Here the paper</a><br />•
    DNSSEC requires time synchronization(like other protocols), if attacker can cause disruption in the synchronization
    then DNSSEC fails to work properly<br />• Zonewalking: By using the NSEC records is possible to enumerate the
    subdomains in a zone. It is better use NSEC3<br /> For more see here: <a
      href="https://appsecco.com/books/subdomain-enumeration/active_techniques/zone_walking.html" target="_blank">https://appsecco.com/books/subdomain-enumeration/active_techniques/zone_walking.html</a><br />
    <div class="codebox">
      <div class="codebox">
        dig&nbsp;-t&nbsp;NSEC&nbsp;&lt;DNSSEC-domain&gt;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#continue&nbsp;to&nbsp;search&nbsp;with&nbsp;the&nbsp;subdomain&nbsp;found
      </div>
    </div><br /> automate it with this script<br />
    <div class="codebox">
      <div class="codebox">
        #!/bin/bash<br />domain=$1<br />echo&nbsp;&gt;&nbsp;domains.txt<br />while&nbsp;true;&nbsp;do<br />&nbsp;&nbsp;&nbsp;&nbsp;value=$(dig&nbsp;-t&nbsp;nsec&nbsp;$domain&nbsp;+short&nbsp;|&nbsp;awk&nbsp;&#39;{print&nbsp;$1;}&#39;&nbsp;)<br />&nbsp;&nbsp;&nbsp;&nbsp;domain=$value<br />&nbsp;&nbsp;&nbsp;&nbsp;lines1=$(grep&nbsp;-c&nbsp;^&nbsp;domains.txt)<br />&nbsp;&nbsp;&nbsp;&nbsp;grep&nbsp;-qxF&nbsp;--&nbsp;&quot;$domain&quot;&nbsp;&quot;domains.txt&quot;&nbsp;||&nbsp;echo&nbsp;&quot;$domain&quot;&nbsp;|&amp;&nbsp;tee&nbsp;-a&nbsp;&quot;domains.txt&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;lines2=$(grep&nbsp;-c&nbsp;^&nbsp;domains.txt)<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;[[&nbsp;$lines2&nbsp;-eq&nbsp;1&nbsp;]];&nbsp;then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;echo&nbsp;&quot;Sorry&nbsp;i&nbsp;have&nbsp;not&nbsp;found&nbsp;NSEC&nbsp;records&nbsp;:(&quot;<br />&nbsp;&nbsp;&nbsp;&nbsp;fi<br />&nbsp;&nbsp;&nbsp;&nbsp;if&nbsp;[[&nbsp;$lines2&nbsp;-eq&nbsp;$lines1&nbsp;]];&nbsp;then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;break<br />&nbsp;&nbsp;&nbsp;&nbsp;fi<br />done
      </div>
    </div><br /><br /><br /><br /><br /><br /><br /><br /><br />Bibliography:<br />• “Hands on Hacking: Become an Expert
    at Next Gen Penetration Testing and Purple Teaming” Matthew Hickey, Jennifer Arcuri<br />• <a
      href="https://docstore.mik.ua/orelly/networking_2ndEd/dns/ch11_04.htm" target="_blank">https://docstore.mik.ua/orelly/networking_2ndEd/dns/ch11_04.htm</a><br />•
    <a
      href="https://www.cloudflare.com/dns/dnssec/how-dnssec-works/" target="_blank">https://www.cloudflare.com/dns/dnssec/how-dnssec-works/</a><br />•
    <a
      href="https://metebalci.com/blog/a-minimum-complete-tutorial-of-dnssec/" target="_blank">https://metebalci.com/blog/a-minimum-complete-tutorial-of-dnssec/</a><br />•
    <a
      href="https://blog.apnic.net/2017/12/06/dnssec-deployment-remains-low/" target="_blank">https://blog.apnic.net/2017/12/06/dnssec-deployment-remains-low/</a><br />•
    <a
      href="https://blog.apnic.net/2017/12/06/dnssec-deployment-remains-low/" target="_blank">https://blog.apnic.net/2017/12/06/dnssec-deployment-remains-low/</a>
  </div>
</body>

</html>