<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>grepable format</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>grepable format</h1><br/>1. scan with nmap and save on file<br />    <div class="codebox"><div class="codebox">nmap&nbsp;-sS&nbsp;-n&nbsp;192.168.1.97&nbsp;-oN&nbsp;nmapResult<br />cat&nbsp;nmapResult</div></div><br />    <a href=""><img src="images/1817-1.png" alt="images/1817-1.png" /></a><br />2. extraction of open ports<br />    <div class="codebox"><div class="codebox">./openPorts-grepable.rb&nbsp;192.168.1.97&nbsp;&nbsp;nmapResult</div></div><br />    <a href=""><img src="images/1817-2.png" alt="images/1817-2.png" /></a><br /><br /><strong><h2>Description of </h2></strong><strong><h2>openPorts-grepable.rb</h2></strong><strong><h2> script file</h2></strong><br /><strong>regular expressions used in openPorts-grepable.rb</strong><br />1. host is up (up_host) →  <code>/^Host:\s#{ip}\s\(\)\s+Status: Up/</code><br />   ◇ line 26<br />        <div class="codebox"><div class="codebox">line.match(up_host)&nbsp;do</div></div><br />2. port found (port_pattern) →  <code>/(?:\s(\d+)\/#{port_state}\/[^\/]+\/\/[^\/]+\/\/\/)/</code><br />   ◇ line 28<br />        <div class="codebox"><div class="codebox">stream.readline.scan(port_pattern)&nbsp;<span style="color:#000000;font-weight:400">{</span>|port|&nbsp;puts&nbsp;port<span style="color:#000000;font-weight:400">}</span></div></div><br /><br /><br /><span style="color:#ff8700;">openPorts-grepable.rb</span><br /><div class="codebox"><div class="codebox">#!/usr/bin/ruby<br />begin<br /><br />	#&nbsp;escape&nbsp;all&nbsp;the&nbsp;dots&nbsp;(.)&nbsp;-&gt;&nbsp;ip&nbsp;is&nbsp;used&nbsp;in&nbsp;<br />	#&nbsp;ip_pattern&nbsp;regular&nbsp;expression<br />	ip&nbsp;=&nbsp;ARGV[0].gsub(&quot;.&quot;,&quot;\\.&quot;)<br />	<br />	#&nbsp;chek&nbsp;if&nbsp;the&nbsp;state&nbsp;optional&nbsp;argument&nbsp;is&nbsp;provided<br />	port_state&nbsp;=&nbsp;ARGV[1][1..-1]&nbsp;if&nbsp;[&quot;-open&quot;,&quot;-closed&quot;,&quot;-filtered&quot;].include?&nbsp;ARGV[1]<br />	#&nbsp;otherwise&nbsp;default&nbsp;state&nbsp;is&nbsp;&quot;open&quot;<br />	port_state&nbsp;=&nbsp;&quot;open&quot;&nbsp;if&nbsp;!port_state<br /><br />	#&nbsp;check&nbsp;if&nbsp;argument&nbsp;is&nbsp;the&nbsp;file<br />	file&nbsp;=&nbsp;ARGV[2]&nbsp;if&nbsp;ARGV[2]<br />	file&nbsp;=&nbsp;ARGV[1]&nbsp;if&nbsp;!file<br /><br />	stream&nbsp;=&nbsp;File.new(file,&quot;r&quot;)<br />	<br /><br />	up_host&nbsp;=&nbsp;/^Host:\s#{ip}\s\(\)\s+Status:&nbsp;Up/<br />	port_pattern&nbsp;=&nbsp;/(?:\s(\d+)\/#{port_state}\/[^\/]+\/\/[^\/]+\/\/\/)/<br /><br />	#&nbsp;for&nbsp;each&nbsp;line&nbsp;of&nbsp;the&nbsp;stream<br />	stream.each&nbsp;do&nbsp;|line|<br />		#&nbsp;if&nbsp;the&nbsp;ip&nbsp;is&nbsp;found<br />		line.match(up_host)&nbsp;do&nbsp;<br />			#&nbsp;reads&nbsp;the&nbsp;next&nbsp;line&nbsp;and&nbsp;extracts&nbsp;each&nbsp;port&nbsp;with&nbsp;scan&nbsp;method<br />			stream.readline.scan(port_pattern)&nbsp;{|port|&nbsp;puts&nbsp;port}<br />		end<br />	end<br />	<br /><br />rescue&nbsp;Exception&nbsp;=&gt;&nbsp;e<br />	puts&nbsp;e<br />end<br /><br /></div></div></div>
</body>
</html>
