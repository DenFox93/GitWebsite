<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>TCP server skeletons</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>TCP server skeletons</h1><br/><br /><strong>TCP server skeleton</strong><br />Not suitable to handle a large number of client connections at the same time<br /><div class="codebox"><div class="codebox">#!/usr/bin/ruby<br /><br />require&nbsp;&#39;socket&#39;<br /><br />def&nbsp;main(ip,port)<br />	#&nbsp;new&nbsp;TCP&nbsp;server&nbsp;bound&nbsp;to&nbsp;ip&nbsp;and&nbsp;port&nbsp;provided&nbsp;as&nbsp;argument<br />	server&nbsp;=&nbsp;TCPServer.new&nbsp;ip,port<br />	#&nbsp;loop&nbsp;indefinitely&nbsp;to&nbsp;accept&nbsp;clients&nbsp;requests<br />	loop&nbsp;do<br />		#&nbsp;accept&nbsp;new&nbsp;client&nbsp;request&nbsp;(client&nbsp;is&nbsp;a&nbsp;socket)<br />		client&nbsp;=&nbsp;server.accept<br />		#&nbsp;prints&nbsp;the&nbsp;client&nbsp;information&nbsp;(IP&nbsp;and&nbsp;port)<br />		print&nbsp;Time.new.to_s&nbsp;+&nbsp;&quot;&nbsp;-&nbsp;IP:&nbsp;&quot;+client.peeraddr[3]<br />		print&nbsp;&quot;&nbsp;Port:&nbsp;&quot;+client.peeraddr[1].to_s+&quot;\n&quot;<br />		#.......<br />		#CODE<br />		#....<br />	end<br />end<br /><br />begin<br />	ip&nbsp;=&nbsp;ARGV[0]<br />	port&nbsp;=&nbsp;ARGV[1]<br />	main(ip,port)<br />rescue&nbsp;Exception&nbsp;=&gt;&nbsp;e<br />	puts&nbsp;e<br />end</div></div><br /><br /><strong>multi-threading TCP server skeleton</strong><br /><div class="codebox"><div class="codebox">#!/usr/bin/ruby<br /><br />require&nbsp;&#39;socket&#39;<br /><br />def&nbsp;main(ip,port)<br />	#&nbsp;new&nbsp;TCP&nbsp;server&nbsp;bound&nbsp;to&nbsp;ip&nbsp;and&nbsp;port&nbsp;provided&nbsp;as&nbsp;argument<br />	server&nbsp;=&nbsp;TCPServer.new&nbsp;ip,port<br />	#&nbsp;loop&nbsp;indefinitely&nbsp;to&nbsp;accept&nbsp;clients&nbsp;requests<br />	loop&nbsp;do<br />		#&nbsp;accept&nbsp;new&nbsp;client&nbsp;requests&nbsp;(client&nbsp;is&nbsp;a&nbsp;socket)<br />		#logic&nbsp;block&nbsp;is&nbsp;executed&nbsp;in&nbsp;a&nbsp;new&nbsp;block<br />		Thread.start(server.accept)&nbsp;do&nbsp;|client|<br />		&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;prints&nbsp;the&nbsp;client&nbsp;information&nbsp;(IP&nbsp;and&nbsp;port)<br />		&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;Time.new.to_s&nbsp;+&nbsp;&quot;&nbsp;-&nbsp;IP:&nbsp;&quot;+client.peeraddr[3]<br />		&nbsp;&nbsp;&nbsp;&nbsp;print&nbsp;&quot;&nbsp;Port:&nbsp;&quot;+client.peeraddr[1].to_s+&quot;\n&quot;<br />		&nbsp;&nbsp;&nbsp;&nbsp;#.......<br />		&nbsp;&nbsp;&nbsp;&nbsp;#CODE<br />		&nbsp;&nbsp;&nbsp;&nbsp;#....<br />		end<br />	end<br />end<br /><br />begin<br />	ip&nbsp;=&nbsp;ARGV[0]<br />	port&nbsp;=&nbsp;ARGV[1]<br />	main(ip,port)<br />rescue&nbsp;Exception&nbsp;=&gt;&nbsp;e<br />	puts&nbsp;e<br />end</div></div></div>
</body>
</html>
