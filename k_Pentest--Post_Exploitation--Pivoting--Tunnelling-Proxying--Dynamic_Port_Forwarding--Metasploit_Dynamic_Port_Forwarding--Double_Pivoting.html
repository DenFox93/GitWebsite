<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Double Pivoting</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Double Pivoting</h1><br /><br />From the meterpreter shell of the <span
      style="text-decoration:underline;">Second pivot host</span><br />
    <div class="codebox">
      <div class="codebox">
        meterpreter&gt;&nbsp;run&nbsp;autoroute&nbsp;-s&nbsp;8.8.8.0/24<br />msf&gt;&nbsp;route&nbsp;print</div>
    </div><br /><br /><br />Set a new rule fro the Socks Proxy<br />
    <div class="codebox">
      <div class="codebox">
        msf&nbsp;&gt;&nbsp;use&nbsp;auxiliary/server/socks_proxy<br />msf&nbsp;auxiliary(server/socks_proxy)&nbsp;&gt;&nbsp;options<br />msf&nbsp;auxiliary(server/socks_proxy)&nbsp;&gt;&nbsp;set&nbsp;SRVHOST&nbsp;[attacker_ip_in_network]<br />msf&nbsp;auxiliary(server/socks_proxy)&nbsp;&gt;&nbsp;set&nbsp;SRVPORT&nbsp;1081&nbsp;&nbsp;&nbsp;&nbsp;#not&nbsp;108o&nbsp;where&nbsp;there&nbsp;is&nbsp;already&nbsp;the&nbsp;first&nbsp;socksproxy&nbsp;rule<br />msf&nbsp;auxiliary(server/socks_proxy)&nbsp;&gt;&nbsp;set&nbsp;version&nbsp;4a&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;we&nbsp;need&nbsp;to&nbsp;use&nbsp;&quot;socks4&quot;&nbsp;in&nbsp;proxychains.conf<br />#OR<br />msf&nbsp;auxiliary(server/socks_proxy)&nbsp;&gt;&nbsp;set&nbsp;version&nbsp;5&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;we&nbsp;need&nbsp;to&nbsp;use&nbsp;&quot;socks5&quot;&nbsp;in&nbsp;proxychains.conf<br />msf&nbsp;auxiliary(server/socks_proxy)&nbsp;&gt;&nbsp;run
      </div>
    </div><br /><br /> activate the Dynamic Chain setting in /etc/proxychains.conf<br />
    <div class="codebox">
      <div class="codebox">root@kali:/#&nbsp;echo&nbsp;&quot;dynamic_chain&quot;&nbsp;&gt;&nbsp;/etc/proxychains.conf
      </div>
    </div><br /><br />Set up another proxy on port 1081<br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;echo&nbsp;&quot;socks4&nbsp;[attacker_ip_in_network]&nbsp;1081&quot;&nbsp;&gt;&nbsp;/etc/proxychains.conf
      </div>
    </div><br /><br /><br /><br />Bibliography:<br /><a
      href="https://pentest.blog/explore-hidden-networks-with-double-pivoting/" target="_blank">https://pentest.blog/explore-hidden-networks-with-double-pivoting/</a><br /><a
      href="https://viperone.gitbook.io/pentest-everything/everything/pivoting-and-portforwarding#double-pivot" target="_blank">https://viperone.gitbook.io/pentest-everything/everything/pivoting-and-portforwarding#double-pivot</a>
  </div>
</body>

</html>