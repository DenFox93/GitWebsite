<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>CVE-2012-2122 </title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>CVE-2012-2122 </h1><br /><strong>CVE-2012-2122</strong> → Exploitable in some versions of MySQL
    and MariaDB database servers. <br /> ◇ Here an in deep explanation of the vulnerability <a
      href="https://www.mathyvanhoef.com/2012/06/mysql-authentication-bypass-explained.html" target="_blank">Mathy Vanhoef</a><br /> ◇
    Explanation of the vulnerability in brief:<br /> ▪ The vulnerability reside in the file <a
      href="https://bazaar.launchpad.net/~maria-captains/maria/5.1/view/3143/sql/password.c#:~:text=return%20memcmp" target="_blank">sql/password.c</a>
    → check_scramble → memcmp. This code<span style="color:#444444;"> </span>checks if the supplied password is correct.
    <br /> ▪ From the manual of memcmp:<br /> “<em>The memcmp(s1, s2, n) function returns an integer </em><em><span
        style="text-decoration:underline;">less than</span></em><em>, equal to, or </em><em><span
        style="text-decoration:underline;">greater than zero</span></em><em> if the first n bytes of s1 is found,
      respectively, to be less than, to match, or be greater than the first n bytes of s2</em>”<br /> ▪ Implementations
    of memcmp:<br /> - most of them return only -1, 0, or 1<br /> - others return a value within the range -128(in
    binary -10000000)to 127(in binary 1111111). this in this implementation memcmp compare two bytes by subtracting them
    and then return the result of the subtraction<br /> → some of these implementations of memcmp to speed up the
    comparison by subtract multiple bytes at once, the result of these is included between
    -10000000000000000000000000000000 and 1111111111111111111111111111111<br /> ▪ So what happens when our
    implementation of memcmp, when the password does not match does not return a value between -128 and 127?<br /> 1-
    memcmp is casted to my_bool by check_scramble(the function where reside memcmp) <br /> 2- my_bool is a <a
      href="https://bazaar.launchpad.net/~mysql/mysql-server/5.1/view/3560.10.17/include/my_global.h#L1108" target="_blank">typedef of
      char</a>. The char type can contain both positive and negative values. The range of values is from -128 to
    127<br /> 3- because char in C is only 8 bits the result of memcmp will be truncated and only the last byte will be
    taken in consideration<br />
    <table class="table">
      <tr>
        <th>int return memcmp</th>
        <th>binary value</th>
        <th>char value</th>
      </tr>
      <tr>
        <td>256</td>
        <td>100000000</td>
        <td>0</td>
      </tr>
      <tr>
        <td>512</td>
        <td>1000000000</td>
        <td>0</td>
      </tr>
      <tr>
        <td>768</td>
        <td>1100000000 </td>
        <td>0</td>
      </tr>
      <tr>
        <td>1024</td>
        <td>10000000000</td>
        <td>0</td>
      </tr>
      <tr>
        <td>1280</td>
        <td>10100000000</td>
        <td>0</td>
      </tr>
    </table><br /> Here a <a href="https://gist.github.com/slava-vishnyakov/2909542" target="_blank">small script</a>(in C) by Joshua J.
    Drake that check if memcmp return values not between -128 and 127<br /><strong>Bruteforce and try to login with root
      privileges</strong><br />
    <div class="codebox">
      <div class="codebox">
        daniele@linux:~$&nbsp;&nbsp;for&nbsp;i&nbsp;in&nbsp;`seq&nbsp;1&nbsp;1000`;&nbsp;do&nbsp;mysql&nbsp;-u&nbsp;root&nbsp;--password=bad&nbsp;-h&nbsp;127.0.0.1&nbsp;2&gt;/dev/null;&nbsp;done
      </div>
    </div><br /> <br /><strong>Vulnerable Systems</strong><br />A vulnerable system from CVE-2012-2122 need to have both
    a vulnerable RDBMS and OS<br />• One of the following RDBMSs: MySQL or MariaDB<br /> ◇ MySQL 5.1.x before 5.1.63,
    5.5.x before 5.5.24, and 5.6.x before 5.6.6, <br /> ◇ MariaDB 5.1.x before 5.1.62, 5.2.x before 5.2.12, 5.3.x before
    5.3.6, and 5.5.x before 5.5.23<br />• One of the following OS <br /> ◇ Ubuntu Linux 64-bit ( 10.04, 10.10, 11.04,
    11.10, 12.04 )<br /> ◇ OpenSuSE 12.1 64-bit MySQL 5.5.23-log <br /> ◇ Debian Unstable 64-bit 5.5.23-2<br /> ◇
    Fedora<br /> ◇ Arch Linux <br />
  </div>
</body>

</html>