<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>9.NFS root squashing(ports 111,2049)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>9.NFS root squashing(ports 111,2049)</h1><br/><br />• NFS (Network File System) is a popular distributed file system.<br />• NFS shares are configured in the /etc/exports file.<br />• Remote users can mount shares, access, create, modify files.<br />• By default, created files inherit the remote user’s id and group id (as owner and group respectively), even if they don’t exist on the NFS server.<br /><br /><strong><h3>Check for NFS root squashing vulnerability</h3></strong><br />   ◇  Check from the target: Check the contents of /etc/exports for shares with the <strong>no_root_squash</strong> option:<br />        <div class="codebox"><div class="codebox">target@debian:~$&nbsp;cat&nbsp;/etc/exports</div></div><br />   ◇ Show the NFS server’s export list:<br />        <div class="codebox"><div class="codebox">attacker@kali:/#&nbsp;showmount&nbsp;--exports&nbsp;<span style="color:#000000;font-weight:400">&lt;</span>target<span style="color:#000000;font-weight:400">&gt;</span></div></div><br />        <a href=""><img src="images/1315-1.png" alt="images/1315-1.png" /></a><br />   ◇ Nmap scripts:<br />       Once we have found a NFS ports open, we can use some nmap NSE scripts to know more<br />      ▪ <span style="color:#ff8700;">nfs-ls.nse → Access rights + Available Exports files (Directory Listing)</span> <br />      ▪ <span style="color:#00ff00;">nfs-showmount.nse → Available Export folder</span><br />      ▪ <span style="color:#ff00e0;">nfs-statfs.nse </span><br />        <div class="codebox"><div class="codebox">root@kali:/#&nbsp;ls&nbsp;/usr/share/nmap/scripts/&nbsp;|&nbsp;grep&nbsp;nfs</div></div><br />            <a href=""><img src="images/1315-2.png" alt="images/1315-2.png" /></a><br />        <div class="codebox"><div class="codebox">root@kali:/#&nbsp;nmap&nbsp;--script&nbsp;nfs-ls,nfs-showmount,nfs-statfs&nbsp;<span style="color:#000000;font-weight:400">&lt;</span>IP&nbsp;Address<span style="color:#000000;font-weight:400">&gt;</span></div></div><br />             <a href=""><img src="images/1315-3.png" alt="images/1315-3.png" /></a><br /><br />   ◇ Mount an NFS share:<br />        <div class="codebox"><div class="codebox">attacker@kali:/#&nbsp;mount&nbsp;-t&nbsp;nfs&nbsp;-o&nbsp;rw,vers=2,nolock&nbsp;192.168.1.25:[remoteDirectory]&nbsp;[localDirectory]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#now&nbsp;attacker&nbsp;and&nbsp;target&nbsp;are&nbsp;sharing&nbsp;the&nbsp;folder</div></div><br />        mount options:<br />         - -o, --options &lt;list&gt; → comma-separated list of mount options<br />            → -w, --rw, --read-write → mount the filesystem read-write (default)<br />            → vers=&lt;number&gt; → select the nfs version, we should specify to use version 2 because if it doesn&#39;t have any authentication or authorization.<br />            → nolock → disables file locking. This setting is occasionally required when connecting to older NFS servers.<br />         - -t, --types &lt;list&gt; → limit the set of filesystem types<br />        <a href=""><img src="images/1315-4.png" alt="images/1315-4.png" /></a><br /><br /><strong><h3>Vulnerability</h3></strong><br />• <span style="text-decoration:underline;">Any Ip address can mount folder</span><br />    If the exported directory, like in our case is followed by a “*” value, means that is allowed mounting them from any IP address or host.<br />• <span style="text-decoration:underline;">Only Whitelisted Ip Address can mount folder</span><br />    Ideally an administrator should explicitly define (whitelist) IP addresses or hosts that should be allowed to connect to the NFS server<br />    Even in the case where our access is restricted due to an NFS whitelist configuration like the above, the output still gives us valuable information regarding which IP addresses or hosts can mount the available exports.<br />    In this scenario<br />   ◇ we have to check if we can spoof our IP address to match a whitelisted IP address or take control of a host which is allowed to connect.<br /><br /><strong><h3>Root Squashing</h3></strong><br />Root Squashing is how NFS prevents an obvious privilege escalation.<br />If the remote user is (or claims to be) root (uid=0), NFS will instead “squash” the user and treat them as if they are the “nobody” user, in the “nogroup” group. <span style="text-decoration:underline;">While this behavior is default, it can be disabled!</span><br /><strong>Disable Root Squashing</strong><br />no_root_squash is an NFS configuration option which turns root squashing off.<br />When included in a writable share configuration, a remote user who identifies as “root” can create files on the NFS share as the local root user.<br /><br /></div>
</body>
</html>
