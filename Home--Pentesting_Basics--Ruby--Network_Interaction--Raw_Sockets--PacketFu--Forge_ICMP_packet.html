<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Forge ICMP packet</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Forge ICMP packet</h1><br /><strong>
      <h3>ICMPPacket class</h3>
    </strong>
    <h3> (</h3><a
      href="https://github.com/todb/packetfu/blob/master/lib/packetfu/protos/icmp.rb" target="_blank">https://github.com/todb/packetfu/blob/master/lib/packetfu/protos/icmp.rb</a>
    <h3>)</h3><br /><br />
    <div class="codebox">
      <div class="codebox">require&nbsp;&quot;packetfu&quot;<br />include&nbsp;PacketFu</div>
    </div><br /><a href=""><img src="images/1972-1.png" alt="images/1972-1.png" /></a><br /><br />
    <div class="codebox">
      <div class="codebox">i=&nbsp;ICMPPacket.new</div>
    </div><br /> <a href=""><img src="images/1972-2.png" alt="images/1972-2.png" /></a><br /><br />Check the
    documentation to know how to set these values:<br />• ETHHeader: <a
      href="https://www.rubydoc.info/github/todb/packetfu/PacketFu/EthHeader" target="_blank">https://www.rubydoc.info/github/todb/packetfu/PacketFu/EthHeader</a><br />•
    IPHeader: <a
      href="https://www.rubydoc.info/github/todb/packetfu/PacketFu/IPHeader" target="_blank">https://www.rubydoc.info/github/todb/packetfu/PacketFu/IPHeader</a><br />•
    ICMPHeader: <a
      href="https://www.rubydoc.info/github/todb/packetfu/PacketFu/ICMPHeader" target="_blank">https://www.rubydoc.info/github/todb/packetfu/PacketFu/ICMPHeader</a><br /><br /><strong>How
      send an ICMP packet</strong><br />To send an UDP packet you need to set the following fields:<br /> ◇ eth_saddr →
    source MAC address<br /> ▪ Check Utils.whoami?[:eth_saddr]<br /> <a href=""><img src="images/1972-3.png"
        alt="images/1972-3.png" /></a><br /> ◇ eth_daddr → destination MAC address <br /> ▪ destination outside our
    local network → MAC address of the default gateway<br /> - Check Utils.whoami?[:eth_daddr]<br /> <a href=""><img
        src="images/1972-4.png" alt="images/1972-4.png" /></a><br /> ▪ destination inside of the local network → MAC
    address of the destination<br /> - Utils.arp(&quot;[IP_Address_destination]&quot;)<br /> ◇ ip_daddr →
    destination address<br /> ◇ ip_saddr → source address<br /> ◇ icmp_type → determines what the ICMP packet is used
    for<br /> ◇ icmp_code → <br /> <br />
    <div class="codebox">
      <div class="codebox">
        i=&nbsp;ICMPPacket.new<br />i.eth_saddr=&quot;00:0c:29:90:45:a8&quot;&nbsp;&nbsp;#source&nbsp;MAC&nbsp;address<br />i.eth_daddr=&quot;00:50:56:f3:2d:fd&quot;&nbsp;&nbsp;#destination&nbsp;MAC&nbsp;address<br />i.ip_saddr=&quot;192.168.3.136&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#ip&nbsp;source&nbsp;address<br />i.ip_daddr=&nbsp;&quot;8.8.8.8&quot;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#ip&nbsp;destination&nbsp;address<br />i.icmp_type=8&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />i.icmp_code=0&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<br />i.payload=&quot;some&nbsp;data&nbsp;here...&quot;&nbsp;&nbsp;&nbsp;&nbsp;#icmp&nbsp;echo&nbsp;request&nbsp;have&nbsp;also&nbsp;a&nbsp;data&nbsp;field<br />i.recalc&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#use&nbsp;first&nbsp;always&nbsp;recalc,&nbsp;in&nbsp;order&nbsp;to&nbsp;calculate&nbsp;the<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#&nbsp;checksum&nbsp;of&nbsp;the&nbsp;modified&nbsp;packet<br />i.to_w&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#To&nbsp;send&nbsp;the&nbsp;packet<br />
      </div>
    </div><br /> <a href=""><img src="images/1972-5.png" alt="images/1972-5.png" /></a><br /> <a href=""><img
        src="images/1972-6.png" alt="images/1972-6.png" /></a><br /><br /><br /><br /><strong>Fast Way: The parameters
      below can be set automatically (no spoofing)</strong><br /><span style="color:#ff0000;">WARNING if the destination
      is in the local network:</span> this method will set the <span style="text-decoration:underline;">destination MAC
      address(eth_daddr/eth_dst)</span> at the default gateway, but if the target is inside the local network, we need
    to set directly the MAC address of the target and not of the default gateway.<br />• eth_saddr →
    source MAC address<br />• eth_daddr → destination MAC address<br />• ip_saddr → ip source address<br />with this
    command:<br />
    <div class="codebox">
      <div class="codebox">i=ICMPPacket.new<span
          style="color:#000000;font-weight:400">(</span>:config&nbsp;=&gt;&nbsp;Utils.whoami?<span
          style="color:#000000;font-weight:400">)</span></div>
    </div><br /> <a href=""><img src="images/1972-7.png" alt="images/1972-7.png" /></a>
  </div>
</body>

</html>