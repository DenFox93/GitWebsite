<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Pass the Hashes</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Pass the Hashes</h1><br /><br />With pass-the-hash technique attack, the attacker can gain access
    to the password hashes and use them directly for authentication. This kind of attack, is most often applied against
    Windows targets, although this kind of flaw is also found in some other systems, such as vulnerable web
    applications<br />The attacker may grab the password hashes by dumping them from a Windows SAM database (a process
    that requires admin privileges) or by dumping a database from a domain controller.<br /><br /><strong>
      <h3>How work the Pass the Hash technique</h3>
    </strong><br />1. The attacker steals password hashes from the target environment<br />2. The attacker instead of
    cracking those passwords, strips off the hash for a given user (likely one in the administrator&#39;s group) and
    carefully places it in the memory of the Local Security Authority Subsystem Service (LSASS) of an
    attacker-controlled machine<br />3. The attacker can simply use various Windows file and print sharing tools to
    access the target system, with Windows automatically presenting the user&#39;s credentials to the target, thereby
    bypassing any need for providing an actual password.<br /><a
      href="file://C:/CherryTree/screenshots2/PTP-elearnsecurity/2. Network Security/6. Post Exploitation/passTheHash.png"><img
        src="images/385-1.png" alt="images/385-1.png" /></a><br /><br /><strong>
      <h3>Why use Pass the Hash technique</h3>
    </strong><br />This type of attack require that the attacker have admin privileges to get access to the hashes in
    the first place(Step 1).<br /><span style="text-decoration:underline;">But if the attacker already has admin
      privileges, why bother using pass-the-hash to obtain, well, the same admin privileges?</span><br />Because with
    pass-the-hash have flexible access to the machine, without requiring any time-consuming password
    cracking.<br /><br /><strong>
      <h3>Which Hashes use</h3>
    </strong><br />Use one of the tools seen in <a
      href="st--Post_Exploitation--Privilege_Escalation--Windows_Privilege_Escalation--4._Passwords--Dump_&_Crack_the_Hashes--Passowrds_Dumping_Tools.html">Passwords
      Dumping Tools</a> to dump the hashes of the machine and check for each account if you can Pass the Hash<br /><span
      style="text-decoration:underline;">Note</span>(<a
      href="https://www.offensive-security.com/metasploit-unleashed/psexec-pass-hash/" target="_blank">source</a>): if when we dump the
    hashes only NTLM is available (for example its a 15+ character password or through GPO they specify NTLM response
    only), simply replace the ****NOPASSWORD**** with 32 0’s for <span style="color:#a52a2a;">example:</span><br />
    <div class="codebox">
      <div class="codebox">******NOPASSWORD*******:8846f7eaee8fb117ad06bdd830b7586c</div>
    </div><br /> replaced with<br />
    <div class="codebox">
      <div class="codebox">00000000000000000000000000000000:8846f7eaee8fb117ad06bdd830b7586c</div>
    </div><br /><strong><span style="color:#ff0000;">Possible errors:</span></strong><br />If we have as output
    STATUS_ACCESS_DENIED is because &quot;SMB signing&quot; is enabled (as we will seen in <a
      href="t_Methodology--Network_Pentest--Sniffing-Spoofing-Poisoning--NetNTLM_attacks--How_Increase_security_against--NTLM_relay_attacks_using_SMB.html">Increase
      Security</a> chapter). Good for the company :)<br />
    <div class="codebox">
      <div class="codebox">
        PS&gt;&nbsp;reg&nbsp;query&nbsp;HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\LanmanServer\Parameters&nbsp;/v&nbsp;RequireSecuritySignature<br />PS&gt;&nbsp;reg&nbsp;add&nbsp;HKEY_LOCAL_MACHINE\System\CurrentControlSet\Services\LanmanServer\Parameters&nbsp;/v&nbsp;RequireSecuritySignature&nbsp;/t&nbsp;REG_DWORD&nbsp;/d&nbsp;0&nbsp;/f
      </div>
    </div><br /> <a href=""><img src="images/385-2.png" alt="images/385-2.png" /></a><br /> <a href=""><img
        src="images/385-3.png" alt="images/385-3.png" /></a><br />For more information see also <a
      href="t_Methodology--Network_Pentest--Sniffing-Spoofing-Poisoning--NetNTLM_attacks--How_Increase_security_against--NTLM_relay_attacks_using_SMB.html">How
      Increase security against → NTLM relay attack using SMB</a><br /><br /><br /><br /><br /><br /><br /><strong>
      <h3>Bibliography:</h3>
    </strong><br />• Pass-the-Hash in Windows 10: <a
      href="https://www.sans.org/white-papers/33283/" target="_blank">https://www.sans.org/white-papers/33283/</a><br />• Pass-the-hash
    attacks: Tools and Mitigation: <a
      href="https://www.sans.org/white-papers/39170/" target="_blank">https://www.sans.org/white-papers/39170/</a>
  </div>
</body>

</html>