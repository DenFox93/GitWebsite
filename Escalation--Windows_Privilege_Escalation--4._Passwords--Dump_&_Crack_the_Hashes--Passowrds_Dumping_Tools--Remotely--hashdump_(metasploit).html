<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>hashdump (metasploit)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>hashdump (metasploit)</h1><br/><br /><strong><h3>The meterpreter hashdump command </h3></strong><br />The hashdump command is an in-memory version of “pwdump”. Hashdump allocates memory inside a process with administrator or local SYSTEM privileges (usually LSASS process), injects assembly code, and executes it using the CreateThread() function. The injected assembly code of hashdump runs from the within the memory of the exploited process.<br />No files are written to disk, thus detecting the technique without using memory forensic techniques is difficult.<br />  <div class="codebox"><div class="codebox">hashdump&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#from&nbsp;meterpreter</div></div><br /><br />The difference between &quot;hashdump&quot; and &quot;run hashdump&quot; is that &quot;run hashdump&quot; command executes The <a href="tion--Windows_Privilege_Escalation--4._Passwords--Dump_&_Crack_the_Hashes--Passowrds_Dumping_Tools--Remotely--smart_hashdump_(metasploit).html">Smart Hashdump</a> Module of Meterpreter.<br />Smart_hashdump is better, it take in consideration also the simple hashdump.<br /><br />It looks in the file system, pulling the data from the Windows Registry. If the hashes are encrypted in the file system using Windows Syskey, this script attempts to recover the Syskey from the Registry as well and decrypt the hashes so that they can be used or cracked .<br />The caveat is that a SYSTEM token is required to use the technique.  An account in the local administrators group does not have read access to the SAM registry tree that contains the hashes. If you have exploited a system service, or perhaps something like a DCERPC vulnerability, you are in great shape. Alternatively you can consider migrating your meterpreter to a service process, or load the incognito module, and impersonate a token<br />       <div class="codebox"><div class="codebox">meterrpreter&gt;&nbsp;run&nbsp;post/windows/gather/hashdump.rb</div></div><br />       <br /><span style="color:#ff0000;">ATTENTION</span>: In January, 2010, HD Moore noted that Anti-Virus, and host intrusion prevention (HIPS) vendors had developed techniques to detect the API calls made by the meterpreter hashdump command, and block the calls. In the process of detection however, LSASS will often crash leading to system instability.<br /><br />We have covered how to exploit and recover Hashes in a network with Windows machine here → <a href="Home--Penetration_Test_Methodology--Network_Pentest--Sniffing-Spoofing-Poisoning--NetNTLM_attacks.html">LM/NTLMv1 Attack</a> ← <br /><br /><strong><span style="color:#ff1b00;">ERROR: &quot;Operation failed: The parameter is incorrect&quot;</span></strong><br />If hashdump return an error like this:<br /><a href=""><img src="images/751-1.png" alt="images/751-1.png" /></a><br />we can try to <a href="entest--Post_Exploitation--Privilege_Escalation--Meterpreter--migrate_PID_of_the_payload_(hide-stable_conncection_&_session_died_problem).html">migrate to a different process</a> and retry with “run hashdump” aka smart_hashdump that is better<br /><br /></div>
</body>
</html>
