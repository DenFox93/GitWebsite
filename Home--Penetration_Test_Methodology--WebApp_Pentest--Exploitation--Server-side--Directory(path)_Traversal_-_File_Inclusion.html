<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Directory(path) Traversal / File Inclusion</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Directory(path) Traversal / File Inclusion</h1><br />OWASP: <a
      href="https://wiki.owasp.org/index.php/Testing_for_Local_File_Inclusion" target="_blank">https://wiki.owasp.org/index.php/Testing_for_Local_File_Inclusion</a><br /><br /><span
      style="text-decoration:underline;">Directory(path) traversal</span> or <span
      style="text-decoration:underline;">Local File Inclusion</span> is a web security vulnerability that allows an
    attacker to read arbitrary files on the server that is running an application. <br />While with <span
      style="text-decoration:underline;">Remote file Inclusion</span> the file would be retrieved from a different
    server. Note that <a
      href="https://en.wikipedia.org/wiki/Egress_filtering#:~:text=In%20computer%20networking%2C%20egress%20filtering,the%20Internet%20that%20is%20controlled." target="_blank">egress
      filtering</a> may block the application from loading files from external remote servers<br /><br /><strong>Test
      Vulnerability</strong><br />Look for:<br />• parameters that appear to contain filenames <br /> ◇
    config=../../includes/config.php<br />• parameters that are the basis for a filename<br /> ◇ config=red → red=
    ../../template/red.php<br /> ◇ config=site →
    site=../../includes/${config}.php<br /><br /><strong>Exploit</strong><br />We need to change these parameters and
    enter paths based on the OS detected during mapping:<br />• UNIX system<br /> ◇ /etc/passwd <br />• IIS<br /> ◇
    /global.asax → Application configuration<br />• Windows<br /> ◇ \windows\system32\cmd.exe → execute commands<br />•
    old versions of Windows<br /> ◇ \docume~1\fprefect\mydocu~1 → user directory on <a
      href="https://en.wikipedia.org/wiki/8.3_filename#:~:text=An%208.3%20filename%20(also%20called,for%20compatibility%20with%20legacy%20programs." target="_blank">Windows
      in 8.3 notation</a><br /><br /><br /><br /><strong>
      <h3>Example Scenario</h3>
    </strong><strong>: Local File Inclusion</strong><br />In a WebApp images are loaded via some HTML like the
    following: <br />
    <code>&lt;img src=&quot;/image?filename=</code><code><span style="color:#ff8700;">218.png</span></code><code>&quot;&gt;</code>
    <br /><span style="text-decoration:underline;">How the WebApp returns the contents of the specified
      file</span>:<br />All the image files of the WebApp are stored on disk in the location
    <code><span style="color:#0000ff;">/var/www/images/</span></code>. <br />To return an image, the application
    appends<span style="color:#ff8700;"> the requested filename</span> to <span style="color:#0000ff;">the base
      directory</span> and then uses a filesystem API to read the contents of the file.<br />In the end the WebApp will
    load the image from the following path
    <code><span style="color:#0000ff;">/var/www/images/</span></code><code><span style="color:#ff8700;">218.png</span></code><br /><span
      style="text-decoration:underline;">Attack Scenario</span>:<br />Request of the Attacker:
    <code>https://insecure-website.com/image?filename=</code><code><span style="color:#ff8700;">../../../etc/passwd</span></code>
    .<br />The WebApp then will read from the following file path:
    <code><span style="color:#0000ff;">/var/www/images/</span></code><code><span style="color:#ff8700;">../../../etc/passwd</span></code>
    <br />That is equal to: <code><span style="color:#ff8700;">/etc/passwd</span></code><br /><br /><span
      style="text-decoration:underline;">Attack Scenario on Windows</span><br />Before we have seen the attack on a
    WebApp that run on a UNIX Server. What if the WebApp run on Windows? Same
    thing!<br /><code>https://insecure-website.com/image?filename=</code><code><span style="color:#ff8700;">..\..\..\windows\win.ini</span></code>
    .<br /><br /><br /><span style="color:#a5452a;">Example</span><br />1. If we insert the malicious url directly on
    the Browser probably we will get an error<br /> <a href=""><img src="images/1724-1.png"
        alt="images/1724-1.png" /></a><br />2. Let&#39;s do it with Burpsuite!<br /> <a href=""><img
        src="images/1724-2.png" alt="images/1724-2.png" /></a><br /> Hacked! <br /><br />Bibliography:<br />• <a
      href="https://portswigger.net/web-security/file-path-traversal" target="_blank">https://portswigger.net/web-security/file-path-traversal</a><br />•
    LAB: <a
      href="https://portswigger.net/web-security/file-path-traversal/lab-simple" target="_blank">https://portswigger.net/web-security/file-path-traversal/lab-simple</a>
  </div>
</body>

</html>