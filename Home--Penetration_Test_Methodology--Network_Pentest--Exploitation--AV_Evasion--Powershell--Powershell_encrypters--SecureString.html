<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>SecureString</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>SecureString</h1><br /><br /><strong>SecureString</strong><br /><a
      href="Home--Pentesting_Basics--PowerShell.html">PowerShell</a> introduced SecureString, in an attempt to make
    working with passwords slightly less risky.<br />Attackers instead use <a
      href="Home--Penetration_Test_Methodology--Network_Pentest--Exploitation--AV_Evasion--Powershell--Powershell_encrypters--SecureString.html">SecureString</a>
    not to hide their credentials in, but to hide their malicious code/data in.<br />The limitation with this approach
    is a <span style="text-decoration:underline;">65,536 character limit on the original text to encode</span>.<br />AES
    keys need to be exactly 128, 192 or 256 bits long<br />AES key can be represented as an array of decimal number,
    with each of them less than 256 to fit within a single unsigned byte(8bits).<br /> ◇ 256 bits → 256/8=32
    numbers<br /> ◇ 192 bits → 192/8=24 numbers<br /> ◇ 128 bits → 128/8=16 numbers<br /><br /><span
      style="color:#a5452a;">encrypt</span><br />
    <div class="codebox">
      <div class="codebox">
        PS&gt;&nbsp;$Key&nbsp;=&nbsp;(3,4,2,3,56,34,254,222,1,1,2,23,42,54,33,233,1,34,2,7,6,5,35,43)&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#192bits&nbsp;AES&nbsp;key,24&nbsp;numbers<br />PS&gt;&nbsp;$encoded=ConvertFrom-SecureString&nbsp;-k&nbsp;$key&nbsp;(ConvertTo-SecureString&nbsp;&quot;daniele&quot;&nbsp;-AsPlainText&nbsp;-Force)<br />
      </div>
    </div><br /> <a href=""><img src="images/1180-1.png" alt="images/1180-1.png" /></a><br /><span
      style="color:#a5452a;">decrypt</span><br />
    <div class="codebox">
      <div class="codebox">
        PS&gt;&nbsp;(New-Object&nbsp;System.Net.NetworkCredential(&quot;&quot;,&nbsp;(ConvertTo-SecureString&nbsp;-k&nbsp;$key&nbsp;$encoded))).Password<br />PS&gt;&nbsp;[Runtime.InteropServices.Marshal]::PtrToStringAuto([Runtime.InteropServices.Marshal]::SecureStringToBSTR((ConvertTo-SecureString&nbsp;-k&nbsp;$key&nbsp;$encoded)))&nbsp;&nbsp;&nbsp;#alternative
      </div>
    </div><br /> <a href=""><img src="images/1180-2.png" alt="images/1180-2.png" /></a><br /> <a href=""><img
        src="images/1180-3.png" alt="images/1180-3.png" /></a><br /><br />Bibliography: <br />• <a
      href="https://www.wietzebeukema.nl/blog/powershell-obfuscation-using-securestring" target="_blank">https://www.wietzebeukema.nl/blog/powershell-obfuscation-using-securestring</a><br />
  </div>
</body>

</html>