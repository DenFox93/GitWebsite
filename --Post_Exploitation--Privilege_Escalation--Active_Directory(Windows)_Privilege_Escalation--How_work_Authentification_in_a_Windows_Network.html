<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>How work Authentification in a Windows Network</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>How work Authentification in a Windows Network</h1><br />Windows uses a variety of
    challenge-response authentication protocols for authentication across the network using <a
      href="Home--Penetration_Test_Methodology--System_Security_(Windows_&_Linux)--Cryptography_and_Password_Cracking--Authentication.html">LANMAN</a><a
      href="Home--Penetration_Test_Methodology--System_Security_(Windows_&_Linux)--Cryptography_and_Password_Cracking--Authentication.html">
      and </a><a
      href="Home--Penetration_Test_Methodology--System_Security_(Windows_&_Linux)--Cryptography_and_Password_Cracking--Authentication.html">NT</a><a
      href="Home--Penetration_Test_Methodology--System_Security_(Windows_&_Linux)--Cryptography_and_Password_Cracking--Authentication.html">
      hashes</a>, including:<br />• <strong>LANMAN Challenge/Response</strong>:<br /> LANMAN and LANMAN
    Challenge/Response are not the same thing:<br /> ◇ LANMAN is the method used to store passwords in the SAM database
    on the end system<br /> ◇ LANMAN Challenge/Response is a network authentication protocol that clients use to
    authenticate to a domain or an individual server.<br /> LANMAN Challenge/Response is derived using the LANMAN hash,
    but it is a different thing<br />• <strong>NTLMv1, NTLMv2 Challenge/Response:</strong><br /> NT hashes and NTLMv1
    and NTLMv2 are not the same thing:<br /> ◇ NT hash algorithm creates the hash for the SAM database<br /> ◇ NTLMv1
    and NTLMv2 are across-the-network authentication protocols that rely on the NT hash<br />• <strong>Microsoft
      Kerberos</strong><br /><br /><strong>Authentication on Windows</strong> <br />• By default
    <strong>Kerberos</strong> is used<br />• <strong>NTLM</strong> will only be used if:<br /> ◇ there isn&#39;t any
    Active Directory configured<br /> ◇ the Domain doesn&#39;t exist<br /> ◇ Kerberos isn&#39;t working (bad
    configuration)<br /> ◇ the client that tries to connect using the IP instead of a valid
    host-name.<br /><br /><br /><strong>
      <h3>Configure which protocol will be used</h3>
    </strong><br />• <strong>GUI</strong><br /> Execute secpol.msc → Local policies → Security Options → Network
    Security: LAN Manager authentication level<br /> <a href=""><img src="images/718-1.png"
        alt="images/718-1.png" /></a><br />• <strong>Registry</strong><br /> This will set the level 5:<br />
    <div class="codebox">
      <div class="codebox">
        reg&nbsp;add&nbsp;HKLM\SYSTEM\CurrentControlSet\Control\Lsa\&nbsp;/v&nbsp;lmcompatibilitylevel&nbsp;/t&nbsp;REG_DWORD&nbsp;/d&nbsp;5&nbsp;/f
      </div>
    </div><br /> Possible values:<br /> 0 - Send LM &amp; NTLM responses<br /> 1 - Send LM &amp; NTLM responses, use
    NTLMv2 session security if negotiated<br /> 2 - Send NTLM response only<br /> 3 - Send NTLMv2 response only<br /> 4
    - Send NTLMv2 response only, refuse LM<br /> 5 - Send NTLMv2 response only, refuse LM &amp;
    NTLM<br /><br /><br /><br /><strong>
      <h3>How work the Challenge/Response</h3>
    </strong><br /><a href=""><img src="images/718-2.png" alt="images/718-2.png" /></a><br />1. Client send an
    <strong>authentication request</strong> which contain the username(in plaintext)<br />2. Server generates a 8-byte
    <strong>Challenge</strong> (random value) and sends it back to the client<br />3. Client encrypts the challenge
    using the password and <strong>Response</strong> back with the results of the computation to the
    server<br /><br /><br /><br /><strong>Bibliography:</strong><br /><a
      href="https://book.hacktricks.xyz/windows/ntlm" target="_blank">https://book.hacktricks.xyz/windows/ntlm</a>
  </div>
</body>

</html>