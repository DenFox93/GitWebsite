<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Direct Kernel Object Manipulation (DKOM)</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Direct Kernel Object Manipulation (DKOM)</h1><br/>DKOM is extremely hard to detect unlike Hooking methods that can be easily detected<br /><br /><strong>How DKOM works</strong><br />Because, usually the <span style="text-decoration:underline;">Object Manager</span> is the central point of access to kernel objects but <span style="text-decoration:underline;">DKOM bypasses the Object Manager</span>, thereby bypassing all access checks on the object<br /><br /><strong>Limitations</strong><br />A limitation of DKOM is that it can manipulate only the objects that the kernel keeps in memory(e.g.: list of processes running on the system). So is possible to use it to hide processes.<br /><span style="text-decoration:underline;">But DKOM cannot be used to hide files</span> because there is no object in memory representing all the files on the file system; anyway we can use <a href="ome--Penetration_Test_Methodology--System_Security_(Windows_&_Linux)--Malware--Techniques_used_by_malware--Kernel-mode_Hooking_techniques.html">hooking</a> methods to do that<br /><br /><strong>What DKOM can be used for</strong><br />• Hide processes<br />• Hide device drivers<br />• Hide ports<br />• Elevate a thread&#39;s, and hence a process&#39;s, privilege level<br />• Skew forensics<br /><br /><strong><h2>How DKOM </h2></strong><strong><h2>hide a process</h2></strong><br />DKOM manipulate the list of the processes running on the system and unlink <span style="color:#ff1b00;">the process</span> from the <span style="color:#a020f0;">process list</span>.<br /><strong>Windows Scheduler</strong><br />    The <span style="text-decoration:underline;">Windows scheduler</span> is a <span style="color:#ff8700;">doubly linked list of </span><strong><span style="color:#ff8700;">threads</span></strong> used for scheduling.<br /><strong>Kernel</strong> <br />    The <span style="text-decoration:underline;">Kernel</span> maintains another <span style="color:#a020f0;">doubly linked list of </span><strong><span style="color:#a020f0;">processes</span></strong> that can be queried using the standard API ZwQuerySystemInformation, used also from the Windows Task Manager to obtain a list of currently running processes.<br />    <br />When an <span style="color:#ff1b00;">active process is removed</span> from the <span style="color:#a020f0;">double linked list of processes</span> the enumeration process using the standard API will fail to show the existence of the <span style="color:#ff1b00;">hidden process</span>. <br />However, the <span style="color:#ff1b00;">process</span> <span style="text-decoration:underline;">will still be scheduled</span> because the Windows Scheduler uses the <span style="color:#ff8700;">thread list</span> for scheduling not the <span style="color:#a020f0;">process list</span><br /><br />    <a href=""><img src="images/569-1.png" alt="images/569-1.png" /></a><br />    <br />Every process in a Windows kernel is represented with a per-process structure known as the EPROCESS block<br /><br /><br /><br /><br />Bibliography: <br />1. Crimeware: Understanding New Attacks and Defenses<br />2. Windows Driver Development Kit<br />3. Rootkit subverting the Windows Kernel by Greg Hoglund</div>
</body>
</html>
